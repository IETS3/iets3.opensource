package org.iets3.core.expr.lookup.interpreter.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.interpreter.rt.InterpreterBase;
import java.util.List;
import com.mbeddr.mpsutil.interpreter.rt.IEvaluator;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import com.mbeddr.mpsutil.interpreter.rt.ConceptEvaluatorBase;
import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.interpreter.rt.IContext;
import com.mbeddr.mpsutil.interpreter.rt.ICoverageAnalyzer;
import com.mbeddr.mpsutil.interpreter.rt.ComputationTrace;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.mpsutil.interpreter.rt.StopAndReturnException;
import com.mbeddr.mpsutil.interpreter.rt.InterpreterEscapeException;
import com.mbeddr.mpsutil.interpreter.rt.InterpreterRuntimeException;
import com.mbeddr.mpsutil.interpreter.rt.EvaluatorInfo;
import org.iets3.core.expr.base.behavior.IETS3ExprContext;
import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import org.iets3.core.expr.base.behavior.IDotTarget__BehaviorDescriptor;
import com.mbeddr.mpsutil.interpreter.rt.ITypeMapper;
import com.mbeddr.mpsutil.interpreter.rt.IRelationship;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class InterpreterLookupInterpreter extends InterpreterBase {
  public InterpreterLookupInterpreter() {
    init();
  }

  @Override
  public String getCategory() {
    return "arithmetic";
  }

  protected void populateEvaluators(List<? extends IEvaluator> evaluators) {
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.LookupTableRef$J, "r:a13c86fe-c40a-4a06-b1a1-208e5bed665c(org.iets3.core.expr.lookup.interpreter.plugin)/5860825012169154230", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          return ((Object) castUp(context.getRootInterpreter().evaluate(SLinkOperations.getTarget(node, LINKS.table$PWmI), context, coverage, trace, false), Object.class));
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("LookupTableRef()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("LookupTableRef", "http://127.0.0.1:63320/node?ref=c9c5921e-ccec-4084-961c-039c54487678%2Fi%3A10000001%28org.iets3.core.expr.lookup.interpreter%40transient111%2Forg.iets3.core.expr.lookup.interpreter.plugin%400%29%2F5860825012169154230");
      }

      @Override
      public String toString() {
        return "LookupTableRef";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.LookupTable$$Y, "r:a13c86fe-c40a-4a06-b1a1-208e5bed665c(org.iets3.core.expr.lookup.interpreter.plugin)/5860825012169163834", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          Object cached = context.getEnvironment().getRootEnvironment().get(node);
          if (cached != null) {
            return cached;
          }

          IETS3ExprContext ctx = ((IETS3ExprContext) context);
          Map<Object, Map<Object, Object>> result;
          result = MapSequence.fromMap(new HashMap<Object, Map<Object, Object>>());

          for (SNode row : ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.rows$D1mY))) {
            Object rowVal = context.getRootInterpreter().evaluate(SLinkOperations.getTarget(row, LINKS.val$aKTd), context, coverage, trace, false);
            MapSequence.fromMap(result).put(rowVal, MapSequence.fromMap(new HashMap<Object, Object>()));
          }

          for (SNode cell : ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.cells$u$1L))) {
            Object res = context.getRootInterpreter().evaluate(SLinkOperations.getTarget(cell, LINKS.val$ayFh), context, coverage, trace, false);
            Object rowVal = context.getRootInterpreter().evaluate(SLinkOperations.getTarget(SLinkOperations.getTarget(cell, LINKS.row$aCLF), LINKS.val$aKTd), context, coverage, trace, false);
            Object colVal = context.getRootInterpreter().evaluate(SLinkOperations.getTarget(SLinkOperations.getTarget(cell, LINKS.col$aJO9), LINKS.val$aKTd), context, coverage, trace, false);
            MapSequence.fromMap(MapSequence.fromMap(result).get(rowVal)).put(colVal, res);
          }

          context.getEnvironment().getRootEnvironment().put(node, result);
          return result;
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("lookup()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("LookupTable", "http://127.0.0.1:63320/node?ref=c9c5921e-ccec-4084-961c-039c54487678%2Fi%3A10000001%28org.iets3.core.expr.lookup.interpreter%40transient111%2Forg.iets3.core.expr.lookup.interpreter.plugin%400%29%2F5860825012169163834");
      }

      @Override
      public String toString() {
        return "LookupTable";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.LookupTarget$Rp, "r:a13c86fe-c40a-4a06-b1a1-208e5bed665c(org.iets3.core.expr.lookup.interpreter.plugin)/5860825012169343420", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          Map<Object, Map<Object, Object>> lookupTable = (Map<Object, Map<Object, Object>>) MapSequence.fromMap(context.getEnvironment()).get(IDotTarget__BehaviorDescriptor.contextExpression_id6zmBjqUivyF.invoke(node));
          Object rowVal = context.getRootInterpreter().evaluate(SLinkOperations.getTarget(node, LINKS.rowVal$pz4k), context, coverage, trace, false);
          Object colVal = context.getRootInterpreter().evaluate(SLinkOperations.getTarget(node, LINKS.colVal$vTTq), context, coverage, trace, false);
          Object res = MapSequence.fromMap(MapSequence.fromMap(lookupTable).get(rowVal)).get(colVal);
          return res;
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("lookup()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("LookupTarget", "http://127.0.0.1:63320/node?ref=c9c5921e-ccec-4084-961c-039c54487678%2Fi%3A10000001%28org.iets3.core.expr.lookup.interpreter%40transient111%2Forg.iets3.core.expr.lookup.interpreter.plugin%400%29%2F5860825012169343420");
      }

      @Override
      public String toString() {
        return "LookupTarget";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
  }


  protected void populateTypeMappers(List<? extends ITypeMapper> typeMappers) {
  }



  protected void populateRelationships(List<? extends IRelationship> relationships) {
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink table$PWmI = MetaAdapterFactory.getReferenceLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54bed09e6cbL, 0x5155d54bed09e793L, "table");
    /*package*/ static final SContainmentLink val$aKTd = MetaAdapterFactory.getContainmentLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54becc67188L, 0x5155d54becc6720dL, "val");
    /*package*/ static final SContainmentLink rows$D1mY = MetaAdapterFactory.getContainmentLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54becaf12b6L, 0x5155d54becb56646L, "rows");
    /*package*/ static final SContainmentLink val$ayFh = MetaAdapterFactory.getContainmentLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54becbb325bL, 0x5155d54becbb32ceL, "val");
    /*package*/ static final SReferenceLink row$aCLF = MetaAdapterFactory.getReferenceLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54becbb325bL, 0x5155d54becbb32d3L, "row");
    /*package*/ static final SReferenceLink col$aJO9 = MetaAdapterFactory.getReferenceLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54becbb325bL, 0x5155d54becbb32dcL, "col");
    /*package*/ static final SContainmentLink cells$u$1L = MetaAdapterFactory.getContainmentLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54becaf12b6L, 0x5155d54becbb3391L, "cells");
    /*package*/ static final SContainmentLink rowVal$pz4k = MetaAdapterFactory.getContainmentLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54bed060e8eL, 0x5155d54bed061400L, "rowVal");
    /*package*/ static final SContainmentLink colVal$vTTq = MetaAdapterFactory.getContainmentLink(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54bed060e8eL, 0x5155d54bed06148aL, "colVal");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept LookupTableRef$J = MetaAdapterFactory.getConcept(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54bed09e6cbL, "org.iets3.core.expr.lookup.structure.LookupTableRef");
    /*package*/ static final SConcept LookupTable$$Y = MetaAdapterFactory.getConcept(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54becaf12b6L, "org.iets3.core.expr.lookup.structure.LookupTable");
    /*package*/ static final SConcept LookupTarget$Rp = MetaAdapterFactory.getConcept(0x406e4b3cffd4d16L, 0x85336bc50680ab3bL, 0x5155d54bed060e8eL, "org.iets3.core.expr.lookup.structure.LookupTarget");
  }
}
