package org.iets3.core.expr.math.interpreter.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typechecking.TypecheckingFacade;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.iets3.core.expr.simpleTypes.behavior.NumberType__BehaviorDescriptor;
import org.iets3.core.expr.base.plugin.InfHelper;
import java.math.BigDecimal;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import java.math.BigInteger;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class MathInterpreterHelper {

  public static int prec(SNode expr) {
    SNode t = TypecheckingFacade.getFromContext().getTypeOf(expr);
    if (SNodeOperations.isInstanceOf(t, CONCEPTS.NumberType$n) && SLinkOperations.getTarget(SNodeOperations.cast(t, CONCEPTS.NumberType$n), LINKS.prec$RwIK) != null) {
      return (int) NumberType__BehaviorDescriptor.precisionWithInf_id7kyIuXqes_H.invoke(SNodeOperations.cast(t, CONCEPTS.NumberType$n));
    }
    return InfHelper.INF_PREC;
  }

  public static BigDecimal mapBigDecimal(_FunctionTypes._return_P1_E0<? extends Double, ? super Double> func, BigDecimal val) {
    return new BigDecimal(func.invoke(val.doubleValue()));
  }

  public static BigDecimal forceBigDecimal(Number n) {
    if (n instanceof BigDecimal) {
      return (BigDecimal) n;
    }
    if (n instanceof BigInteger) {
      return new BigDecimal((BigInteger) n);
    }
    return null;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept NumberType$n = MetaAdapterFactory.getConcept(0x6b277d9ad52d416fL, 0xa2091919bd737f50L, 0x7211e50064d40ea8L, "org.iets3.core.expr.simpleTypes.structure.NumberType");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink prec$RwIK = MetaAdapterFactory.getContainmentLink(0x6b277d9ad52d416fL, 0xa2091919bd737f50L, 0x7211e50064d40ea8L, 0x127541598201af89L, "prec");
  }
}
