package org.iets3.core.expr.doc.plugin.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.projectview.runtime.IProjectViewDescriptor;
import java.util.List;
import com.mbeddr.mpsutil.projectview.runtime.IViewDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import com.mbeddr.mpsutil.projectview.runtime.AbstractViewDescriptor;
import java.util.Map;
import com.mbeddr.mpsutil.projectview.runtime.ElementId;
import com.mbeddr.mpsutil.projectview.runtime.IViewElementDescriptor;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.LinkedHashMap;
import com.mbeddr.mpsutil.projectview.runtime.AbstractViewElementDescriptor;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import com.mbeddr.mpsutil.projectview.runtime.ViewElement;
import org.iets3.core.expr.doc.behavior.IBookmark__BehaviorDescriptor;
import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.projectview.runtime.ViewId;
import jetbrains.mps.project.Project;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.baseLanguage.tuples.runtime.MultiTuple;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import org.jetbrains.annotations.Nullable;
import javax.swing.Icon;
import jetbrains.mps.ide.icons.GlobalIconManager;
import com.intellij.icons.AllIcons;

public class ProjectViewDescriptor implements IProjectViewDescriptor {
  public static final ProjectViewDescriptor INSTANCE = new ProjectViewDescriptor();
  private final List<IViewDescriptor> myViews = ListSequence.fromList(new ArrayList<IViewDescriptor>());

  public ProjectViewDescriptor() {
    ListSequence.fromList(myViews).addElement(new AbstractViewDescriptor() {
      private Map<ElementId, IViewElementDescriptor> myElements = MapSequence.fromMap(new LinkedHashMap<ElementId, IViewElementDescriptor>(16, (float) 0.75, false));
      {
        addElement(new AbstractViewElementDescriptor<Tuples._2>() {
          @Override
          public String getLabel(ViewElement element) {
            return (String) IBookmark__BehaviorDescriptor.getName_id2m0pXWPfqG.invoke(((SNode) (((Tuples._2) element.getObject(new ElementId("bookmarkNode1", new ViewId("org.iets3.core.expr.doc.plugin.plugin.BookmarkExplorer"))))._1())));
          }
          @Override
          public boolean isAbstract() {
            return false;
          }
          @Override
          public boolean isOverride() {
            return false;
          }
          @Override
          public Iterable<ViewElement<Tuples._2>> queryElements(final Project mpsProject, final ViewElement parentElement, final ViewId contextView) {
            final ElementId descriptorId = new ElementId("bookmarkNode1", new ViewId("org.iets3.core.expr.doc.plugin.plugin.BookmarkExplorer"));
            ViewElement element = parentElement;
            Object queryResult = Sequence.fromIterable(new BookmarkRoot(mpsProject).getNodeChildren()).where((it) -> !((boolean) IBookmark__BehaviorDescriptor.hideBookmark_id2m0pXWMLk6.invoke(it))).select((it) -> MultiTuple.<SNode,SNode>from(IBookmark__BehaviorDescriptor.getBookmarkedNode_id4vZ65iK1hOY.invoke(it), it));

            Iterable<Tuples._2> rawSequence = (queryResult instanceof Iterable ? ((Iterable<Tuples._2>) queryResult) : Sequence.<Tuples._2>singleton(((Tuples._2) queryResult)));

            return Sequence.fromIterable(rawSequence).where(new _FunctionTypes._return_P1_E0<Boolean, Tuples._2>() {
              public Boolean invoke(Tuples._2 it) {
                return it != null;
              }
            }).select(new _FunctionTypes._return_P1_E0<ViewElement<Tuples._2>, Tuples._2>() {
              public ViewElement<Tuples._2> invoke(Tuples._2 it) {
                return new ViewElement<Tuples._2>(it, descriptorId, mpsProject, parentElement, contextView);
              }
            });
          }
          @Override
          public ElementId getId() {
            return new ElementId("bookmarkNode1", new ViewId("org.iets3.core.expr.doc.plugin.plugin.BookmarkExplorer"));
          }
          @Nullable
          @Override
          public Icon getIcon(ViewElement element) {
            Project mpsProject = element.getProject();
            return GlobalIconManager.getInstance().getIconFor(((SNode) (((Tuples._2) element.getObject(new ElementId("bookmarkNode1", new ViewId("org.iets3.core.expr.doc.plugin.plugin.BookmarkExplorer"))))._0())));
          }
          @Override
          public boolean isAssignable(Project mpsProject, ViewElement<Tuples._2> element) {
            return super.isAssignable(mpsProject, element) && element.getObject() instanceof Tuples._2;
          }
          @Override
          public Iterable<String> getFolders(ViewElement<Tuples._2> element) {
            Project mpsProject = element.getProject();
            return (Iterable<String>) IBookmark__BehaviorDescriptor.getFolder_id2m0pXWPbKT.invoke(((SNode) (((Tuples._2) element.getObject(new ElementId("bookmarkNode1", new ViewId("org.iets3.core.expr.doc.plugin.plugin.BookmarkExplorer"))))._1())));
          }
          @Override
          public Class getOutputType() {
            return Tuples._2.class;
          }
          @Override
          public Boolean loadAsync(ViewElement<Tuples._2> element) {
            Project mpsProject = element.getProject();
            return true;
          }
        });
      }

      public void addElement(IViewElementDescriptor element) {
        MapSequence.fromMap(myElements).put(element.getId(), element);
      }
      protected ViewId getViewId() {
        return getId();
      }
      @Override
      public ViewId getId() {
        return new ViewId("org.iets3.core.expr.doc.plugin.plugin.BookmarkExplorer");
      }
      @Override
      public List<IViewElementDescriptor> getElements() {
        return Sequence.fromIterable(MapSequence.fromMap(myElements).values()).toList();
      }
      @Override
      public IViewElementDescriptor getElement(ElementId id) {
        return MapSequence.fromMap(myElements).get(id);
      }
      @Override
      public String getLabel() {
        return ((_FunctionTypes._return_P0_E0<String>) () -> {
          BookmarkConfig config = BookmarkConfigHelper.getConfig();
          if (config != null && config.activateBookmarkExplorer()) {
            return "Bookmarks";
          } else {
            return null;
          }
        }).invoke();
      }
      @Override
      public int getPriority() {
        return 6;
      }
      @Override
      public Icon getIcon() {
        return AllIcons.Gutter.Bookmark;
      }
    });
  }

  @Override
  public Iterable<IViewDescriptor> getViewDescriptors() {
    return myViews;
  }
}
