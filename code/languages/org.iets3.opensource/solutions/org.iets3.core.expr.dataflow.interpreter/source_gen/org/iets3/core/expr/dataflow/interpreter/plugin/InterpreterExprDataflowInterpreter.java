package org.iets3.core.expr.dataflow.interpreter.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.interpreter.rt.InterpreterBase;
import java.util.List;
import com.mbeddr.mpsutil.interpreter.rt.IEvaluator;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import com.mbeddr.mpsutil.interpreter.rt.ConceptEvaluatorBase;
import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.interpreter.rt.IContext;
import com.mbeddr.mpsutil.interpreter.rt.ICoverageAnalyzer;
import com.mbeddr.mpsutil.interpreter.rt.ComputationTrace;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import com.mbeddr.mpsutil.interpreter.rt.StopAndReturnException;
import com.mbeddr.mpsutil.interpreter.rt.InterpreterEscapeException;
import com.mbeddr.mpsutil.interpreter.rt.InterpreterRuntimeException;
import com.mbeddr.mpsutil.interpreter.rt.EvaluatorInfo;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import com.mbeddr.mpsutil.interpreter.rt.ITypeMapper;
import com.mbeddr.mpsutil.interpreter.rt.IRelationship;
import com.mbeddr.mpsutil.interpreter.rt.InterpretBeforeRelationshipImpl;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class InterpreterExprDataflowInterpreter extends InterpreterBase {
  public InterpreterExprDataflowInterpreter() {
    init();
  }

  @Override
  public String getCategory() {
    return "arithmetic";
  }

  protected void populateEvaluators(List<? extends IEvaluator> evaluators) {
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.CompositeBlock$TJ, "r:de9dfbe2-082a-4d91-9d01-4408acf010f1(org.iets3.core.expr.dataflow.interpreter.plugin)/2870058499331264152", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          CompositeBlockEvaluator evaluator = new CompositeBlockEvaluator(context, node);
          evaluator.eval();
          if (ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.outports$xLwx)).count() == 1) {
            return evaluator.getOutput(ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.outports$xLwx)).first());
          } else {
            return evaluator.getAllOutputs();
          }
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("composite block()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("CompositeBlock", "http://127.0.0.1:63320/node?ref=ec1d0b34-e2f4-4a7e-bfb9-84a75f778dce%2Fi%3A10000001%28org.iets3.core.expr.dataflow.interpreter%40transient129%2Forg.iets3.core.expr.dataflow.interpreter.plugin%400%29%2F2870058499331264152");
      }

      @Override
      public String toString() {
        return "CompositeBlock";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.ExprBlock$YR, "r:de9dfbe2-082a-4d91-9d01-4408acf010f1(org.iets3.core.expr.dataflow.interpreter.plugin)/2870058499329319858", true) {
      public Object evaluateEvaluator(SNode node, final IContext context, final ICoverageAnalyzer coverage, final ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          if (ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.outports$xLwx)).count() == 1) {
            return context.getRootInterpreter().evaluate(SLinkOperations.getTarget(ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.outports$xLwx)).first(), LINKS.value$cAQw), context, coverage, trace, false);
          } else {
            return ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.outports$xLwx)).select((it) -> context.getRootInterpreter().evaluate(SLinkOperations.getTarget(it, LINKS.value$cAQw), context, coverage, trace, false)).toList();
          }
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("block()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("ExprBlock", "http://127.0.0.1:63320/node?ref=ec1d0b34-e2f4-4a7e-bfb9-84a75f778dce%2Fi%3A10000001%28org.iets3.core.expr.dataflow.interpreter%40transient129%2Forg.iets3.core.expr.dataflow.interpreter.plugin%400%29%2F2870058499329319858");
      }

      @Override
      public String toString() {
        return "ExprBlock";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.BlockCallExpr$Iv, "r:de9dfbe2-082a-4d91-9d01-4408acf010f1(org.iets3.core.expr.dataflow.interpreter.plugin)/2870058499329436103", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          try {
            context.getEnvironment().push(SLinkOperations.getTarget(node, LINKS.block$A$Bz), MapSequence.fromMap(new HashMap<SNode, Object>()));
            for (SNode in : ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.inputs$AEHX))) {
              MapSequence.fromMap(context.getEnvironment()).put(ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(node, LINKS.block$A$Bz), LINKS.inports$dl2o)).getElement(SNodeOperations.getIndexInParent(in)), context.getRootInterpreter().evaluate(in, context, coverage, trace, false));
            }
            for (SNode pv : ListSequence.fromList(SLinkOperations.getChildren(node, LINKS.paramValues$A_5_))) {
              MapSequence.fromMap(context.getEnvironment()).put(ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(node, LINKS.block$A$Bz), LINKS.params$7rRh)).getElement(SNodeOperations.getIndexInParent(pv)), context.getRootInterpreter().evaluate(pv, context, coverage, trace, false));
            }
            return context.getRootInterpreter().evaluate(SLinkOperations.getTarget(node, LINKS.block$A$Bz), context, coverage, trace, false);
          } finally {
            context.getEnvironment().pop(SLinkOperations.getTarget(node, LINKS.block$A$Bz));
          }
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("BlockCallExpr()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("BlockCallExpr", "http://127.0.0.1:63320/node?ref=ec1d0b34-e2f4-4a7e-bfb9-84a75f778dce%2Fi%3A10000001%28org.iets3.core.expr.dataflow.interpreter%40transient129%2Forg.iets3.core.expr.dataflow.interpreter.plugin%400%29%2F2870058499329436103");
      }

      @Override
      public String toString() {
        return "BlockCallExpr";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.ParamRef$bF, "r:de9dfbe2-082a-4d91-9d01-4408acf010f1(org.iets3.core.expr.dataflow.interpreter.plugin)/2870058499329432503", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          return MapSequence.fromMap(context.getEnvironment()).get(SLinkOperations.getTarget(node, LINKS.param$AS0o));
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("ParamRef()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("ParamRef", "http://127.0.0.1:63320/node?ref=ec1d0b34-e2f4-4a7e-bfb9-84a75f778dce%2Fi%3A10000001%28org.iets3.core.expr.dataflow.interpreter%40transient129%2Forg.iets3.core.expr.dataflow.interpreter.plugin%400%29%2F2870058499329432503");
      }

      @Override
      public String toString() {
        return "ParamRef";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.InportRef$NA, "r:de9dfbe2-082a-4d91-9d01-4408acf010f1(org.iets3.core.expr.dataflow.interpreter.plugin)/2870058499329429584", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          return MapSequence.fromMap(context.getEnvironment()).get(SLinkOperations.getTarget(node, LINKS.port$_Q9r));
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("InportRef()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("InportRef", "http://127.0.0.1:63320/node?ref=ec1d0b34-e2f4-4a7e-bfb9-84a75f778dce%2Fi%3A10000001%28org.iets3.core.expr.dataflow.interpreter%40transient129%2Forg.iets3.core.expr.dataflow.interpreter.plugin%400%29%2F2870058499329429584");
      }

      @Override
      public String toString() {
        return "InportRef";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
  }


  protected void populateTypeMappers(List<? extends ITypeMapper> typeMappers) {
  }



  protected void populateRelationships(List<? extends IRelationship> relationships) {
    ListSequence.fromList(((List<IRelationship>) relationships)).addElement(new InterpretBeforeRelationshipImpl("org.iets3.core.expr.dataflow.interpreter.plugin.InterpreterExprDataflowInterpreter", "org.iets3.core.expr.lambda.interpreter.plugin.InterpreterExprLambdaInterpreter"));
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink outports$xLwx = MetaAdapterFactory.getContainmentLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x4f91a4533f716a5aL, 0x4f91a4533f716c71L, "outports");
    /*package*/ static final SContainmentLink value$cAQw = MetaAdapterFactory.getContainmentLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x4f91a4533f716b2fL, 0x27d47effb90810e1L, "value");
    /*package*/ static final SReferenceLink block$A$Bz = MetaAdapterFactory.getReferenceLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x27d47effb918da7aL, 0x27d47effb918db5fL, "block");
    /*package*/ static final SContainmentLink inports$dl2o = MetaAdapterFactory.getContainmentLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x4f91a4533f716a5aL, 0x4f91a4533f716a58L, "inports");
    /*package*/ static final SContainmentLink inputs$AEHX = MetaAdapterFactory.getContainmentLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x27d47effb918da7aL, 0x27d47effb918db64L, "inputs");
    /*package*/ static final SContainmentLink params$7rRh = MetaAdapterFactory.getContainmentLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x4f91a4533f716a5aL, 0x5d89ae332e211052L, "params");
    /*package*/ static final SContainmentLink paramValues$A_5_ = MetaAdapterFactory.getContainmentLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x27d47effb918da7aL, 0x27d47effb918db61L, "paramValues");
    /*package*/ static final SReferenceLink param$AS0o = MetaAdapterFactory.getReferenceLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x27d47effb8cbcbc7L, 0x27d47effb8cbcbe6L, "param");
    /*package*/ static final SReferenceLink port$_Q9r = MetaAdapterFactory.getReferenceLink(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x4f91a4533f716cc3L, 0x4f91a4533f716cc4L, "port");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept CompositeBlock$TJ = MetaAdapterFactory.getConcept(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x4f91a4533f716a5dL, "org.iets3.core.expr.dataflow.structure.CompositeBlock");
    /*package*/ static final SConcept ExprBlock$YR = MetaAdapterFactory.getConcept(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x4f91a4533f716984L, "org.iets3.core.expr.dataflow.structure.ExprBlock");
    /*package*/ static final SConcept BlockCallExpr$Iv = MetaAdapterFactory.getConcept(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x27d47effb918da7aL, "org.iets3.core.expr.dataflow.structure.BlockCallExpr");
    /*package*/ static final SConcept ParamRef$bF = MetaAdapterFactory.getConcept(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x27d47effb8cbcbc7L, "org.iets3.core.expr.dataflow.structure.ParamRef");
    /*package*/ static final SConcept InportRef$NA = MetaAdapterFactory.getConcept(0xcee4aa62aca94f26L, 0x960275129cd457c9L, 0x4f91a4533f716cc3L, "org.iets3.core.expr.dataflow.structure.InportRef");
  }
}
