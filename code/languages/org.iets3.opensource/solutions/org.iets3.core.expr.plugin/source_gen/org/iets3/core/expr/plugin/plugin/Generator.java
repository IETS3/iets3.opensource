package org.iets3.core.expr.plugin.plugin;

/*Generated by MPS */

import com.intellij.openapi.actionSystem.ToggleAction;
import com.intellij.openapi.actionSystem.AnActionEvent;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import jetbrains.mps.project.MPSProject;
import jetbrains.mps.ide.project.ProjectHelper;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import java.util.List;
import org.jetbrains.mps.openapi.module.SModule;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import com.mbeddr.mpsutil.spreferences.runtime.PreferenceModules;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.annotations.NotNull;
import com.intellij.openapi.actionSystem.ActionUpdateThread;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class Generator extends ToggleAction {
  public Generator() {
    super("KernelF Tests: Generator");
  }
  @Override
  public boolean isSelected(AnActionEvent event) {
    final Wrappers._boolean b = new Wrappers._boolean(false);
    final MPSProject mpsproj = ProjectHelper.fromIdeaProject(event.getProject());
    if (mpsproj == null) {
      return false;
    }
    mpsproj.getRepository().getModelAccess().runReadAction(new _Adapters._return_P0_E0_to_Runnable_adapter(((_FunctionTypes._return_P0_E0<Boolean>) () -> {
      List<SModule> projectModules = mpsproj.getProjectModules();
      if (projectModules.isEmpty()) {
        return false;
      }
      SNode tec = SNodeOperations.cast(PreferenceModules.getPreferencesRootInScope(projectModules.get(0), "TestExecutionPreferences"), CONCEPTS.TestExecutionConfig$QC);
      return b.value = SNodeOperations.isInstanceOf(SLinkOperations.getTarget(tec, LINKS.executionMode$y6nW), CONCEPTS.GeneratorExecutionMode$ha);
    })));
    return b.value;
  }
  @Override
  public void setSelected(AnActionEvent event, boolean b) {
    final MPSProject mpsproj = ProjectHelper.fromIdeaProject(event.getProject());
    if (mpsproj == null) {
      return;
    }
    mpsproj.getRepository().getModelAccess().executeCommand(new _Adapters._return_P0_E0_to_Runnable_adapter(((_FunctionTypes._return_P0_E0<Object>) () -> {
      List<SModule> projectModules = mpsproj.getProjectModules();
      if (projectModules.isEmpty()) {
        return false;
      }
      SNode tec = SNodeOperations.cast(PreferenceModules.getPreferencesRootInScope(projectModules.get(0), "TestExecutionPreferences"), CONCEPTS.TestExecutionConfig$QC);
      return SLinkOperations.setNewChild(tec, LINKS.executionMode$y6nW, CONCEPTS.GeneratorExecutionMode$ha);
    })));
  }

  @NotNull
  @Override
  public ActionUpdateThread getActionUpdateThread() {
    return ActionUpdateThread.BGT;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept TestExecutionConfig$QC = MetaAdapterFactory.getConcept(0x2022a47110ba4431L, 0xba5d622df898f3c6L, 0x3e144f9cc1c728afL, "org.iets3.core.expr.testExecution.structure.TestExecutionConfig");
    /*package*/ static final SConcept GeneratorExecutionMode$ha = MetaAdapterFactory.getConcept(0x2022a47110ba4431L, 0xba5d622df898f3c6L, 0x3e144f9cc1c797aaL, "org.iets3.core.expr.testExecution.structure.GeneratorExecutionMode");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink executionMode$y6nW = MetaAdapterFactory.getContainmentLink(0x2022a47110ba4431L, 0xba5d622df898f3c6L, 0x3e144f9cc1c728afL, 0x3e144f9cc1c79776L, "executionMode");
  }
}
