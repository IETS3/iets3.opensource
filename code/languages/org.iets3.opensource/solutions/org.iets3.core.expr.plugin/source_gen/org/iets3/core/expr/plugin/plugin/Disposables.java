package org.iets3.core.expr.plugin.plugin;

/*Generated by MPS */

import java.util.Map;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.LinkedHashMap;
import jetbrains.mps.internal.collections.runtime.Sequence;

/**
 * Maintains a global map of disposables that will be disposed by DisposeDisposables plugin. This is mainly useful
 * during development when classes are often being reloaded. The map has to be global because plugins can't be looked up
 * in the project and can't have methods on them.
 */
public class Disposables {

  private static Map<Object, _FunctionTypes._void_P0_E0> disposables;

  public static void add(final Object key, final _FunctionTypes._void_P0_E0 disposer) {
    if (disposables == null) {
      disposables = MapSequence.fromMap(new LinkedHashMap<Object, _FunctionTypes._void_P0_E0>(16, (float) 0.75, false));
    }
    MapSequence.fromMap(disposables).put(key, disposer);
  }

  public static void remove(final Object key) {
    if (disposables != null) {
      MapSequence.fromMap(disposables).removeKey(key);
    }
  }

  /**
   * Invokes all disposables
   */
  public static void dispose() {
    if (disposables != null) {
      Sequence.fromIterable(MapSequence.fromMap(disposables).values()).visitAll((it) -> it.invoke());
      disposables = null;
    }
  }
}
