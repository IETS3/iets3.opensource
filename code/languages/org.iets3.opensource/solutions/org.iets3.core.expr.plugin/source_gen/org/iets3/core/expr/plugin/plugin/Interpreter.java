package org.iets3.core.expr.plugin.plugin;

/*Generated by MPS */

import com.intellij.openapi.actionSystem.ToggleAction;
import com.intellij.openapi.actionSystem.AnActionEvent;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import jetbrains.mps.project.MPSProject;
import jetbrains.mps.ide.project.ProjectHelper;
import java.util.List;
import org.jetbrains.mps.openapi.module.SModule;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import com.mbeddr.mpsutil.spreferences.runtime.PreferenceModules;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.annotations.NotNull;
import com.intellij.openapi.actionSystem.ActionUpdateThread;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class Interpreter extends ToggleAction {
  public Interpreter() {
    super("KernelF Tests: Interpreter");
  }
  @Override
  public boolean isSelected(AnActionEvent event) {
    final Wrappers._boolean b = new Wrappers._boolean(false);
    final MPSProject mpsproj = ProjectHelper.fromIdeaProject(event.getProject());
    if (mpsproj == null) {
      return false;
    }
    mpsproj.getRepository().getModelAccess().runReadAction(() -> {
      List<SModule> projectModules = mpsproj.getProjectModules();
      SNode tec = SNodeOperations.cast(PreferenceModules.getPreferencesRootInScope(projectModules.get(0), "TestExecutionPreferences"), CONCEPTS.TestExecutionConfig$QC);
      b.value = SNodeOperations.isInstanceOf(SLinkOperations.getTarget(tec, LINKS.executionMode$y6nW), CONCEPTS.InterpreterExecutionMode$Yd);
    });
    return b.value;
  }
  @Override
  public void setSelected(AnActionEvent event, boolean b) {
    final MPSProject mpsproj = ProjectHelper.fromIdeaProject(event.getProject());
    ProjectHelper.fromIdeaProject(event.getProject()).getRepository().getModelAccess().executeCommand(() -> {
      List<SModule> projectModules = mpsproj.getProjectModules();
      SNode tec = SNodeOperations.cast(PreferenceModules.getPreferencesRootInScope(projectModules.get(0), "TestExecutionPreferences"), CONCEPTS.TestExecutionConfig$QC);
      SLinkOperations.setNewChild(tec, LINKS.executionMode$y6nW, CONCEPTS.InterpreterExecutionMode$Yd);
    });

  }

  @NotNull
  @Override
  public ActionUpdateThread getActionUpdateThread() {
    return ActionUpdateThread.BGT;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept TestExecutionConfig$QC = MetaAdapterFactory.getConcept(0x2022a47110ba4431L, 0xba5d622df898f3c6L, 0x3e144f9cc1c728afL, "org.iets3.core.expr.testExecution.structure.TestExecutionConfig");
    /*package*/ static final SConcept InterpreterExecutionMode$Yd = MetaAdapterFactory.getConcept(0x2022a47110ba4431L, 0xba5d622df898f3c6L, 0x3e144f9cc1c797c8L, "org.iets3.core.expr.testExecution.structure.InterpreterExecutionMode");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink executionMode$y6nW = MetaAdapterFactory.getContainmentLink(0x2022a47110ba4431L, 0xba5d622df898f3c6L, 0x3e144f9cc1c728afL, 0x3e144f9cc1c79776L, "executionMode");
  }
}
