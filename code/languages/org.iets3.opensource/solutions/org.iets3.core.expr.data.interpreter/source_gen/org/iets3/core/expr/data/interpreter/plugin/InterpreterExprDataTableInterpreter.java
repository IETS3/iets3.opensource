package org.iets3.core.expr.data.interpreter.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.interpreter.rt.InterpreterBase;
import java.util.List;
import com.mbeddr.mpsutil.interpreter.rt.IEvaluator;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import com.mbeddr.mpsutil.interpreter.rt.ConceptEvaluatorBase;
import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.interpreter.rt.IContext;
import com.mbeddr.mpsutil.interpreter.rt.ICoverageAnalyzer;
import com.mbeddr.mpsutil.interpreter.rt.ComputationTrace;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import com.mbeddr.mpsutil.interpreter.rt.StopAndReturnException;
import com.mbeddr.mpsutil.interpreter.rt.InterpreterEscapeException;
import com.mbeddr.mpsutil.interpreter.rt.InterpreterRuntimeException;
import com.mbeddr.mpsutil.interpreter.rt.EvaluatorInfo;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import org.iets3.core.expr.base.behavior.IDotTarget__BehaviorDescriptor;
import org.iets3.core.expr.base.runtime.runtime.DefaultNix;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import jetbrains.mps.baseLanguage.tuples.runtime.MultiTuple;
import java.util.Objects;
import org.iets3.core.expr.simpleTypes.runtime.EqualsHelper;
import jetbrains.mps.internal.collections.runtime.Sequence;
import com.mbeddr.mpsutil.interpreter.rt.ITypeMapper;
import com.mbeddr.mpsutil.interpreter.rt.IRelationship;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class InterpreterExprDataTableInterpreter extends InterpreterBase {
  public InterpreterExprDataTableInterpreter() {
    init();
  }

  @Override
  public String getCategory() {
    return "arithmetic";
  }

  protected void populateEvaluators(List<? extends IEvaluator> evaluators) {
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.DataSelector$93, "r:89176fdb-d82d-4aff-bf8a-34653f6eb29d(org.iets3.core.expr.data.interpreter.plugin)/231307155598889134", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          return node;
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("DataSelector()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("DataSelector", "http://127.0.0.1:63320/node?ref=ae4fef68-fa9e-417d-b45f-6b9a02e7cac2%2Fi%3A10000001%28org.iets3.core.expr.data.interpreter%40transient82%2Forg.iets3.core.expr.data.interpreter.plugin%400%29%2F231307155598889134");
      }

      @Override
      public String toString() {
        return "DataSelector";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.DataRowOp$U1, "r:89176fdb-d82d-4aff-bf8a-34653f6eb29d(org.iets3.core.expr.data.interpreter.plugin)/231307155598829737", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          return SLinkOperations.getTarget(node, LINKS.row$H2K_);
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("DataRowOp()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("DataRowOp", "http://127.0.0.1:63320/node?ref=ae4fef68-fa9e-417d-b45f-6b9a02e7cac2%2Fi%3A10000001%28org.iets3.core.expr.data.interpreter%40transient82%2Forg.iets3.core.expr.data.interpreter.plugin%400%29%2F231307155598829737");
      }

      @Override
      public String toString() {
        return "DataRowOp";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.DataColOp$I4, "r:89176fdb-d82d-4aff-bf8a-34653f6eb29d(org.iets3.core.expr.data.interpreter.plugin)/231307155598832189", true) {
      public Object evaluateEvaluator(final SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          SNode ctx = as_a3h39u_a0a3a0a0a0a0a2a4(MapSequence.fromMap(context.getEnvironment()).get(IDotTarget__BehaviorDescriptor.contextExpression_id6zmBjqUivyF.invoke(node)), SNode.class);
          if (SNodeOperations.isInstanceOf(ctx, CONCEPTS.DataRow$M3)) {
            SNode r = (SNode) ctx;
            SNode value = SLinkOperations.getTarget(ListSequence.fromList(SLinkOperations.getChildren(r, LINKS.cells$lhZ4)).findFirst((it) -> SLinkOperations.getTarget(it, LINKS.col$bcAI) == SLinkOperations.getTarget(node, LINKS.col$6EpK)), LINKS.value$exyO);
            if (value == null) {
              return new DefaultNix();
            }
            return context.getRootInterpreter().evaluate(value, context, coverage, trace, false);
          }
          return null;
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("DataColOp()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("DataColOp", "http://127.0.0.1:63320/node?ref=ae4fef68-fa9e-417d-b45f-6b9a02e7cac2%2Fi%3A10000001%28org.iets3.core.expr.data.interpreter%40transient82%2Forg.iets3.core.expr.data.interpreter.plugin%400%29%2F231307155598832189");
      }

      @Override
      public String toString() {
        return "DataColOp";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.DataTableLookUp$fU, "r:89176fdb-d82d-4aff-bf8a-34653f6eb29d(org.iets3.core.expr.data.interpreter.plugin)/512624657164194776", true) {
      public Object evaluateEvaluator(SNode node, final IContext context, final ICoverageAnalyzer coverage, final ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          {
            SNode ctx = as_a3h39u_a0a0a3a0a0a0a0a3a4(MapSequence.fromMap(context.getEnvironment()).get(IDotTarget__BehaviorDescriptor.contextExpression_id6zmBjqUivyF.invoke(node)), SNode.class);
            if (SNodeOperations.isInstanceOf(ctx, CONCEPTS.DataSelector$93)) {
              final Object searchValue = ((Object) castUp(context.getRootInterpreter().evaluate(SLinkOperations.getTarget(node, LINKS.expr$CW3E), context, coverage, trace, false), Object.class));
              SNode s = (SNode) ctx;
              final Wrappers._T<SNode> columnToLookUp = new Wrappers._T<SNode>();
              if (SLinkOperations.getTarget(node, LINKS.col$ut41) != null) {
                columnToLookUp.value = SLinkOperations.getTarget(SLinkOperations.getTarget(node, LINKS.col$ut41), LINKS.col$fpG3);
              } else {
                columnToLookUp.value = SLinkOperations.getTarget(SLinkOperations.getTarget(SLinkOperations.getTarget(s, LINKS.table$WyyI), LINKS.defaultLookupColumn$TWBX), LINKS.col$fpG3);
              }
              Tuples._2<SNode, SNode> found = ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(s, LINKS.table$WyyI), LINKS.rows$1pKa)).select((it) -> MultiTuple.<SNode,SNode>from(it, ListSequence.fromList(SLinkOperations.getChildren(it, LINKS.cells$lhZ4)).findFirst((cell) -> Objects.equals(SLinkOperations.getTarget(cell, LINKS.col$bcAI), columnToLookUp.value)))).findFirst((it) -> EqualsHelper.equals(context.getRootInterpreter().evaluate(SLinkOperations.getTarget(it._1(), LINKS.value$exyO), context, coverage, trace, false), searchValue));
              if (found != null) {
                return found._0();
              }
            }
            return new DefaultNix();
          }
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("lookUpBy()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("DataTableLookUp", "http://127.0.0.1:63320/node?ref=ae4fef68-fa9e-417d-b45f-6b9a02e7cac2%2Fi%3A10000001%28org.iets3.core.expr.data.interpreter%40transient82%2Forg.iets3.core.expr.data.interpreter.plugin%400%29%2F512624657164194776");
      }

      @Override
      public String toString() {
        return "DataTableLookUp";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
    ListSequence.fromList(((List<IEvaluator>) evaluators)).addElement(new ConceptEvaluatorBase(CONCEPTS.DataIsInTarget$PR, "r:89176fdb-d82d-4aff-bf8a-34653f6eb29d(org.iets3.core.expr.data.interpreter.plugin)/4073179274524005709", true) {
      public Object evaluateEvaluator(SNode node, IContext context, ICoverageAnalyzer coverage, ComputationTrace trace) {
        try {
          coverage.visitedEvaluator(this);
          coverage.visitedConcept(this.concept);
          coverage.visitedConcept(SNodeOperations.getConcept(node));
          SNode ctx = as_a3h39u_a0a3a0a0a0a0a4a4(MapSequence.fromMap(context.getEnvironment()).get(IDotTarget__BehaviorDescriptor.contextExpression_id6zmBjqUivyF.invoke(node)), SNode.class);
          if (SNodeOperations.isInstanceOf(ctx, CONCEPTS.DataRow$M3)) {
            SNode row = (SNode) ctx;
            return Sequence.fromIterable(SLinkOperations.collect(SLinkOperations.getChildren(node, LINKS.selectors$jSGg), LINKS.dataRow$Wb3T)).contains(row);
          }
          return null;
        } catch (StopAndReturnException stop) {
          return stop.value();
        } catch (InterpreterEscapeException ex) {
          throw ex;
        } catch (RuntimeException ex) {
          throw new InterpreterRuntimeException("is()", node, ex, trace);
        }
      }
      public EvaluatorInfo getInfo() {
        return new EvaluatorInfo("DataIsInTarget", "http://127.0.0.1:63320/node?ref=ae4fef68-fa9e-417d-b45f-6b9a02e7cac2%2Fi%3A10000001%28org.iets3.core.expr.data.interpreter%40transient82%2Forg.iets3.core.expr.data.interpreter.plugin%400%29%2F4073179274524005709");
      }

      @Override
      public String toString() {
        return "DataIsInTarget";
      }

      @Override
      public boolean canLookupBeCached() {
        return true;
      }
    });
  }


  protected void populateTypeMappers(List<? extends ITypeMapper> typeMappers) {
  }



  protected void populateRelationships(List<? extends IRelationship> relationships) {
  }
  private static <T> T as_a3h39u_a0a3a0a0a0a0a2a4(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_a3h39u_a0a0a3a0a0a0a0a3a4(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_a3h39u_a0a3a0a0a0a0a4a4(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept DataSelector$93 = MetaAdapterFactory.getConcept(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb71d69cL, "org.iets3.core.expr.data.structure.DataSelector");
    /*package*/ static final SConcept DataRowOp$U1 = MetaAdapterFactory.getConcept(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb7667f8L, "org.iets3.core.expr.data.structure.DataRowOp");
    /*package*/ static final SConcept DataRow$M3 = MetaAdapterFactory.getConcept(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb652889L, "org.iets3.core.expr.data.structure.DataRow");
    /*package*/ static final SConcept DataColOp$I4 = MetaAdapterFactory.getConcept(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb740273L, "org.iets3.core.expr.data.structure.DataColOp");
    /*package*/ static final SConcept DataTableLookUp$fU = MetaAdapterFactory.getConcept(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x71d3568e1587f82L, "org.iets3.core.expr.data.structure.DataTableLookUp");
    /*package*/ static final SConcept DataIsInTarget$PR = MetaAdapterFactory.getConcept(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x3886d6f8346755b7L, "org.iets3.core.expr.data.structure.DataIsInTarget");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink row$H2K_ = MetaAdapterFactory.getReferenceLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb7667f8L, 0x335c4a1eb766ba2L, "row");
    /*package*/ static final SContainmentLink cells$lhZ4 = MetaAdapterFactory.getContainmentLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb652889L, 0x335c4a1eb64cdd6L, "cells");
    /*package*/ static final SReferenceLink col$6EpK = MetaAdapterFactory.getReferenceLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb740273L, 0x335c4a1eb7406d8L, "col");
    /*package*/ static final SReferenceLink col$bcAI = MetaAdapterFactory.getReferenceLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb64ca38L, 0x335c4a1eb64d73eL, "col");
    /*package*/ static final SContainmentLink value$exyO = MetaAdapterFactory.getContainmentLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb64ca38L, 0x335c4a1eb64e24fL, "value");
    /*package*/ static final SContainmentLink expr$CW3E = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x3b256bb6ae8048d8L, 0x3b256bb6ae8048d9L, "expr");
    /*package*/ static final SContainmentLink col$ut41 = MetaAdapterFactory.getContainmentLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x71d3568e1587f82L, 0x7ac90020e5d1b3deL, "col");
    /*package*/ static final SReferenceLink col$fpG3 = MetaAdapterFactory.getReferenceLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x7ac90020e5d1a9cfL, 0x7ac90020e5d1a9d0L, "col");
    /*package*/ static final SReferenceLink table$WyyI = MetaAdapterFactory.getReferenceLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb71d69cL, 0x335c4a1eb71da44L, "table");
    /*package*/ static final SContainmentLink defaultLookupColumn$TWBX = MetaAdapterFactory.getContainmentLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb648aeeL, 0x7ac90020e5d2a54dL, "defaultLookupColumn");
    /*package*/ static final SContainmentLink rows$1pKa = MetaAdapterFactory.getContainmentLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x335c4a1eb648aeeL, 0x335c4a1eb677ef4L, "rows");
    /*package*/ static final SContainmentLink selectors$jSGg = MetaAdapterFactory.getContainmentLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x3886d6f8346755b7L, 0x3886d6f8346755baL, "selectors");
    /*package*/ static final SReferenceLink dataRow$Wb3T = MetaAdapterFactory.getReferenceLink(0xb25b8ad14d3d4e45L, 0x8c7872091b39fddaL, 0x3886d6f8346755bcL, 0x3886d6f834675f05L, "dataRow");
  }
}
