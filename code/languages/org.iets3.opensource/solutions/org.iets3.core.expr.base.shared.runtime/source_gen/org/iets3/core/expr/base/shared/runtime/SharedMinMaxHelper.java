package org.iets3.core.expr.base.shared.runtime;

/*Generated by MPS */

import java.util.Collection;
import java.util.Iterator;
import java.math.BigDecimal;
import java.math.BigInteger;

/**
 * This class is shared between interpreter and generator, be careful when introducing extra dependencies.
 */
public class SharedMinMaxHelper {

  public static Object max(Collection values, boolean isReal, Class nothingType) {
    if (isReal) {
      Iterator<Object> iterator = values.iterator();
      Object max = null;
      while (iterator.hasNext()) {
        Object next = iterator.next();
        Object element = null;
        if (next instanceof BigDecimal) {
          element = ((BigDecimal) next);
        } else if (next instanceof Number) {
          element = new BigDecimal(((Number) next).toString());
        } else if (nothingType != null && nothingType.isInstance(next)) {
          element = next;
        } else {
          throw new RuntimeException("Don't know how to cast element " + next.toString() + " to BigDecimal.");
        }
        if (max == null) {
          max = element;
        } else {
          if (nothingToDec(element, nothingType).compareTo(nothingToDec(max, nothingType)) > 0) {
            max = element;
          }
        }
      }
      if (max != null) {
        return max;
      }
      // max of the empty list (arbitrarily chosen as -Double.MAX_VALUE since there is no -INF in type BigDecimal)
      return BigDecimal.valueOf(-Double.MAX_VALUE);
    } else {
      Iterator<Object> iterator = values.iterator();
      Object max = null;
      while (iterator.hasNext()) {
        Object next = iterator.next();
        Object element = null;
        if (next instanceof BigInteger) {
          element = (BigInteger) next;
        } else if (next instanceof Number) {
          element = new BigInteger(next.toString());
        } else if (nothingType != null && nothingType.isInstance(next)) {
          element = next;
        } else {
          throw new RuntimeException("Don't know how to cast element " + next.toString() + " to BigInteger.");
        }
        if (max == null) {
          max = element;
        } else {
          if (nothingToInt(element, nothingType).compareTo(nothingToInt(max, nothingType)) > 0) {
            max = element;
          }
        }
      }
      if (max != null) {
        return max;
      }
      // max of the empty list (arbitrarily chosen as Long.MIN_VALUE since there is no -INF in type BigInteger)
      return BigInteger.valueOf(Long.MIN_VALUE);
    }
  }


  public static Object min(Collection values, boolean isReal, Class nothingType) {
    if (isReal) {
      Iterator<Object> iterator = values.iterator();
      Object min = null;
      while (iterator.hasNext()) {
        Object next = iterator.next();
        Object element = null;
        if (next instanceof BigDecimal) {
          element = ((BigDecimal) next);
        } else if (next instanceof Number) {
          element = new BigDecimal(((Number) next).toString());
        } else if (nothingType != null && nothingType.isInstance(next)) {
          element = next;
        } else {
          throw new RuntimeException("Don't know how to cast element " + next.toString() + " to BigDecimal.");
        }

        if (min == null) {
          min = element;
        } else {
          if (nothingToDec(element, nothingType).compareTo(nothingToDec(min, nothingType)) < 0) {
            min = element;
          }
        }
      }
      if (min != null) {
        return min;
      }
      // min of the empty list (arbitrarily chosen as Double.MAX_VALUE since there is no INF in type BigDecimal)
      return BigDecimal.valueOf(Double.MAX_VALUE);
    } else {
      Iterator<Object> iterator = values.iterator();
      Object min = null;
      while (iterator.hasNext()) {
        Object next = iterator.next();
        Object element = null;
        if (next instanceof BigInteger) {
          element = (BigInteger) next;
        } else if (next instanceof Number) {
          element = new BigInteger(next.toString());
        } else if (nothingType != null && nothingType.isInstance(next)) {
          element = next;
        } else {
          throw new RuntimeException("Don't know how to cast element " + next.toString() + " to BigInteger.");
        }

        if (min == null) {
          min = element;
        } else {
          if (nothingToInt(element, nothingType).compareTo(nothingToInt(min, nothingType)) < 0) {
            min = element;
          }
        }
      }
      if (min != null) {
        return min;
      }
      // min of the empty list (arbitrarily chosen as Long.MAX_VALUE since there is no INF in type BigInteger)
      return BigInteger.valueOf(Long.MAX_VALUE);
    }
  }

  public static BigInteger nothingToInt(Object value, Class nothingClass) {
    if (nothingClass == null) {
      return (BigInteger) value;
    }
    if (nothingClass.isInstance(value)) {
      return new BigInteger("0");
    }
    return (BigInteger) value;
  }
  public static BigDecimal nothingToDec(Object value, Class nothingClass) {
    if (nothingClass == null) {
      return new BigDecimal(value.toString());
    }
    if (nothingClass.isInstance(value)) {
      return new BigDecimal("0");
    }
    if (value instanceof BigInteger) {
      return new BigDecimal("0");
    }
    return (BigDecimal) value;
  }

}
