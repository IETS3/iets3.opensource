package org.iets3.core.expr.tracing.plugin.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.traceExplorer.plugin.INodeMapper;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.Map;
import org.iets3.core.expr.lambda.behavior.ShortLambdaExpression__BehaviorDescriptor;
import org.iets3.core.expr.lambda.behavior.LambdaExpression__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.IMapping;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class TracedNodeMapper implements INodeMapper {

  @Override
  public SNode getMappedNodeOrGivenNode(final SNode givenNode) {
    if (givenNode == null) {
      return null;
    }
    SNode node = givenNode;
    SNode lambdaNode = SNodeOperations.getNodeAncestor(node, CONCEPTS.LambdaExpression$64, true, false);
    SNode shortLambdaNode = SNodeOperations.getNodeAncestor(node, CONCEPTS.ShortLambdaExpression$Xg, true, false);
    if (lambdaNode == null && shortLambdaNode == null) {
      return givenNode;
    }
    SNode returnNode = givenNode;
    Map<SNode, SNode> m = ((lambdaNode == null) ? ShortLambdaExpression__BehaviorDescriptor.getNodeMapping_id5s__jxDLZVE.invoke(shortLambdaNode) : LambdaExpression__BehaviorDescriptor.getNodeMapping_id3u8VfJfplfS.invoke(lambdaNode));
    if (m != null) {
      IMapping<SNode, SNode> mv = MapSequence.fromMap(m).findFirst((it) -> it.value() == givenNode);
      if (mv != null) {
        returnNode = getMappedNodeOrGivenNode(mv.key());
      }
    }
    return returnNode;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept LambdaExpression$64 = MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x68d69d36ba520706L, "org.iets3.core.expr.lambda.structure.LambdaExpression");
    /*package*/ static final SConcept ShortLambdaExpression$Xg = MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x68d69d36ba587cb6L, "org.iets3.core.expr.lambda.structure.ShortLambdaExpression");
  }
}
