package org.iets3.core.expr.tracing.plugin.plugin;

/*Generated by MPS */

import com.mbeddr.mpsutil.traceExplorer.plugin.TraceTabOptions;
import com.intellij.openapi.project.Project;
import jetbrains.mps.project.MPSProject;
import javax.swing.Icon;
import com.mbeddr.mpsutil.traceExplorer.plugin.ITraceRecord;
import com.intellij.openapi.fileEditor.FileEditorManager;
import java.util.function.Consumer;
import javax.swing.JComponent;
import org.iets3.core.expr.plugin.plugin.Disposables;
import com.mbeddr.mpsutil.traceExplorer.plugin.TraceRecordTreeCellRenderer;
import org.iets3.core.expr.plugin.plugin.InterpreterValueHighlighter;

public class DefaultTraceTabOptionsFactory implements ITraceTabOptionFactory {

  @Override
  public TraceTabOptions createTraceTabOption(Project ideaProject, MPSProject mpsProject, String title, Icon icon, ITraceRecord rootTraceRecord) {
    InterpreterUserObjectDecorator decorator = new InterpreterUserObjectDecorator(mpsProject.getRepository(), FileEditorManager.getInstance(ideaProject));
    decorator.setNodeMapper(new TracedNodeMapper());
    final TraceTabOptions options = new TraceTabOptions(title, rootTraceRecord, decorator);
    options.disposer = new Consumer<JComponent>() {
      @Override
      public void accept(JComponent component) {
        Disposables.remove(component);
      }
    };
    options.renderer = new TraceRecordTreeCellRenderer(new InterpreterRecordRenderer(mpsProject.getRepository()));
    options.pin = true;
    options.showDetailPane = true;
    options.tabIcon = icon;
    options.setNodeMapper(decorator.getNodeMapper());
    options.allToolButtonsVisible();
    options.hideToolButtons(new TraceTabOptions.ToolButtonEnum[]{TraceTabOptions.ToolButtonEnum.NextTrace, TraceTabOptions.ToolButtonEnum.Rerun});

    options.codeHighlighter = new InterpreterCodeHighlighter(mpsProject.getRepository(), FileEditorManager.getInstance(ideaProject));
    options.valueHighlighter = new InterpreterValueHighlighter(mpsProject.getRepository(), FileEditorManager.getInstance(ideaProject));
    return options;
  }
}
