package org.iets3.variability.artifacts.base.behavior;

/*Generated by MPS */

import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.Optional;

public class StateStore {
  private static final String KEY = "STATE_STORE";

  /*package*/ Map<ArtifactPath, PresenceConditionValue> states = MapSequence.fromMap(new HashMap<ArtifactPath, PresenceConditionValue>());

  public static StateStore get(SNode vp) {
    Object obj = vp.getUserObject(KEY);
    if (obj != null && obj instanceof StateStore) {
      return (StateStore) obj;
    }

    // no valid StateStore available, create one
    StateStore store = new StateStore();
    vp.putUserObject(KEY, store);
    return store;
  }

  public static void clear(SNode vp) {
    vp.putUserObject(KEY, null);
  }

  /*package*/ StateStore() {
  }

  public void setState(ArtifactPath ap, Optional<Boolean> ternaryState) {
    if (ternaryState.isEmpty()) {
      MapSequence.fromMap(states).put(ap, PresenceConditionValue.UNDEFINED);
    } else {
      if (ternaryState.get()) {
        MapSequence.fromMap(states).put(ap, PresenceConditionValue.TRUE);
      } else {
        MapSequence.fromMap(states).put(ap, PresenceConditionValue.FALSE);
      }
    }
  }

  public PresenceConditionValue getState(ArtifactPath ap) {
    return MapSequence.fromMap(states).get(ap);
  }

  public PresenceConditionValue getStateForSomePath() {
    if (MapSequence.fromMap(states).isEmpty()) {
      return null;
    }
    return MapSequence.fromMap(states).first().value();
  }
}
