package org.iets3.variability.artifacts.base.plugin;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.highlighter.EditorComponentCreateListener;
import com.intellij.util.messages.MessageBusConnection;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.Optional;
import com.intellij.openapi.project.Project;
import org.iets3.analysis.solversupport.util.plugin.ProjectUtil;

public class EditorListenerManager {
  private final EditorComponentCreateListener listener;

  private boolean connected = false;
  private MessageBusConnection connection;

  public EditorListenerManager(EditorComponentCreateListener listener) {
    this.listener = listener;
  }

  public boolean connect(SNode anyNode) {
    Optional<Project> project = ProjectUtil.project(anyNode);
    Optional<Project> proj = project;
    if (proj.isEmpty()) {
      return false;
    }
    subscribeListener(proj.get());
    return true;
  }

  private void subscribeListener(Project project) throws IllegalStateException {
    if (connected) {
      return;
    }
    connection = project.getMessageBus().connect();
    connection.subscribe(EditorComponentCreateListener.EDITOR_COMPONENT_CREATION, listener);
    connected = true;
  }

  public void disconnect() {
    if (connected) {
      connection.disconnect();
      connected = false;
    }
  }
}
