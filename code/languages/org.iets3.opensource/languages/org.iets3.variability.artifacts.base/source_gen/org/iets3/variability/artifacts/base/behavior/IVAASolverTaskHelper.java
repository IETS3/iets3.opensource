package org.iets3.variability.artifacts.base.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import org.iets3.analysis.base.plugin.STF;
import org.iets3.variability.artifacts.base.plugin.IArtifactAlgorithms;
import java.util.Optional;

public class IVAASolverTaskHelper {

  public static SNode createSolverTask(SNode ivaa) {
    // create standard SolverTask from IVAA
    SNode st = STF.createSolverTask(ivaa, "artifactCheck");

    // add custom checks
    addCustomChecks(ivaa, st);

    // return specific SolverTask with custom checks
    return st;
  }

  private static void addCustomChecks(final SNode ivaa, SNode st) {
    // TODO AbstractSolverTask should have a method which returns an Optional of 'ISolverCheck'
    // TODO then we would not need to instantiated 'SolverCheck' and also 'SolverTask' would be obsolete

    // allow specific artifact language to add custom solver checks for this artifact
    final IArtifactAlgorithms algorithms = IArtifactAlgorithms.instance();
    Optional<ISolverCheckExtender> solverCheckExtenderMaybe = algorithms.solverCheckExtenderFor(st);
    solverCheckExtenderMaybe.ifPresent((solverCheck) -> {
      // TODO We need to trigger the building of SkeletonNodes again in case of TestCases. The original model-nodes
      // have been copied over without userObjects. Then 'SkeletonNode.enclosingSkelNode(n) cannot work.
      algorithms.skeletonTreeBuilder().buildTree(ivaa);

      // now call application code to add custom checks
      IVariabilityAwareArtifact__BehaviorDescriptor.addCustomChecks_idfr_H$y6Dum.invoke(ivaa, solverCheck);
    });
  }
}
