package org.iets3.variability.artifacts.base.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.Sequence;

public class TransitiveDepsComputer {

  public static Iterable<SNode> compute(SNode start, _FunctionTypes._return_P1_E0<? extends Iterable<SNode>, ? super SNode> directDepComputer) {
    TransitiveDepsComputer inst = new TransitiveDepsComputer(directDepComputer);
    return inst.getTransitiveDeps(start);
  }

  private _FunctionTypes._return_P1_E0<? extends Iterable<SNode>, ? super SNode> directDepComputer;

  private TransitiveDepsComputer(_FunctionTypes._return_P1_E0<? extends Iterable<SNode>, ? super SNode> directDepComputer) {
    this.directDepComputer = directDepComputer;
  }

  public Iterable<SNode> getTransitiveDeps(SNode start) {
    Set<SNode> visited = SetSequence.fromSet(new HashSet<SNode>());
    getDepsTransitiveRec(start, visited);
    return visited;
  }

  private void getDepsTransitiveRec(SNode ivaa, Set<SNode> visited) {
    Iterable<SNode> dependencies = directDepComputer.invoke(ivaa);
    if (dependencies == null) {
      return;
    }
    for (SNode cn : Sequence.fromIterable(dependencies)) {
      if (!(SetSequence.fromSet(visited).contains(cn))) {
        SetSequence.fromSet(visited).addElement(cn);
        getDepsTransitiveRec(cn, visited);
      }
    }
  }
}
