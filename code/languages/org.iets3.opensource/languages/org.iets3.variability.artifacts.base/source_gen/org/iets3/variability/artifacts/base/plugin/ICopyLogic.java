package org.iets3.variability.artifacts.base.plugin;

/*Generated by MPS */

import java.util.Map;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.Collections;
import java.util.Collection;
import java.util.HashMap;
import jetbrains.mps.smodel.CopyUtil;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;

/**
 * Copy logic used in IVAA Filtering.
 * Useful when you need to copy before filtering, when you need to use the gencontext to make the generation process traceable.
 */
public interface ICopyLogic {

  /**
   * This method is useful for creating an instance from 'templateNode'.
   * After instance creation 'instantionOftemplateNode' must reference this instance.
   * Any 'expression' which referenced a internal declaration of the templateNode must be adopted. It should now point to 
   * internals of the instance copy.
   * 
   * @param templateNode nodes to be copied
   * @param instantionOftemplateNode node representing instantiation
   * @return a mapping from original nodes to copied ones
   */
  default Map<SNode, SNode> copy(SNode templateNode, SNode instantionOftemplateNode) {
    return this.copy(Collections.singletonList(templateNode));
  }

  @Deprecated
  Map<SNode, SNode> copy(Collection<SNode> nodeCollection);

  static ICopyLogic defaultCopyLogic() {
    return new ICopyLogic() {

      @Override
      public Map<SNode, SNode> copy(Collection<SNode> nodeCollection) {
        HashMap<SNode, SNode> mapping = new HashMap<SNode, SNode>();
        CopyUtil.copy(CollectionSequence.fromCollection(nodeCollection).toList(), mapping);
        return mapping;
      }
    };
  }
}
