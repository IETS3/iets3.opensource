package org.iets3.variability.artifacts.base.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;

public class NodeHashUtil {
  /**
   * <p>Helper function for computing short unique identifier from node-id.</p>
   * 
   * <p>The identifier will be represented as 6-digit hexadecimal code.
   * The purpose of this function is to compute human-friendly solver variable names.</p>
   * 
   * @param n the node to be identified
   * @return the 6-digit hex unique identifier
   */
  public static String shortId(SNode n) {
    final int requiredLen = 6;
    String longId = "" + n.getNodeId();
    int len = longId.length();
    if (len == 0) {
      return "0".repeat(requiredLen);
    }

    // djb2 hash function (applied on reverse string as the prefixes are often very similar)
    int h = 5381;
    for (int i = len - 1; i >= 0; i--) {
      h = ((h << 5) + h) + longId.charAt(i);
    }

    // convert to six-digit hex string
    String hex = Integer.toHexString(h);
    int hexlen = hex.length();
    int delta = hexlen - requiredLen;
    if (delta > 0) {
      return hex.substring(delta);
    } else if (delta == 0) {
      return hex;
    }

    // if hex value is shorter than 6 digits (very unlikely!), fill it with trailing zeros
    return hex + "0".repeat(-delta);
  }

}
