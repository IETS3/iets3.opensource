package org.iets3.core.expr.lambda.plugin;

/*Generated by MPS */

import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import com.mbeddr.mpsutil.interpreter.rt.IContext;
import com.mbeddr.mpsutil.interpreter.rt.ICoverageAnalyzer;
import com.mbeddr.mpsutil.interpreter.rt.ComputationTrace;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.interpreter.rt.IInterpreter;

public abstract class ExecutableValue {

  protected List<Object> boundValues = ListSequence.fromList(new ArrayList<Object>());

  public abstract Object executeEvaluated(List<Object> evaluatedArgs, IContext context, ICoverageAnalyzer coverage, ComputationTrace contextTrace, boolean stopOnStop);

  public Object executeEvaluatedOneArg(Object theOneArg, IContext context, ICoverageAnalyzer coverage, ComputationTrace contextTrace, boolean stopOnStop) {
    return executeEvaluated(Sequence.fromIterable(Sequence.<Object>singleton(theOneArg)).toList(), context, coverage, contextTrace, stopOnStop);
  }

  public ExecutableValue bindValue(Object val, IContext ctx, ICoverageAnalyzer coverage) {
    ExecutableValue copy = copy(ctx, coverage);
    ListSequence.fromList(copy.boundValues).addElement(val);
    return copy;
  }

  public abstract ExecutableValue copy(IContext ctx, ICoverageAnalyzer coverage);

  public Object executeNonEvaluated(List<SNode> nonEvaluatedArgs, final IContext context, final ICoverageAnalyzer coverage, ComputationTrace contextTrace, final boolean stopOnStop) {
    final IInterpreter interpreter = context.getRootInterpreter();
    List<Object> evaluatedArgs = ListSequence.fromList(nonEvaluatedArgs).select((it) -> interpreter.evaluate(it, context, coverage, null, stopOnStop)).toList();
    return executeEvaluated(evaluatedArgs, context, coverage, contextTrace, stopOnStop);
  }

}
