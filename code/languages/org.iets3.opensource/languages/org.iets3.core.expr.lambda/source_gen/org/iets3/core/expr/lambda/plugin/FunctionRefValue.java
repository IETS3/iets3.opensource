package org.iets3.core.expr.lambda.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import com.mbeddr.mpsutil.interpreter.rt.IContext;
import com.mbeddr.mpsutil.interpreter.rt.ICoverageAnalyzer;
import java.util.List;
import com.mbeddr.mpsutil.interpreter.rt.ComputationTrace;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class FunctionRefValue extends ExecutableValue {

  public SNode fun = null;

  public FunctionRefValue(SNode fr) {
    fun = fr;
  }

  @Override
  public String toString() {
    String bv = "";
    if (ListSequence.fromList(this.boundValues).isNotEmpty()) {
      bv = boundValues + "";
    }
    return "<funref " + SPropertyOperations.getString(this.fun, PROPS.name$MnvL) + bv + ">";
  }


  public ExecutableValue copy(IContext ctx, ICoverageAnalyzer coverage) {
    FunctionRefValue copy = new FunctionRefValue(fun);
    ListSequence.fromList(copy.boundValues).addSequence(ListSequence.fromList(this.boundValues));
    return copy;
  }

  public Object executeEvaluated(List<Object> evaluatedArgs, IContext context, ICoverageAnalyzer coverage, ComputationTrace contextTrace, boolean stopOnStop) {
    context.pushEnvironment(fun, null);
    int argIdx = 0;
    for (int i = 0; i < ListSequence.fromList(boundValues).count(); i++) {
      context.getEnvironment().put(ListSequence.fromList(SLinkOperations.getChildren(fun, LINKS.args$XOIh)).getElement(argIdx), ListSequence.fromList(boundValues).getElement(i));
      argIdx++;
    }
    for (int i = 0; i < ListSequence.fromList(evaluatedArgs).count(); i++) {
      context.getEnvironment().put(ListSequence.fromList(SLinkOperations.getChildren(fun, LINKS.args$XOIh)).getElement(argIdx), ListSequence.fromList(evaluatedArgs).getElement(i));
      argIdx++;
    }
    ComputationTrace tt = new ComputationTrace(fun, true);
    contextTrace.addChild(tt);
    Object res = context.getRootInterpreter().evaluate(SLinkOperations.getTarget(fun, LINKS.body$Y8TB), context, coverage, tt, stopOnStop);
    tt.setValue(res);
    context.popEnvironment(fun);
    return res;
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink args$XOIh = MetaAdapterFactory.getContainmentLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523083b8a2fL, 0x427ce523083b8a3fL, "args");
    /*package*/ static final SContainmentLink body$Y8TB = MetaAdapterFactory.getContainmentLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523083b8a2fL, 0x427ce523083b8a56L, "body");
  }
}
