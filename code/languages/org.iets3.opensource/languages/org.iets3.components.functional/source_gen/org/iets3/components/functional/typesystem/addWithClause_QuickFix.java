package org.iets3.components.functional.typesystem;

/*Generated by MPS */

import jetbrains.mps.errors.QuickFix_Runtime;
import jetbrains.mps.smodel.SNodePointer;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.typechecking.TypecheckingFacade;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class addWithClause_QuickFix extends QuickFix_Runtime {
  public addWithClause_QuickFix() {
    super(new SNodePointer("r:985fefa7-5d4c-42b7-93bc-4c518f91e5f2(org.iets3.components.functional.typesystem)", "7747466534774070868"));
  }
  public String getDescription(SNode node) {
    final SNode ct = SLinkOperations.getTarget(((SNode) addWithClause_QuickFix.this.getField("item")[0]), LINKS.configurationType$RzNW);
    SNode component = SNodeOperations.getNodeAncestor(((SNode) addWithClause_QuickFix.this.getField("port")[0]), CONCEPTS.Component$gR, false, false);
    Iterable<SNode> applicableParams = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.collectMany(SNodeOperations.ofConcept(SLinkOperations.getChildren(component, LINKS.contents$i4tX), CONCEPTS.ComponentInterface$x0), LINKS.content$b2Os), CONCEPTS.Parameter$HZ)).where((it) -> TypecheckingFacade.getFromContext().isSubtype(TypecheckingFacade.getFromContext().getTypeOf(it), ct));
    if (Sequence.fromIterable(applicableParams).count() == 1) {
      return "Configure with Parameter (" + SPropertyOperations.getString(Sequence.fromIterable(applicableParams).first(), PROPS.name$MnvL) + ")";
    }
    return "Add with Clause";
  }
  public void execute(SNode node) {
    final SNode ct = SLinkOperations.getTarget(((SNode) addWithClause_QuickFix.this.getField("item")[0]), LINKS.configurationType$RzNW);
    SNode component = SNodeOperations.getNodeAncestor(((SNode) addWithClause_QuickFix.this.getField("port")[0]), CONCEPTS.Component$gR, false, false);
    Iterable<SNode> applicableParams = Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.collectMany(SNodeOperations.ofConcept(SLinkOperations.getChildren(component, LINKS.contents$i4tX), CONCEPTS.ComponentInterface$x0), LINKS.content$b2Os), CONCEPTS.Parameter$HZ)).where((it) -> TypecheckingFacade.getFromContext().isSubtype(TypecheckingFacade.getFromContext().getTypeOf(it), ct));
    if (Sequence.fromIterable(applicableParams).count() == 1) {
      SLinkOperations.setTarget(((SNode) addWithClause_QuickFix.this.getField("port")[0]), LINKS.type$5Gl6, createPortWithConfiguration_tdy2g8_a0a0d0c(SNodeOperations.deleteNode(SLinkOperations.getTarget(((SNode) addWithClause_QuickFix.this.getField("port")[0]), LINKS.type$5Gl6)), Sequence.fromIterable(applicableParams).first()));
    } else {
      SLinkOperations.setTarget(((SNode) addWithClause_QuickFix.this.getField("port")[0]), LINKS.type$5Gl6, createPortWithConfiguration_tdy2g8_a0a0a3a2(SNodeOperations.deleteNode(SLinkOperations.getTarget(((SNode) addWithClause_QuickFix.this.getField("port")[0]), LINKS.type$5Gl6))));
    }
  }
  private static SNode createPortWithConfiguration_tdy2g8_a0a0d0c(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.PortWithConfiguration$kT);
    n0.forChild(LINKS.wrapped$gKEw).initNode(p0, CONCEPTS.IPortType$DL, true);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.value$GOOo).init(CONCEPTS.ParamRef$Pq);
      n1.setReferenceTarget(LINKS.param$OsyV, p1);
    }
    return n0.getResult();
  }
  private static SNode createPortWithConfiguration_tdy2g8_a0a0a3a2(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.PortWithConfiguration$kT);
    n0.forChild(LINKS.wrapped$gKEw).initNode(p0, CONCEPTS.IPortType$DL, true);
    n0.forChild(LINKS.value$GOOo).initNull();
    return n0.getResult();
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink configurationType$RzNW = MetaAdapterFactory.getContainmentLink(0x257976063fb647b8L, 0xbc3cb4384df7da44L, 0x6c4f9fd23e4bfa58L, 0x6b8487c3fa500cc7L, "configurationType");
    /*package*/ static final SContainmentLink contents$i4tX = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e484601L, 0x6c4f9fd23e48465cL, "contents");
    /*package*/ static final SContainmentLink content$b2Os = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x848759e25dd4535L, 0x848759e25dd49e6L, "content");
    /*package*/ static final SContainmentLink type$5Gl6 = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e51937cL, 0x6c4f9fd23e566372L, "type");
    /*package*/ static final SContainmentLink wrapped$gKEw = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x4528ba6ebfa56b3cL, 0x4528ba6ebfa56b79L, "wrapped");
    /*package*/ static final SContainmentLink value$GOOo = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x4528ba6ebfa56b3cL, 0x4528ba6ebfa59535L, "value");
    /*package*/ static final SReferenceLink param$OsyV = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x3ce7d4897415d6b2L, 0x3ce7d4897415d6b3L, "param");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Component$gR = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e484601L, "org.iets3.components.core.structure.Component");
    /*package*/ static final SConcept ComponentInterface$x0 = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x848759e25dd4535L, "org.iets3.components.core.structure.ComponentInterface");
    /*package*/ static final SConcept Parameter$HZ = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a1a079bL, "org.iets3.components.core.structure.Parameter");
    /*package*/ static final SConcept PortWithConfiguration$kT = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x4528ba6ebfa56b3cL, "org.iets3.components.core.structure.PortWithConfiguration");
    /*package*/ static final SInterfaceConcept IPortType$DL = MetaAdapterFactory.getInterfaceConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e566371L, "org.iets3.components.core.structure.IPortType");
    /*package*/ static final SConcept ParamRef$Pq = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x3ce7d4897415d6b2L, "org.iets3.components.core.structure.ParamRef");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
