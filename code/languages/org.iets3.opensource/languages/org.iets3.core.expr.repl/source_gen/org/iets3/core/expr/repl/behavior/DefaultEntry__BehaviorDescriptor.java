package org.iets3.core.expr.repl.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SNode;
import org.iets3.core.expr.base.plugin.IDiffable;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.iets3.core.base.behavior.ICanStoreCheckResult__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.editor.runtime.selection.SelectionUtil;
import jetbrains.mps.openapi.editor.selection.SelectionManager;
import org.iets3.core.expr.base.plugin.CVH;
import com.mbeddr.mpsutil.interpreter.rt.IRequiresSnapshot;
import org.iets3.core.expr.base.plugin.ConstraintFailedException;
import com.mbeddr.mpsutil.interpreter.rt.InvalidValueException;
import org.iets3.core.expr.base.plugin.NoneValue;
import jetbrains.mps.typechecking.TypecheckingFacade;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public final class DefaultEntry__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, "org.iets3.core.expr.repl.structure.DefaultEntry");

  public static final SMethod<Boolean> isStructurallyValid_id14RJwd1gWJt = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("isStructurallyValid").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1240669143553002461L).languageId(0xa7c1ffddc4b39be1L, 0x18001c9433a74f68L).build2();
  public static final SMethod<Void> runManually_id3R3AIvumrTm = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("runManually").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4450571177430728278L).languageId(0xbd9c05c0f8725a35L, 0x7b68d745a7b848b9L).build2(SMethodBuilder.createJavaParameter(EditorContext.class, ""));
  public static final SMethod<Boolean> mustBeRunManually_id3R3AIvumAZH = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("mustBeRunManually").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4450571177430773741L).languageId(0xbd9c05c0f8725a35L, 0x7b68d745a7b848b9L).build2();
  public static final SMethod<Boolean> highlightError_id4b4fYXfo1HZ = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("highlightError").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4811040598999964543L).languageId(0xbd9c05c0f8725a35L, 0x7b68d745a7b848b9L).build2();
  public static final SMethod<String> allowsEffectForNode_idORfz$DS6Ap = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("allowsEffectForNode").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(952298261448780185L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));
  public static final SMethod<ReplResult> evaluateEntry_id4nY0kF8p1AF = new SMethodBuilder<ReplResult>(new SJavaCompoundTypeImpl(ReplResult.class)).name("evaluateEntry").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5043470053402745259L).languageId(0xa7c1ffddc4b39be1L, 0x18001c9433a74f68L).build2();
  public static final SMethod<Boolean> isReferenceable_id2QxWJFK_S9T = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("isReferenceable").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3288176362549379705L).languageId(0xa7c1ffddc4b39be1L, 0x18001c9433a74f68L).build2();
  public static final SMethod<Boolean> isReadOnly_id4nY0kF8uh7w = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("isReadOnly").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5043470053404119520L).languageId(0xa7c1ffddc4b39be1L, 0x18001c9433a74f68L).build2();
  public static final SMethod<Boolean> doNotShowManualInfoMessage_id2jITtfD$0No = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("doNotShowManualInfoMessage").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(2661317128141933784L).languageId(0xbd9c05c0f8725a35L, 0x7b68d745a7b848b9L).build2();
  public static final SMethod<IDiffable> findPredecessor_id2UfkHNj5e$2 = new SMethodBuilder<IDiffable>(new SJavaCompoundTypeImpl(IDiffable.class)).name("findPredecessor").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(3354991355801954562L).languageId(0xa7c1ffddc4b39be1L, 0x18001c9433a74f68L).build2(SMethodBuilder.createJavaParameter(IDiffable.class, ""));

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(isStructurallyValid_id14RJwd1gWJt, runManually_id3R3AIvumrTm, mustBeRunManually_id3R3AIvumAZH, highlightError_id4b4fYXfo1HZ, allowsEffectForNode_idORfz$DS6Ap, evaluateEntry_id4nY0kF8p1AF, isReferenceable_id2QxWJFK_S9T, isReadOnly_id4nY0kF8uh7w, doNotShowManualInfoMessage_id2jITtfD$0No, findPredecessor_id2UfkHNj5e$2);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static boolean isStructurallyValid_id14RJwd1gWJt(@NotNull SNode __thisNode__) {
    SNode e = SLinkOperations.getTarget(__thisNode__, LINKS.expression$3Lmy);
    if (e == null) {
      return false;
    }
    return ListSequence.fromList(SNodeOperations.getNodeDescendants(e, null, true, new SAbstractConcept[]{})).any((it) -> SNodeOperations.getConcept(it) != CONCEPTS.Expression$D_);
  }
  /*package*/ static void runManually_id3R3AIvumrTm(@NotNull SNode __thisNode__, EditorContext edCtxOrNull) {
    if (SPropertyOperations.getBoolean(SNodeOperations.getNodeAncestor(__thisNode__, CONCEPTS.REPL$Y7, false, false), PROPS.updateDownstream$WBIX)) {
      IReplEntry__BehaviorDescriptor.evaluateEntryWithDownstreamUpdates_id4nY0kF8seDJ.invoke(__thisNode__);
    } else {
      IReplEntry__BehaviorDescriptor.evaluateEntry_id4nY0kF8p1AF.invoke(__thisNode__);
    }
    SNode last = ListSequence.fromList(SLinkOperations.getChildren(SNodeOperations.cast(SNodeOperations.getParent(__thisNode__), CONCEPTS.REPL$Y7), LINKS.entries$77qo)).where((it) -> !(SNodeOperations.isInstanceOf(it, CONCEPTS.IEmpty$6_))).last();
    if (__thisNode__ == last && ((boolean) ICanStoreCheckResult__BehaviorDescriptor.hasExistingResult_id3R3AIvumwpO.invoke(__thisNode__))) {
      SNode e = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, "org.iets3.core.expr.repl.structure.DefaultEntry"));
      SNodeOperations.insertNextSiblingChild(last, e);
      if (edCtxOrNull != null) {
        SelectionUtil.selectCell(edCtxOrNull, e, SelectionManager.FIRST_ERROR_CELL);
      }
    }
  }
  /*package*/ static boolean mustBeRunManually_id3R3AIvumAZH(@NotNull SNode __thisNode__) {
    return true;
  }
  /*package*/ static boolean highlightError_id4b4fYXfo1HZ(@NotNull SNode __thisNode__) {
    return false;
  }
  /*package*/ static String allowsEffectForNode_idORfz$DS6Ap(@NotNull SNode __thisNode__, SNode n) {
    return null;
  }
  /*package*/ static ReplResult evaluateEntry_id4nY0kF8p1AF(@NotNull SNode __thisNode__) {
    ReplResult result = new ReplResult();
    SNode repl = SNodeOperations.getNodeAncestor(__thisNode__, CONCEPTS.REPL$Y7, false, false);
    long begin = System.currentTimeMillis();
    if (((boolean) DefaultEntry__BehaviorDescriptor.isStructurallyValid_id14RJwd1gWJt.invoke(__thisNode__))) {
      try {
        CVH.overrideWithException = true;
        result.actual = REPL__BehaviorDescriptor.eval_id7bd8pklc9b_.invoke(repl, __thisNode__);
        if (result.actual instanceof IRequiresSnapshot) {
          result.actual = ((IRequiresSnapshot) result.actual).createSnapshot();
          result.isSnapshot = true;
        }
      } catch (ConstraintFailedException ex) {
        result.actual = "<constraint failed>";
        result.errorMessage = "constraint failed <" + ex.msg + ">";
        ex.printStackTrace();
      } catch (InvalidValueException ex) {
        result.actual = "<invalid value>";
        result.errorMessage = "invalid value <" + ex.msg + ">";
        ex.printStackTrace();
      } finally {
        CVH.overrideWithException = false;
      }
      long end = System.currentTimeMillis();
      result.time = end - begin;
      ICanStoreCheckResult__BehaviorDescriptor.storeLastResult_id3R3AIvuq5Dp.invoke(__thisNode__, result);
      SPropertyOperations.assign(__thisNode__, PROPS.hasBeenEvaled$3tFR, true);
      SPropertyOperations.assign(__thisNode__, PROPS.hasError$tcpL, !(result.isOk()));
      SPropertyOperations.assign(__thisNode__, PROPS.referenceable$NUs_, !(result.actual instanceof NoneValue));
      return result;
    }
    return null;
  }
  /*package*/ static boolean isReferenceable_id2QxWJFK_S9T(@NotNull SNode __thisNode__) {
    return !(SNodeOperations.isInstanceOf(TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(__thisNode__, LINKS.expression$3Lmy)), CONCEPTS.VoidType$BF));
  }
  /*package*/ static boolean isReadOnly_id4nY0kF8uh7w(@NotNull SNode __thisNode__) {
    if (SPropertyOperations.getBoolean(SNodeOperations.getNodeAncestor(__thisNode__, CONCEPTS.REPL$Y7, false, false), PROPS.updateDownstream$WBIX)) {
      return false;
    }
    return SPropertyOperations.getBoolean(__thisNode__, PROPS.hasBeenEvaled$3tFR);
  }
  /*package*/ static boolean doNotShowManualInfoMessage_id2jITtfD$0No(@NotNull SNode __thisNode__) {
    return true;
  }
  /*package*/ static IDiffable findPredecessor_id2UfkHNj5e$2(@NotNull SNode __thisNode__, IDiffable curr) {
    Iterable<SNode> prevEntries = SNodeOperations.ofConcept(ListSequence.fromList(SNodeOperations.getPrevSiblings(__thisNode__, false)).reversedList(), CONCEPTS.DefaultEntry$YA);
    for (SNode e : Sequence.fromIterable(prevEntries)) {
      Object act = ((ReplResult) ICanStoreCheckResult__BehaviorDescriptor.getLastResult_id3R3AIvumwq7.invoke(e)).actual;
      if (act instanceof IDiffable && ((IDiffable) act).id().equals(curr.id())) {
        return (IDiffable) act;
      }
    }
    return null;
  }

  /*package*/ DefaultEntry__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((Boolean) isStructurallyValid_id14RJwd1gWJt(node));
      case 1:
        runManually_id3R3AIvumrTm(node, (EditorContext) parameters[0]);
        return null;
      case 2:
        return (T) ((Boolean) mustBeRunManually_id3R3AIvumAZH(node));
      case 3:
        return (T) ((Boolean) highlightError_id4b4fYXfo1HZ(node));
      case 4:
        return (T) ((String) allowsEffectForNode_idORfz$DS6Ap(node, (SNode) parameters[0]));
      case 5:
        return (T) ((ReplResult) evaluateEntry_id4nY0kF8p1AF(node));
      case 6:
        return (T) ((Boolean) isReferenceable_id2QxWJFK_S9T(node));
      case 7:
        return (T) ((Boolean) isReadOnly_id4nY0kF8uh7w(node));
      case 8:
        return (T) ((Boolean) doNotShowManualInfoMessage_id2jITtfD$0No(node));
      case 9:
        return (T) ((IDiffable) findPredecessor_id2UfkHNj5e$2(node, (IDiffable) parameters[0]));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink expression$3Lmy = MetaAdapterFactory.getContainmentLink(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, 0x1137be034140821dL, "expression");
    /*package*/ static final SContainmentLink entries$77qo = MetaAdapterFactory.getContainmentLink(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408208L, 0x2b59af57f917e7f5L, "entries");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Expression$D_ = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x670d5e92f854a047L, "org.iets3.core.expr.base.structure.Expression");
    /*package*/ static final SConcept REPL$Y7 = MetaAdapterFactory.getConcept(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408208L, "org.iets3.core.expr.repl.structure.REPL");
    /*package*/ static final SInterfaceConcept IEmpty$6_ = MetaAdapterFactory.getInterfaceConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0xe900768cf47dcc3L, "com.mbeddr.core.base.structure.IEmpty");
    /*package*/ static final SConcept VoidType$BF = MetaAdapterFactory.getConcept(0xf3061a5392264cc5L, 0xa443f952ceaf5816L, 0xf8cc6bf96dL, "jetbrains.mps.baseLanguage.structure.VoidType");
    /*package*/ static final SConcept DefaultEntry$YA = MetaAdapterFactory.getConcept(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, "org.iets3.core.expr.repl.structure.DefaultEntry");
  }

  private static final class PROPS {
    /*package*/ static final SProperty updateDownstream$WBIX = MetaAdapterFactory.getProperty(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408208L, 0x45fe014ac86d1a98L, "updateDownstream");
    /*package*/ static final SProperty hasBeenEvaled$3tFR = MetaAdapterFactory.getProperty(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, 0x2b59af57f92854cbL, "hasBeenEvaled");
    /*package*/ static final SProperty hasError$tcpL = MetaAdapterFactory.getProperty(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, 0x42c43fef4f5bef22L, "hasError");
    /*package*/ static final SProperty referenceable$NUs_ = MetaAdapterFactory.getProperty(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, 0x2da1f2faf0968141L, "referenceable");
  }
}
