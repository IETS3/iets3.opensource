package org.iets3.core.expr.repl.intentions;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.smodel.action.SNodeFactoryOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import org.iets3.core.expr.repl.behavior.IReplEntry__BehaviorDescriptor;
import org.iets3.core.expr.repl.behavior.REPL__BehaviorDescriptor;
import jetbrains.mps.openapi.navigation.NavigationSupport;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class REPLOpenHelper {


  public static void openREPL(SNode n, EditorContext editorCtx) {
    SModel m = SNodeOperations.getModel(n);
    SNode r = SNodeOperations.getContainingRoot(n);
    SNode repl = SNodeFactoryOperations.createNewNode(CONCEPTS.REPL$Y7, null);
    SPropertyOperations.assign(repl, PROPS.virtualPackage$EkXl, SPropertyOperations.getString(r, PROPS.virtualPackage$EkXl));
    if (ListSequence.fromList(SLinkOperations.getChildren(repl, LINKS.entries$77qo)).isEmpty()) {
      SLinkOperations.addNewChild(repl, LINKS.entries$77qo, CONCEPTS.DefaultEntry$YA);
    }
    if (SNodeOperations.isInstanceOf(r, CONCEPTS.INamedConcept$Kd)) {
      SPropertyOperations.assign(repl, PROPS.name$MnvL, SPropertyOperations.getString(SNodeOperations.cast(r, CONCEPTS.INamedConcept$Kd), PROPS.name$MnvL) + "_repl_" + ListSequence.fromList(SModelOperations.roots(m, CONCEPTS.REPL$Y7)).count() + "");
    } else {
      SPropertyOperations.assign(repl, PROPS.name$MnvL, "repl_" + ListSequence.fromList(SModelOperations.roots(m, CONCEPTS.REPL$Y7)).count() + "");
    }
    SLinkOperations.setTarget(repl, LINKS.sourceNode$DY$O, n);
    if (SNodeOperations.isInstanceOf(r, CONCEPTS.IVisibleElementProvider$$O)) {
      SLinkOperations.setTarget(repl, LINKS.sourceScope$Eq$N, SNodeOperations.cast(r, CONCEPTS.IVisibleElementProvider$$O));
    }
    SModelOperations.addRootNode(m, repl);
    SNode first = SNodeOperations.cast(ListSequence.fromList(SLinkOperations.getChildren(repl, LINKS.entries$77qo)).first(), CONCEPTS.DefaultEntry$YA);
    SLinkOperations.setTarget(SNodeOperations.cast(first, CONCEPTS.DefaultEntry$YA), LINKS.expression$3Lmy, SNodeOperations.copyNode(n));
    IReplEntry__BehaviorDescriptor.evaluateEntry_id4nY0kF8p1AF.invoke(SNodeOperations.cast(first, CONCEPTS.DefaultEntry$YA));
    SNode second = REPL__BehaviorDescriptor.addEntry_id69FYpZqzT5W.invoke(repl, editorCtx);
    NavigationSupport.getInstance().openNode(editorCtx.getOperationContext().getProject(), second, true, false);

  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept REPL$Y7 = MetaAdapterFactory.getConcept(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408208L, "org.iets3.core.expr.repl.structure.REPL");
    /*package*/ static final SConcept DefaultEntry$YA = MetaAdapterFactory.getConcept(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, "org.iets3.core.expr.repl.structure.DefaultEntry");
    /*package*/ static final SInterfaceConcept INamedConcept$Kd = MetaAdapterFactory.getInterfaceConcept(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, "jetbrains.mps.lang.core.structure.INamedConcept");
    /*package*/ static final SInterfaceConcept IVisibleElementProvider$$O = MetaAdapterFactory.getInterfaceConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x6315bcc6eff580a3L, "com.mbeddr.core.base.structure.IVisibleElementProvider");
  }

  private static final class PROPS {
    /*package*/ static final SProperty virtualPackage$EkXl = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x10802efe25aL, 0x115eca8579fL, "virtualPackage");
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink entries$77qo = MetaAdapterFactory.getContainmentLink(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408208L, 0x2b59af57f917e7f5L, "entries");
    /*package*/ static final SReferenceLink sourceNode$DY$O = MetaAdapterFactory.getReferenceLink(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408208L, 0x3ace85bc92d6fb0aL, "sourceNode");
    /*package*/ static final SReferenceLink sourceScope$Eq$N = MetaAdapterFactory.getReferenceLink(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408208L, 0x72cd219515100060L, "sourceScope");
    /*package*/ static final SContainmentLink expression$3Lmy = MetaAdapterFactory.getContainmentLink(0x18001c9433a74f68L, 0xa7c1ffddc4b39be1L, 0x1137be0341408209L, 0x1137be034140821dL, "expression");
  }
}
