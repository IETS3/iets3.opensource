package org.iets3.variability.configuration.base.plugin;

/*Generated by MPS */

import org.iets3.core.base.behavior.IResult;
import java.util.Collection;
import org.apache.commons.lang3.tuple.Pair;
import org.jetbrains.mps.openapi.model.SNode;
import com.google.common.collect.Lists;
import java.util.List;
import org.iets3.analysis.solversupport.util.plugin.FixedValueCategory;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import java.util.Collections;
import com.google.common.collect.ImmutableList;
import java.util.Map;
import com.google.common.collect.ImmutableMap;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.Optional;
import org.apache.commons.lang3.builder.ToStringBuilder;
import org.apache.commons.lang3.builder.ToStringStyle;

/**
 * Value Object which values (selectionStates, Attribute) should be set.
 */
public class ConfigFixedValues {
  private final IResult failResult;

  private Collection<Pair<SNode, SNode>> expressionForFeatureAttributeAssignment = Lists.newLinkedList();
  private List<Pair<FixedValueCategory, SNode>> fixedValueCategoryForSelectionState = Lists.newLinkedList();


  public ConfigFixedValues(Collection<Pair<SNode, SNode>> valuesForAttributes, Collection<Pair<FixedValueCategory, SNode>> valuesForSelectionState) {
    this(null, valuesForAttributes, valuesForSelectionState);
  }

  private ConfigFixedValues(IResult failResult, Collection<Pair<SNode, SNode>> valuesForAttributes, Collection<Pair<FixedValueCategory, SNode>> valuesForSelectionState) {
    this.failResult = failResult;
    this.expressionForFeatureAttributeAssignment = valuesForAttributes;
    this.fixedValueCategoryForSelectionState = CollectionSequence.fromCollection(valuesForSelectionState).toList();
  }

  public ConfigFixedValues(IResult failResult) {
    this(failResult, Collections.<Pair<SNode, SNode>>emptyList(), Collections.<Pair<FixedValueCategory, SNode>>emptyList());
  }

  public Collection<Pair<SNode, SNode>> expressionForFeatureAttributeAssignment() {
    return ImmutableList.copyOf(this.expressionForFeatureAttributeAssignment);
  }

  public Collection<Pair<FixedValueCategory, SNode>> fixedValueCategoryForSelectionState() {
    return ImmutableList.copyOf(this.fixedValueCategoryForSelectionState);
  }

  public Map<SNode, FixedValueCategory> mapOfConfigurationToFixedValue() {
    return ImmutableMap.copyOf(ListSequence.fromList(this.fixedValueCategoryForSelectionState).select((it) -> Pair.of(it.getRight(), it.getLeft())));
  }

  public Map<SNode, SNode> mapOfAttributeAssignmentToFixedValue() {
    return ImmutableMap.copyOf(CollectionSequence.fromCollection(this.expressionForFeatureAttributeAssignment).select((it) -> Pair.of(it.getRight(), it.getLeft())));
  }

  public ConfigFixedValues() {
    this(null);
  }


  public Optional<String> errorMessage() {
    return Optional.ofNullable(this.failResult).map((failResult) -> "Solver failed. Solve errors manually. " + "( " + failResult.getErrorMessage() + " )");
  }

  @Override
  public String toString() {
    return new ToStringBuilder(this, ToStringStyle.MULTI_LINE_STYLE).append(failResult).append(this.expressionForFeatureAttributeAssignment).append(this.fixedValueCategoryForSelectionState).toString();
  }
}
