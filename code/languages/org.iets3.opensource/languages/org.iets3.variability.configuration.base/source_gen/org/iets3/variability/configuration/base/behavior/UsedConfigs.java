package org.iets3.variability.configuration.base.behavior;

/*Generated by MPS */

import java.util.Map;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import com.mbeddr.mpsutil.interpreter.rt.IEnvironment;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class UsedConfigs {
  private Map<SNode, SNode> actualConfigs = MapSequence.fromMap(new HashMap<SNode, SNode>());

  public UsedConfigs(SNode fmc) {
    Sequence.fromIterable(FeatureModelConfiguration__BehaviorDescriptor.getValidUsedConfigs_id3j7vM_E99Ji.invoke(fmc)).visitAll((it) -> MapSequence.fromMap(actualConfigs).put(SLinkOperations.getTarget(it, LINKS.param$pwLK), SLinkOperations.getTarget(it, LINKS.config$SCsb)));
  }

  public UsedConfigs() {
  }

  public void add(Iterable<SNode> params, final _FunctionTypes._return_P1_E0<? extends SNode, ? super SNode> resolver) {
    Sequence.fromIterable(params).visitAll((p) -> {
      SNode result = resolver.invoke(p);
      if ((result != null)) {
        MapSequence.fromMap(actualConfigs).put(p, result);
      }
    });
  }

  public void storeInEnv(final IEnvironment env) {
    SetSequence.fromSet(MapSequence.fromMap(actualConfigs).keySet()).visitAll((param) -> {
      if ((MapSequence.fromMap(actualConfigs).get(param) != null)) {
        env.put(param, MapSequence.fromMap(actualConfigs).get(param));
      }
    });
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink param$pwLK = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x7d6d839c2865b139L, 0x7d6d839c2866af76L, "param");
    /*package*/ static final SReferenceLink config$SCsb = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x7d6d839c2865b139L, 0x7d6d839c2866b1ceL, "config");
  }
}
