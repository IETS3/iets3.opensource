package org.iets3.variability.configuration.base.constraints;

/*Generated by MPS */

import jetbrains.mps.smodel.runtime.base.BaseConstraintsDescriptor;
import jetbrains.mps.smodel.runtime.ConstraintsDescriptorInitContext;
import jetbrains.mps.smodel.runtime.base.BasePropertyConstraintsDescriptor;
import jetbrains.mps.smodel.runtime.ConstraintsDescriptor;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.iets3.variability.featuremodel.base.behavior.ICalculateHashForUpdateWarning__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SEnumOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SEnumerationLiteral;
import jetbrains.mps.smodel.runtime.base.BaseReferenceConstraintsDescriptor;
import org.iets3.variability.configuration.base.behavior.FeatureModelConfiguration__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.iets3.variability.featuremodel.base.behavior.FeatureModel__BehaviorDescriptor;
import org.iets3.variability.configuration.base.plugin.FeatureModelConfigurationConstraintsUtil;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.smodel.runtime.ReferenceScopeProvider;
import jetbrains.mps.smodel.runtime.base.BaseScopeProvider;
import org.jetbrains.mps.openapi.model.SNodeReference;
import jetbrains.mps.smodel.SNodePointer;
import jetbrains.mps.scope.Scope;
import jetbrains.mps.smodel.runtime.ReferenceConstraintsContext;
import jetbrains.mps.scope.ListScope;
import com.mbeddr.core.base.behavior.IVisibleElementProvider__BehaviorDescriptor;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class FeatureModelConfiguration_Constraints extends BaseConstraintsDescriptor {
  /*package*/ FeatureModelConfiguration_Constraints(ConstraintsDescriptorInitContext initContext) {
    super(CONCEPTS.FeatureModelConfiguration$nE, initContext);
    record(new Abstract_PD(this));
    record(new SelectionState_PD(this));
    record(new RD1(this));
  }

  /*package*/ static final class Abstract_PD extends BasePropertyConstraintsDescriptor {
    public Abstract_PD(ConstraintsDescriptor container) {
      super(PROPS.abstract$Wu4W, container, false, true, false);
    }
    @Override
    public void setPropertyValue(SNode node, Object propertyValue) {
      staticSetPropertyValue(node, SPropertyOperations.castBoolean(propertyValue));
    }
    private static void staticSetPropertyValue(SNode node, boolean propertyValue) {
      if (propertyValue == true) {
        ICalculateHashForUpdateWarning__BehaviorDescriptor.updateUpdateHash_id6MJy$PGs_q4.invoke(node);
      }
      SPropertyOperations.set(node, PROPS.abstract$Wu4W, propertyValue);
    }
  }
  /*package*/ static final class SelectionState_PD extends BasePropertyConstraintsDescriptor {
    public SelectionState_PD(ConstraintsDescriptor container) {
      super(PROPS.selectionState$zbc1, container, true, true, false);
    }
    @Override
    public Object getValue(SNode node) {
      // the root of a configuration is always true, either userTrue (without "extends") or inheritedTrue (with "extends")
      return ((SLinkOperations.getTarget(SLinkOperations.getTarget(node, LINKS.extendedFMC$tFbw), LINKS.config$ID3f) == null) ? SEnumOperations.getMember(MetaAdapterFactory.getEnumeration(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x5db06c237c250a73L, "org.iets3.variability.featuremodel.base.structure.FeatureSelectionState"), 0x5db06c237c250a7cL, "userTrue") : SEnumOperations.getMember(MetaAdapterFactory.getEnumeration(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x5db06c237c250a73L, "org.iets3.variability.featuremodel.base.structure.FeatureSelectionState"), 0x283134ce3ea4cb79L, "inheritedTrue"));
    }
    @Override
    public void setPropertyValue(SNode node, Object propertyValue) {
      staticSetPropertyValue(node, SPropertyOperations.castEnummember(propertyValue));
    }
    private static void staticSetPropertyValue(SNode node, SEnumerationLiteral propertyValue) {
      // do nothing
    }
  }
  /*package*/ static final class RD1 extends BaseReferenceConstraintsDescriptor {
    /*package*/ RD1(ConstraintsDescriptor container) {
      super(LINKS.targetFeature$16lA, container, true, true);
    }
    @Override
    public boolean validate(final SNode referenceNode, final SNode oldReferentNode, final SNode newReferentNode) {
      return true;
    }
    @Override
    public void onReferenceSet(final SNode referenceNode, final SNode oldReferentNode, final SNode newReferentNode) {
      FeatureModelConfiguration__BehaviorDescriptor.removeError_id5UDdUfokHMF.invoke(referenceNode);
      SPropertyOperations.assign(referenceNode, PROPS.complete$4SB6, false);
      SLinkOperations.setTarget(referenceNode, LINKS.targetFeature$16lA, newReferentNode);
      SPropertyOperations.assignEnum(referenceNode, PROPS.selectionState$zbc1, SEnumOperations.getMember(MetaAdapterFactory.getEnumeration(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x5db06c237c250a73L, "org.iets3.variability.featuremodel.base.structure.FeatureSelectionState"), 0x5db06c237c250a7cL, "userTrue"));
      {
        final SNode feature = newReferentNode;
        if (SNodeOperations.isInstanceOf(feature, CONCEPTS.FeatureTreeNode$HV)) {

          if ((boolean) FeatureModel__BehaviorDescriptor.containsCycle_id3eg222GEqlF.invoke(SNodeOperations.getNodeAncestor(feature, CONCEPTS.FeatureModel$X0, false, false))) {
            SLinkOperations.setTarget(referenceNode, LINKS.content$Wdfq, createFeatureConfigurationErrorContent_1p7wel_a0a0a1a4a2e());
          } else {
            if (SNodeOperations.isInstanceOf(feature, CONCEPTS.FeatureModelInclude$Iq)) {
              SLinkOperations.setTarget(referenceNode, LINKS.content$Wdfq, createFeatureModelConfigurationBase_1p7wel_a0a0a0a0b0e0c4());
            } else {
              SLinkOperations.setTarget(referenceNode, LINKS.content$Wdfq, FeatureModelConfigurationConstraintsUtil.configContentByFeature(feature));
            }
          }
        }
      }
      ICalculateHashForUpdateWarning__BehaviorDescriptor.updateUpdateHash_id6MJy$PGs_q4.invoke(referenceNode);
      FeatureModelConfiguration__BehaviorDescriptor.updateAdaptHash_id2XyYtG$Jnmi.invoke(referenceNode);
      SPropertyOperations.set(referenceNode, PROPS.complete$4SB6, true);
    }
    @Nullable
    @Override
    public ReferenceScopeProvider getScopeProvider() {
      return new BaseScopeProvider() {
        @Override
        public SNodeReference getSearchScopeValidatorNode() {
          return new SNodePointer("r:0d1cebdb-8269-43d0-8b4a-0de6a8cc0d82(org.iets3.variability.configuration.base.constraints)", "6698472021570800031");
        }
        @Override
        public Scope createScope(final ReferenceConstraintsContext _context) {
          return ListScope.forResolvableElements(SLinkOperations.collect(SNodeOperations.ofConcept(IVisibleElementProvider__BehaviorDescriptor.visibleContentsOfTypeAsSequence_id3g6LnlWuSo8.invoke(SNodeOperations.getNodeAncestor(_context.getContextNode(), CONCEPTS.IVisibleElementProvider$$O, true, false), CONCEPTS.FeatureModel$X0), CONCEPTS.FeatureModel$X0), LINKS.root$XEj1));
        }
      };
    }
    private static SNode createFeatureConfigurationErrorContent_1p7wel_a0a0a1a4a2e() {
      SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.FeatureConfigurationErrorContent$W0);
      return n0.getResult();
    }
    private static SNode createFeatureModelConfigurationBase_1p7wel_a0a0a0a0b0e0c4() {
      SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.FeatureModelConfigurationBase$y8);
      return n0.getResult();
    }
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept FeatureModelConfiguration$nE = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479ec915L, "org.iets3.variability.configuration.base.structure.FeatureModelConfiguration");
    /*package*/ static final SConcept FeatureTreeNode$HV = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc475172167L, "org.iets3.variability.featuremodel.base.structure.FeatureTreeNode");
    /*package*/ static final SConcept FeatureModel$X0 = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc47516a211L, "org.iets3.variability.featuremodel.base.structure.FeatureModel");
    /*package*/ static final SConcept FeatureModelInclude$Iq = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc475172168L, "org.iets3.variability.featuremodel.base.structure.FeatureModelInclude");
    /*package*/ static final SInterfaceConcept IVisibleElementProvider$$O = MetaAdapterFactory.getInterfaceConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x6315bcc6eff580a3L, "com.mbeddr.core.base.structure.IVisibleElementProvider");
    /*package*/ static final SConcept FeatureConfigurationErrorContent$W0 = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x34aae17cd64425dbL, "org.iets3.variability.configuration.base.structure.FeatureConfigurationErrorContent");
    /*package*/ static final SConcept FeatureModelConfigurationBase$y8 = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x2e34d227ff954d8bL, "org.iets3.variability.configuration.base.structure.FeatureModelConfigurationBase");
  }

  private static final class PROPS {
    /*package*/ static final SProperty abstract$Wu4W = MetaAdapterFactory.getProperty(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479ec915L, 0x4617323a85e85324L, "abstract");
    /*package*/ static final SProperty selectionState$zbc1 = MetaAdapterFactory.getProperty(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddab8940L, 0x526bcda9b5a2fcdbL, "selectionState");
    /*package*/ static final SProperty complete$4SB6 = MetaAdapterFactory.getProperty(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479ec915L, 0x427f472315a4eeb9L, "complete");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink extendedFMC$tFbw = MetaAdapterFactory.getContainmentLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479ec915L, 0x4617323a864bd075L, "extendedFMC");
    /*package*/ static final SReferenceLink config$ID3f = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x4617323a864bd036L, 0x4617323a864bd049L, "config");
    /*package*/ static final SReferenceLink targetFeature$16lA = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddab8940L, 0x5cf5c0d0479ec91eL, "targetFeature");
    /*package*/ static final SContainmentLink content$Wdfq = MetaAdapterFactory.getContainmentLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddab8940L, 0x5cf5c0d0479f4bc8L, "content");
    /*package*/ static final SContainmentLink root$XEj1 = MetaAdapterFactory.getContainmentLink(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc47516a211L, 0x375cadc47516a30cL, "root");
  }
}
