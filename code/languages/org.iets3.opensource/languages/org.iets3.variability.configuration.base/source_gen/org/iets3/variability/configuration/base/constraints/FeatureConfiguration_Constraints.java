package org.iets3.variability.configuration.base.constraints;

/*Generated by MPS */

import jetbrains.mps.smodel.runtime.base.BaseConstraintsDescriptor;
import java.util.Map;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.runtime.ReferenceConstraintsDescriptor;
import jetbrains.mps.smodel.runtime.base.BaseReferenceConstraintsDescriptor;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.iets3.variability.featuremodel.base.behavior.AbstractFeature__BehaviorDescriptor;
import org.iets3.variability.featuremodel.base.behavior.FeatureTreeNode__BehaviorDescriptor;
import org.iets3.variability.configuration.base.behavior.AbstractFeatureConfiguration__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.HashMap;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class FeatureConfiguration_Constraints extends BaseConstraintsDescriptor {
  public FeatureConfiguration_Constraints() {
    super(CONCEPTS.FeatureConfiguration$x2);
  }

  @Override
  protected Map<SReferenceLink, ReferenceConstraintsDescriptor> getSpecifiedReferences() {
    BaseReferenceConstraintsDescriptor d0 = new BaseReferenceConstraintsDescriptor(LINKS.targetFeature$16lA, this, false, true) {
      @Override
      public boolean validate(final SNode referenceNode, final SNode oldReferentNode, final SNode newReferentNode) {
        return true;
      }
      @Override
      public void onReferenceSet(final SNode referenceNode, final SNode oldReferentNode, final SNode newReferentNode) {
        SLinkOperations.setTarget(referenceNode, LINKS.targetFeature$16lA, newReferentNode);
        // Leave Unspecified if is a reference
        {
          final SNode fmi = newReferentNode;
          if (SNodeOperations.isInstanceOf(fmi, CONCEPTS.FeatureModelInclude$Iq)) {
            SLinkOperations.setTarget(referenceNode, LINKS.content$Wdfq, createFeatureModelConfigurationBase_x68u8b_a0a0a2a1a0a0a0c());
            return;
          }
        }
        {
          final SNode fmi = newReferentNode;
          if (SNodeOperations.isInstanceOf(fmi, CONCEPTS.FeatureTreeNode$HV)) {
            SNode ifcc = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479f4bfcL, "org.iets3.variability.configuration.base.structure.InlineFeatureConfigurationContent"));
            for (SNode sf : Sequence.fromIterable(AbstractFeature__BehaviorDescriptor.subFeatures_id6GZHy357BW_.invoke(FeatureTreeNode__BehaviorDescriptor.effectiveFeature_id6GZHy352t67.invoke(fmi)))) {
              SNode fc = null;
              if ((SLinkOperations.getTarget(sf, LINKS.cardinality$EsDt) == null)) {
                fc = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479ec91dL, "org.iets3.variability.configuration.base.structure.FeatureConfiguration"));
              } else {
                fc = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x55c09a0155d9c97cL, "org.iets3.variability.configuration.base.structure.FeatureWithCardinalityConfiguration"));
              }
              AbstractFeatureConfiguration__BehaviorDescriptor.updateTargetFeatureAndSelectionState_id1ZxhL$Gfq9a.invoke(fc, sf);
              ListSequence.fromList(SLinkOperations.getChildren(ifcc, LINKS.subfeatureConfigurations$l9wi)).addElement(fc);

            }
            for (SNode attr : Sequence.fromIterable(AbstractFeature__BehaviorDescriptor.attributes_id6GZHy357BWb.invoke(FeatureTreeNode__BehaviorDescriptor.effectiveFeature_id6GZHy352t67.invoke(fmi)))) {
              SNode faa = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddc5ae16L, "org.iets3.variability.configuration.base.structure.FeatureAttributeAssignment"));
              SLinkOperations.setTarget(faa, LINKS.attribute$J5jI, attr);
              ListSequence.fromList(SLinkOperations.getChildren(ifcc, LINKS.attributeAssignments$seL5)).addElement(faa);
            }
            SLinkOperations.setTarget(referenceNode, LINKS.content$Wdfq, ifcc);
          }
        }
      }
    };
    Map<SReferenceLink, ReferenceConstraintsDescriptor> references = new HashMap<SReferenceLink, ReferenceConstraintsDescriptor>();
    references.put(d0.getReference(), d0);
    return references;
  }
  private static SNode createFeatureModelConfigurationBase_x68u8b_a0a0a2a1a0a0a0c() {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.FeatureModelConfigurationBase$y8);
    return n0.getResult();
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept FeatureConfiguration$x2 = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479ec91dL, "org.iets3.variability.configuration.base.structure.FeatureConfiguration");
    /*package*/ static final SConcept FeatureModelInclude$Iq = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc475172168L, "org.iets3.variability.featuremodel.base.structure.FeatureModelInclude");
    /*package*/ static final SConcept FeatureTreeNode$HV = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc475172167L, "org.iets3.variability.featuremodel.base.structure.FeatureTreeNode");
    /*package*/ static final SConcept FeatureModelConfigurationBase$y8 = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x2e34d227ff954d8bL, "org.iets3.variability.configuration.base.structure.FeatureModelConfigurationBase");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink targetFeature$16lA = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddab8940L, 0x5cf5c0d0479ec91eL, "targetFeature");
    /*package*/ static final SContainmentLink content$Wdfq = MetaAdapterFactory.getContainmentLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddab8940L, 0x5cf5c0d0479f4bc8L, "content");
    /*package*/ static final SContainmentLink cardinality$EsDt = MetaAdapterFactory.getContainmentLink(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc475172167L, 0x375cadc47519250cL, "cardinality");
    /*package*/ static final SContainmentLink subfeatureConfigurations$l9wi = MetaAdapterFactory.getContainmentLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479f4bfcL, 0x5cf5c0d0479ec91aL, "subfeatureConfigurations");
    /*package*/ static final SReferenceLink attribute$J5jI = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddc5ae16L, 0x302aa0c2ddca3d88L, "attribute");
    /*package*/ static final SContainmentLink attributeAssignments$seL5 = MetaAdapterFactory.getContainmentLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479f4bfcL, 0x302aa0c2ddc5ae13L, "attributeAssignments");
  }
}
