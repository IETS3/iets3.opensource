package org.iets3.variability.configuration.base.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.model.SModel;
import java.util.List;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class ConfigRelationFinder {

  public static Iterable<SNode> referencedOrUsedBy(SNode fmc) {
    return Sequence.fromIterable(referencedBy(fmc)).union(Sequence.fromIterable(usedBy(fmc))).distinct();
  }

  public static Iterable<SNode> referencedBy(SNode fmc) {
    return SLinkOperations.collect(SNodeOperations.getNodeDescendants(fmc, CONCEPTS.FeatureModelConfigurationRef$kq, false, new SAbstractConcept[]{}), LINKS.config$VWuN);
  }

  public static Iterable<SNode> usedBy(SNode fmc) {
    return SLinkOperations.collect(FeatureModelConfiguration__BehaviorDescriptor.getValidUsedConfigs_id3j7vM_E99Ji.invoke(fmc), LINKS.config$SCsb);
  }

  public static Iterable<SNode> allReferrers(SModel scope, SNode target) {
    return new ConfigRelationFinder(scope).allReferrers(target);
  }

  private final List<SNode> scope;

  public ConfigRelationFinder(SModel scope) {
    this.scope = SModelOperations.nodes(scope, CONCEPTS.FeatureModelConfiguration$nE);
  }

  public Iterable<SNode> allReferrers(SNode target) {
    return Sequence.fromIterable(referencing(target)).union(Sequence.fromIterable(using(target))).distinct();
  }

  public Iterable<SNode> referencing(final SNode target) {
    return ListSequence.fromList(scope).where((fmc) -> Sequence.fromIterable(referencedBy(fmc)).contains(target));
  }

  public Iterable<SNode> using(final SNode target) {
    return ListSequence.fromList(scope).where((fmc) -> Sequence.fromIterable(usedBy(fmc)).contains(target));
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept FeatureModelConfigurationRef$kq = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479eed6aL, "org.iets3.variability.configuration.base.structure.FeatureModelConfigurationRef");
    /*package*/ static final SConcept FeatureModelConfiguration$nE = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479ec915L, "org.iets3.variability.configuration.base.structure.FeatureModelConfiguration");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink config$VWuN = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479eed6aL, 0x5cf5c0d0479eed6bL, "config");
    /*package*/ static final SReferenceLink config$SCsb = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x7d6d839c2865b139L, 0x7d6d839c2866b1ceL, "config");
  }
}
