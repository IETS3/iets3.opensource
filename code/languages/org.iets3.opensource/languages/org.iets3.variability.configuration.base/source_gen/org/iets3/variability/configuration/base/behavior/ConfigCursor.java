package org.iets3.variability.configuration.base.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.Optional;
import org.iets3.variability.featuremodel.base.behavior.FeatureTreeNode__BehaviorDescriptor;
import java.util.Collection;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;

/**
 * Helper class to navigate around configurations.
 * 
 * This hides the intricacies of the configuration-AST.
 */
public class ConfigCursor {

  public static ConfigCursor create(SNode start) {
    return new ConfigCursor(start);
  }

  private final SNode location;

  protected ConfigCursor(SNode start) {
    this.location = start;
  }

  public SNode feature() {
    return SLinkOperations.getTarget(location, LINKS.targetFeature$16lA);
  }

  public SNode asNode() {
    return location;
  }

  public boolean isRoot() {
    return SNodeOperations.isInstanceOf(location, CONCEPTS.FeatureModelConfiguration$nE);
  }

  public Optional<SNode> asModel() {
    {
      final SNode fmc = location;
      if (SNodeOperations.isInstanceOf(fmc, CONCEPTS.FeatureModelConfiguration$nE)) {
        return Optional.of(fmc);
      }
    }
    return Optional.empty();
  }

  public SNode myRoot() {
    return (SNode) AbstractFeatureConfiguration__BehaviorDescriptor.configurationRoot_id6SMbav4Irm1.invoke(location);
  }

  public boolean isSubConfig() {
    return SNodeOperations.isInstanceOf(feature(), CONCEPTS.FeatureModelInclude$Iq);
  }

  public boolean isInlinedConfig() {
    return isSubConfig() && SNodeOperations.isInstanceOf(SLinkOperations.getTarget(location, LINKS.content$Wdfq), CONCEPTS.InlineFeatureConfigurationContent$P5);
  }

  public ConfigCursor parent() {
    return new ConfigCursor(SNodeOperations.cast(SNodeOperations.getParent(SNodeOperations.getParent(this.location)), CONCEPTS.AbstractFeatureConfiguration$3P));
  }

  public ConfigCursor ancestorWithOwnFM() {
    SNode current = location;
    do {
      current = parent(current);
    } while (!((boolean) FeatureTreeNode__BehaviorDescriptor.isRoot_id7Nu9WvXvoDo.invoke(SLinkOperations.getTarget(current, LINKS.targetFeature$16lA))));
    return new ConfigCursor(current);
  }

  public ConfigCursor ancestorWithEffectiveFM() {
    SNode current = location;
    do {
      current = parent(current);
    } while (!((boolean) FeatureTreeNode__BehaviorDescriptor.isRoot_id7Nu9WvXvoDo.invoke(FeatureTreeNode__BehaviorDescriptor.effectiveFeature_id6GZHy352t67.invoke(SLinkOperations.getTarget(current, LINKS.targetFeature$16lA)))));
    return new ConfigCursor(current);
  }

  public ConfigCursor findSubItem(SNode ftn) {
    return new ConfigCursor(AbstractFeatureConfiguration__BehaviorDescriptor.findConfiguration_id4zfp5i3BhvO.invoke(location, ftn));
  }

  private static SNode parent(SNode afc) {
    return SNodeOperations.cast(SNodeOperations.getParent(SNodeOperations.getParent(afc)), CONCEPTS.AbstractFeatureConfiguration$3P);
  }

  public Collection<ConfigCursor> subConfigs() {
    return Sequence.fromIterable(AbstractFeatureConfigurationContent__BehaviorDescriptor.effectiveChildConfigItems_id6jHrUgdscqV.invoke(SLinkOperations.getTarget(this.location, LINKS.content$Wdfq))).select((it) -> ConfigCursor.create(it)).toList();
  }

  public Iterable<SNode> attributeAssignments() {
    return (Iterable<SNode>) AbstractFeatureConfigurationContent__BehaviorDescriptor.attributeAssignments_id30ECcbtQl70.invoke(SLinkOperations.getTarget(this.location, LINKS.content$Wdfq));
  }

  @Override
  public String toString() {
    return SNodeOperations.present(this.location);
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink targetFeature$16lA = MetaAdapterFactory.getReferenceLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddab8940L, 0x5cf5c0d0479ec91eL, "targetFeature");
    /*package*/ static final SContainmentLink content$Wdfq = MetaAdapterFactory.getContainmentLink(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddab8940L, 0x5cf5c0d0479f4bc8L, "content");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept FeatureModelConfiguration$nE = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479ec915L, "org.iets3.variability.configuration.base.structure.FeatureModelConfiguration");
    /*package*/ static final SConcept FeatureModelInclude$Iq = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc475172168L, "org.iets3.variability.featuremodel.base.structure.FeatureModelInclude");
    /*package*/ static final SConcept InlineFeatureConfigurationContent$P5 = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x5cf5c0d0479f4bfcL, "org.iets3.variability.configuration.base.structure.InlineFeatureConfigurationContent");
    /*package*/ static final SConcept AbstractFeatureConfiguration$3P = MetaAdapterFactory.getConcept(0x71226ee2bbc445d2L, 0xa41d20b97237156cL, 0x302aa0c2ddab8940L, "org.iets3.variability.configuration.base.structure.AbstractFeatureConfiguration");
  }
}
