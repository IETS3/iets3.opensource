package org.iets3.variability.featuremodel.base.editor;

/*Generated by MPS */

import java.awt.Color;
import com.intellij.ui.JBColor;
import java.awt.Font;
import org.jetbrains.mps.openapi.module.SRepository;
import javax.swing.JLabel;
import org.jetbrains.mps.openapi.model.SNode;
import java.awt.Dimension;
import javax.swing.SwingConstants;
import java.awt.Cursor;
import java.awt.event.MouseAdapter;
import java.awt.event.MouseEvent;
import jetbrains.mps.nodeEditor.EditorSettings;

public abstract class FeatureConfigButton {
  private static Color dark = JBColor.LIGHT_GRAY;
  private static Color darker = JBColor.GRAY;
  private static Font font;
  private static int fontSize;
  private int buttonHeight = 9;
  private SRepository repository;

  public FeatureConfigButton(SRepository repository) {
    this.repository = repository;
  }

  public JLabel create(final SNode n, String label, Color backgroundColor, boolean opaque) {
    JLabel l = build(n, label.length(), backgroundColor, opaque);
    l.setText(label);
    return l;
  }

  protected JLabel build(final SNode n, int lengthInLetters, Color backgroundColor, boolean opaque) {
    int height = fontSize + this.buttonHeight;
    final Color background = backgroundColor;
    final JLabel l = new JLabel();
    l.setMinimumSize(new Dimension(0, height));

    int factor = fontSize - 5;
    l.setPreferredSize(new Dimension(20 + factor * lengthInLetters, height));
    l.setMaximumSize(new Dimension(300, height));
    l.setHorizontalAlignment(SwingConstants.CENTER);
    l.setVerticalAlignment(SwingConstants.CENTER);
    l.setVerticalTextPosition(JLabel.CENTER);
    l.setOpaque(opaque);
    l.setFont(l.getFont().deriveFont(Font.BOLD));

    l.setBackground(background);
    l.setForeground(darker);
    l.setCursor(new Cursor(Cursor.HAND_CURSOR));

    final SRepository repo = this.repository;
    l.addMouseListener(new MouseAdapter() {
      public void mousePressed(MouseEvent p0) {
        l.setBackground(dark);
      }

      public void mouseReleased(MouseEvent p0) {
        l.setBackground(background);
        repo.getModelAccess().executeCommand(() -> perform(n));
      }
    });

    return l;
  }

  public abstract void perform(SNode n);

  static {
    EditorSettings ei = EditorSettings.getInstance();
    fontSize = ei.getFontSize() - 5;
    font = new Font(ei.getFontFamily(), Font.BOLD, fontSize);
    // TODO: font should be used somewhere
  }
}
