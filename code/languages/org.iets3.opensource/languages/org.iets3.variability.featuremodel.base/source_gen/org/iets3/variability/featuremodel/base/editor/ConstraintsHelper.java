package org.iets3.variability.featuremodel.base.editor;

/*Generated by MPS */

import java.util.Set;
import java.util.Map;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.Collection;
import com.google.common.collect.ImmutableListMultimap;
import com.google.common.collect.Multimaps;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;

public class ConstraintsHelper {


  public static Set<Map.Entry<SNode, Collection<SNode>>> group2Constraints(Iterable<SNode> constraints) {
    ImmutableListMultimap<SNode, SNode> group2Constraints = Multimaps.index(Sequence.fromIterable(constraints).where((constraint) -> (SLinkOperations.getTarget(SLinkOperations.getTarget(new IAttributeDescriptor.NodeAttribute(CONCEPTS.ConstraintGroupAnnotation$IO).get(constraint), LINKS.groupRef$eCvW), LINKS.group$BceS) != null)), (SNode constraint) -> SLinkOperations.getTarget(SLinkOperations.getTarget(new IAttributeDescriptor.NodeAttribute(CONCEPTS.ConstraintGroupAnnotation$IO).get(constraint), LINKS.groupRef$eCvW), LINKS.group$BceS));

    Set<Map.Entry<SNode, Collection<SNode>>> group2ConstraintEntry = group2Constraints.asMap().entrySet();
    return group2ConstraintEntry;
  }

  public static void attachConstraintsToGroup(Set<Map.Entry<SNode, Collection<SNode>>> group2Constraints) {
    SetSequence.fromSet(group2Constraints).visitAll((it) -> {
      SNode base = it.getKey();
      base.putUserObject("groupConstraints", it.getValue());
    });
  }

  public static Collection<SNode> constraintsOf(SNode group) {
    Collection<SNode> groupConstraints = (Collection<SNode>) group.getUserObject("groupConstraints");
    return groupConstraints;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ConstraintGroupAnnotation$IO = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x6d20ecb3d752405cL, "org.iets3.variability.featuremodel.base.structure.ConstraintGroupAnnotation");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink groupRef$eCvW = MetaAdapterFactory.getContainmentLink(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x6d20ecb3d752405cL, 0x6d20ecb3d7692a09L, "groupRef");
    /*package*/ static final SReferenceLink group$BceS = MetaAdapterFactory.getReferenceLink(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x6d20ecb3d769275cL, 0x6d20ecb3d7524143L, "group");
  }
}
