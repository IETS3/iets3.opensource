package org.iets3.variability.featuremodel.base.intentions;

/*Generated by MPS */

import jetbrains.mps.intentions.AbstractIntentionDescriptor;
import jetbrains.mps.openapi.intentions.IntentionFactory;
import jetbrains.mps.openapi.intentions.Kind;
import jetbrains.mps.smodel.SNodePointer;
import java.util.Collection;
import jetbrains.mps.openapi.intentions.IntentionExecutable;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import java.util.Objects;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.intentions.AbstractIntentionExecutable;
import jetbrains.mps.openapi.intentions.ParameterizedIntentionExecutable;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.openapi.intentions.IntentionDescriptor;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public final class AddConstraintGroup_Intention extends AbstractIntentionDescriptor implements IntentionFactory {

  public AddConstraintGroup_Intention() {
    super(Kind.NORMAL, true, new SNodePointer("r:f668c7dc-a067-4444-b4cb-762be58b0141(org.iets3.variability.featuremodel.base.intentions)", "7863545206553445865"));
  }

  @Override
  public String getPresentation() {
    return "AddConstraintGroup";
  }

  @Override
  public boolean isSurroundWith() {
    return false;
  }

  public Collection<IntentionExecutable> instances(final SNode node, final EditorContext context) {
    List<IntentionExecutable> list = ListSequence.fromList(new ArrayList<IntentionExecutable>());
    List<SNode> paramList = parameter(node, context);
    if (paramList != null) {
      for (SNode param : paramList) {
        ListSequence.fromList(list).addElement(new IntentionImplementation(param));
      }
    }
    return list;
  }
  private List<SNode> parameter(final SNode node, final EditorContext editorContext) {
    return ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(SNodeOperations.getNodeAncestor(node, CONCEPTS.FeatureModel$X0, false, false), LINKS.rootConstraintGrouping$Ir9P), LINKS.groups$E0e_)).where((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL) != null && isNotEmptyString(SPropertyOperations.getString(it, PROPS.name$MnvL)) && !(Objects.equals(it, SLinkOperations.getTarget(SLinkOperations.getTarget(new IAttributeDescriptor.NodeAttribute(CONCEPTS.ConstraintGroupAnnotation$IO).get(node), LINKS.groupRef$eCvW), LINKS.group$BceS)))).toList();
  }
  /*package*/ final class IntentionImplementation extends AbstractIntentionExecutable implements ParameterizedIntentionExecutable {
    private SNode myParameter;
    public IntentionImplementation(SNode parameter) {
      myParameter = parameter;
    }

    @Override
    public String getDescription(final SNode node, final EditorContext editorContext) {
      return "CONSTRAINT GROUPING: " + ((((new IAttributeDescriptor.NodeAttribute(CONCEPTS.ConstraintGroupAnnotation$IO).get(node) != null) ? "Move" : "Add")) + " to Group " + SPropertyOperations.getString(myParameter, PROPS.name$MnvL));
    }

    @Override
    public void execute(final SNode node, final EditorContext editorContext) {
      EditorCell selectedCell = editorContext.getSelectedCell();
      SNode cg = myParameter;
      new IAttributeDescriptor.NodeAttribute(CONCEPTS.ConstraintGroupAnnotation$IO).set(node, createConstraintGroupAnnotation_h5oy5s_a0a2a0(cg));

      editorContext.flushEvents();
      editorContext.selectWRTFocusPolicy(selectedCell);
    }

    @Override
    public boolean isApplicable(final SNode node, final EditorContext editorContext) {
      return true;
    }



    @Override
    public IntentionDescriptor getDescriptor() {
      return AddConstraintGroup_Intention.this;
    }

    public Object getParameter() {
      return myParameter;
    }
  }
  private static SNode createConstraintGroupAnnotation_h5oy5s_a0a2a0(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ConstraintGroupAnnotation$IO);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.groupRef$eCvW).init(CONCEPTS.GroupReference$Y9);
      n1.setReferenceTarget(LINKS.group$BceS, p0);
    }
    return n0.getResult();
  }
  private static boolean isNotEmptyString(String str) {
    return str != null && str.length() > 0;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept FeatureModel$X0 = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc47516a211L, "org.iets3.variability.featuremodel.base.structure.FeatureModel");
    /*package*/ static final SConcept ConstraintGroupAnnotation$IO = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x6d20ecb3d752405cL, "org.iets3.variability.featuremodel.base.structure.ConstraintGroupAnnotation");
    /*package*/ static final SConcept GroupReference$Y9 = MetaAdapterFactory.getConcept(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x6d20ecb3d769275cL, "org.iets3.variability.featuremodel.base.structure.GroupReference");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink rootConstraintGrouping$Ir9P = MetaAdapterFactory.getReferenceLink(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x375cadc47516a211L, 0x6d20ecb3d733be57L, "rootConstraintGrouping");
    /*package*/ static final SContainmentLink groups$E0e_ = MetaAdapterFactory.getContainmentLink(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x6d20ecb3d73376c8L, 0x6d20ecb3d733a53dL, "groups");
    /*package*/ static final SContainmentLink groupRef$eCvW = MetaAdapterFactory.getContainmentLink(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x6d20ecb3d752405cL, 0x6d20ecb3d7692a09L, "groupRef");
    /*package*/ static final SReferenceLink group$BceS = MetaAdapterFactory.getReferenceLink(0x165f1d0525064544L, 0x895e1424f54166ecL, 0x6d20ecb3d769275cL, 0x6d20ecb3d7524143L, "group");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
