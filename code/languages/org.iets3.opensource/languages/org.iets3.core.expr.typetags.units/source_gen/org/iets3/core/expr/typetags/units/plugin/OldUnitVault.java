package org.iets3.core.expr.typetags.units.plugin;

/*Generated by MPS */

import java.util.Map;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import org.jetbrains.mps.openapi.model.SModel;
import jetbrains.mps.smodel.tempmodel.TempModuleOptions;
import jetbrains.mps.smodel.tempmodel.TemporaryModels;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class OldUnitVault {
  private static final OldUnitVault INSTANCE = new OldUnitVault();

  private Map<SNode, SNode> quantityMap = MapSequence.fromMap(new HashMap<SNode, SNode>());
  private Map<SNode, SNode> unitMap = MapSequence.fromMap(new HashMap<SNode, SNode>());

  private SModel temporaryModel;
  private SNode library = createLibrary_yde3j7_a6();

  private OldUnitVault() {
    TempModuleOptions moduleOptions = TempModuleOptions.forDefaultModule();
    temporaryModel = TemporaryModels.getInstance().createEditable(true, moduleOptions);
    SModelOperations.addRootNode(temporaryModel, library);
  }

  public static OldUnitVault getInstance() {
    return INSTANCE;
  }

  public SNode getOrCreateUnit(SNode unit) {
    SNode foundUnit = MapSequence.fromMap(unitMap).get(unit);
    if ((foundUnit == null)) {
      SNode oldUnit = createUnit_yde3j7_a0a0b0m(SPropertyOperations.getString(unit, PROPS.name$MnvL), SPropertyOperations.getString(SLinkOperations.getTarget(unit, LINKS.quantity$tnl1), PROPS.name$MnvL), getOrCreateQuantity(SLinkOperations.getTarget(unit, LINKS.quantity$tnl1)), Unit2OldUnitTranslation.toOldUnitSpecification(SLinkOperations.getTarget(unit, LINKS.specification$Tp$k)));
      ListSequence.fromList(SLinkOperations.getChildren(oldUnit, LINKS.smodelAttribute$KJ43)).addSequence(ListSequence.fromList(SLinkOperations.getChildren(unit, LINKS.smodelAttribute$KJ43)));
      MapSequence.fromMap(unitMap).put(unit, oldUnit);
      foundUnit = oldUnit;
      ListSequence.fromList(SLinkOperations.getChildren(library, LINKS.contents$JUTD)).addElement(oldUnit);
    }
    return foundUnit;
  }

  public SNode getOrCreateQuantity(SNode quantity) {
    SNode foundQuantity = MapSequence.fromMap(quantityMap).get(quantity);
    if ((foundQuantity == null)) {
      SNode oldQuantity = createQuantity_yde3j7_a0a0b0o(SPropertyOperations.getString(quantity, PROPS.name$MnvL));
      ListSequence.fromList(SLinkOperations.getChildren(oldQuantity, LINKS.smodelAttribute$KJ43)).addSequence(ListSequence.fromList(SLinkOperations.getChildren(quantity, LINKS.smodelAttribute$KJ43)));
      MapSequence.fromMap(quantityMap).put(quantity, oldQuantity);
      foundQuantity = oldQuantity;
      ListSequence.fromList(SLinkOperations.getChildren(library, LINKS.contents$JUTD)).addElement(oldQuantity);
    }
    return foundQuantity;
  }

  private static SNode createLibrary_yde3j7_a6() {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.Library$3g);
    n0.setProperty(PROPS.name$MnvL, "TemporaryLibrary");
    return n0.getResult();
  }
  private static SNode createUnit_yde3j7_a0a0b0m(String p0, String p1, SNode p2, SNode p3) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.Unit$fR);
    n0.setProperty(PROPS.name$MnvL, p0);
    n0.setProperty(PROPS.description$i9U8, p1);
    n0.setReferenceTarget(LINKS.dimension$8TSu, p2);
    n0.forChild(LINKS.specification$LqJl).initNode(p3, CONCEPTS.UnitSpecification$DK, true);
    return n0.getResult();
  }
  private static SNode createQuantity_yde3j7_a0a0b0o(String p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.Quantity$vx);
    n0.setProperty(PROPS.name$MnvL, p0);
    return n0.getResult();
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
    /*package*/ static final SProperty description$i9U8 = MetaAdapterFactory.getProperty(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x73b48a125b0d373fL, 0x73b48a125b0d3d88L, "description");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink quantity$tnl1 = MetaAdapterFactory.getReferenceLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x73b48a125b0d373fL, 0x1c3a590e2b660f1aL, "quantity");
    /*package*/ static final SContainmentLink specification$Tp$k = MetaAdapterFactory.getContainmentLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x668417ae62c5c36cL, 0x668417ae62c5ca21L, "specification");
    /*package*/ static final SContainmentLink smodelAttribute$KJ43 = MetaAdapterFactory.getContainmentLink(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x10802efe25aL, 0x47bf8397520e5942L, "smodelAttribute");
    /*package*/ static final SContainmentLink contents$JUTD = MetaAdapterFactory.getContainmentLink(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x78b257522c0608fL, 0x78b257522c06092L, "contents");
    /*package*/ static final SReferenceLink dimension$8TSu = MetaAdapterFactory.getReferenceLink(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x73b48a125b0d373fL, 0x1c3a590e2b660f1aL, "dimension");
    /*package*/ static final SContainmentLink specification$LqJl = MetaAdapterFactory.getContainmentLink(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x73b48a125b0d373fL, 0x73b48a125b0d411bL, "specification");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Library$3g = MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x78b257522c0608fL, "org.iets3.core.expr.toplevel.structure.Library");
    /*package*/ static final SConcept Unit$fR = MetaAdapterFactory.getConcept(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x73b48a125b0d373fL, "org.iets3.core.expr.typetags.units.structure.Unit");
    /*package*/ static final SConcept UnitSpecification$DK = MetaAdapterFactory.getConcept(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x73b48a125b0d411dL, "org.iets3.core.expr.typetags.units.structure.UnitSpecification");
    /*package*/ static final SConcept Quantity$vx = MetaAdapterFactory.getConcept(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x1c3a590e2b660f17L, "org.iets3.core.expr.typetags.units.structure.Quantity");
  }
}
