package org.iets3.core.expr.typetags.units.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import com.mbeddr.core.base.behavior.IVisibleElementProvider__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SConcept;

public class ScopingHelper {

  public static Iterable<SNode> getVisibleUnitsFrom(SNode node) {
    Set<SNode> units = SetSequence.fromSet(new HashSet<SNode>());

    // reference to the nounit specified in the SIUnits accessory model
    final SNode nounit = SetSequence.fromSet(units).findFirst((it) -> SPropertyOperations.getString(it, PROPS.name$MnvL).equals("nounit"));

    boolean canUseNoUnit = (SNodeOperations.getNodeAncestor(node, CONCEPTS.ICanUseNoUnit$8T, true, false) != null);

    SNode visibleElementProvider = SNodeOperations.getNodeAncestor(node, CONCEPTS.IVisibleElementProvider$$O, true, false);
    for (SNode unit : Sequence.fromIterable(IVisibleElementProvider__BehaviorDescriptor.visibleContentsOfTypeAsSequence_id3g6LnlWuSo8.invoke(visibleElementProvider, CONCEPTS.IUnit$X))) {
      SetSequence.fromSet(units).addElement(SNodeOperations.cast(unit, CONCEPTS.IUnit$X));
    }

    if (!(canUseNoUnit)) {
      return SetSequence.fromSet(units).where((it) -> it != nounit);
    } else {
      return units;
    }
  }
  public static Iterable<SNode> getVisibleDimensionFrom(SNode node) {
    SNode visibleElementProvider = SNodeOperations.getNodeAncestor(node, CONCEPTS.IVisibleElementProvider$$O, true, false);
    return SNodeOperations.ofConcept(IVisibleElementProvider__BehaviorDescriptor.visibleContentsOfTypeAsSequence_id3g6LnlWuSo8.invoke(visibleElementProvider, CONCEPTS.Quantity$vx), CONCEPTS.Quantity$vx);
  }


  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class CONCEPTS {
    /*package*/ static final SInterfaceConcept ICanUseNoUnit$8T = MetaAdapterFactory.getInterfaceConcept(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x65a3fdcab13f1e17L, "org.iets3.core.expr.typetags.units.structure.ICanUseNoUnit");
    /*package*/ static final SInterfaceConcept IVisibleElementProvider$$O = MetaAdapterFactory.getInterfaceConcept(0xd4280a54f6df4383L, 0xaa41d1b2bffa7eb1L, 0x6315bcc6eff580a3L, "com.mbeddr.core.base.structure.IVisibleElementProvider");
    /*package*/ static final SInterfaceConcept IUnit$X = MetaAdapterFactory.getInterfaceConcept(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x73b48a125b0d40ceL, "org.iets3.core.expr.typetags.units.structure.IUnit");
    /*package*/ static final SConcept Quantity$vx = MetaAdapterFactory.getConcept(0xcb91a38e738a4811L, 0xa96d448d08f526faL, 0x1c3a590e2b660f17L, "org.iets3.core.expr.typetags.units.structure.Quantity");
  }
}
