package org.iets3.core.expr.adt.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import org.iets3.core.expr.adt.behavior.AlgebraicTerm__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class AlgebraicValue {

  public final SNode cons;
  public final List<Object> args = ListSequence.fromList(new ArrayList<Object>());
  private SNode source;
  private AlgebraicValue myParent;

  public AlgebraicValue(SNode src, SNode constructor) {
    cons = constructor;
    source = src;
  }

  private void setParent(AlgebraicValue parent) {
    myParent = parent;
  }

  public boolean isRoot() {
    return this.myParent == null;
  }

  public void addArg(Object arg) {
    if (arg instanceof AlgebraicValue) {
      ((AlgebraicValue) arg).setParent(this);
    }
    ListSequence.fromList(args).addElement(arg);
  }

  @Override
  public String toString() {
    return SPropertyOperations.getString(this.cons, PROPS.name$MnvL) + ListSequence.fromList(this.args).select((it) -> it.toString());
  }

  public String path() {
    return (String) AlgebraicTerm__BehaviorDescriptor.path_id7aipPVpEyBV.invoke(source);
  }
  public SNode source() {
    return source;
  }

  @Override
  public boolean equals(Object other) {
    if (!(other instanceof AlgebraicValue)) {
      return false;
    }
    AlgebraicValue av = (AlgebraicValue) other;
    if (av.cons != this.cons) {
      return false;
    }
    if (ListSequence.fromList(av.args).count() != ListSequence.fromList(this.args).count()) {
      return false;
    }
    for (int i = 0; i < ListSequence.fromList(av.args).count(); i++) {
      if (!(ListSequence.fromList(this.args).getElement(i).equals(ListSequence.fromList(av.args).getElement(i)))) {
        return false;
      }
    }
    return true;
  }

  public Iterable<AlgebraicValue> children() {
    return ListSequence.fromList(this.args).ofType(AlgebraicValue.class);
  }
  public Iterable<Object> arguments() {
    return this.args;
  }

  private void replaceChild(AlgebraicValue oldChild, AlgebraicValue newChilld) {
    int pos = ListSequence.fromList(this.args).indexOf(oldChild);
    if (pos >= 0) {
      ListSequence.fromList(this.args).removeElementAt(pos);
      ListSequence.fromList(this.args).insertElement(pos, newChilld);
    }
  }

  public AlgebraicValue replaceWith(AlgebraicValue newValue) {
    if (myParent != null) {
      myParent.replaceChild(this, newValue);
    }
    return newValue;
  }

  public AlgebraicValue copy() {
    AlgebraicValue copied = new AlgebraicValue(this.source, this.cons);
    for (Object a : this.args) {
      if (a instanceof AlgebraicValue) {
        copied.addArg(((AlgebraicValue) a).copy());
      } else {
        copied.addArg(a);
      }
    }
    return copied;
  }

  public int size() {
    int s = 1;
    for (Object a : this.args) {
      if (a instanceof AlgebraicValue) {
        s = s + ((AlgebraicValue) a).size();
      }
    }
    return s;
  }

  public AlgebraicValue parent() {
    return myParent;
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
