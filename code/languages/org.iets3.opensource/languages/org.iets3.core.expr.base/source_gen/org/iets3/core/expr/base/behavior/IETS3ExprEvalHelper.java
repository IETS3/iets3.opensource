package org.iets3.core.expr.base.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.interpreter.rt.NullCoverageAnalyzer;
import com.mbeddr.mpsutil.interpreter.rt.ICoverageAnalyzer;
import com.mbeddr.mpsutil.interpreter.rt.StopAndReturnException;
import java.util.Map;
import org.iets3.core.expr.base.plugin.ConstraintFailedException;
import com.mbeddr.mpsutil.interpreter.rt.IInterpreter;

/**
 * 
 * @deprecated use the class IETS3ExprEvaluator instead
 */
@Deprecated
public class IETS3ExprEvalHelper {
  public static final String INTERPRETER_CATEGORY = IETS3ExprEvaluator.INTERPRETER_CATEGORY;

  public static Object evaluate(SNode expr) {
    return evaluateWithContext(expr, new IETS3ExprContext());
  }

  public static Object evaluateWithoutCoverage(SNode expr) {
    return evaluateWithContextWithoutCoverage(expr, new IETS3ExprContext());
  }

  public static Object evaluateWithContext(SNode expr, IETS3ExprContext context) {
    return evaluateWithContextInternal(expr, context, IDefaultCoverageAnalyzer.newInstance());
  }

  public static Object evaluateWithContextWithoutCoverage(SNode expr, IETS3ExprContext context) {
    return evaluateWithContextInternal(expr, context, new NullCoverageAnalyzer());
  }

  private static Object evaluateWithContextInternal(SNode expr, IETS3ExprContext context, ICoverageAnalyzer coverage) {
    try {
      return new IETS3ExprEvaluator().withContext(context).withCoverAnalyzer(coverage).evaluate(expr).getValue();
    } catch (StopAndReturnException stopEx) {
      return stopEx.value();
    }
  }

  public static ValueAndTrace evaluateWithTrace(SNode expr) {
    return evaluateWithTraceInternal(expr, IDefaultCoverageAnalyzer.newInstance());
  }

  public static ValueAndTrace evaluateWithTraceWithoutCoverage(SNode expr) {
    return evaluateWithTraceInternal(expr, new NullCoverageAnalyzer());
  }

  private static ValueAndTrace evaluateWithTraceInternal(SNode expr, ICoverageAnalyzer coverage) {
    IETS3ExprEvaluator evaluator = new IETS3ExprEvaluator();

    try {
      IValueAndTraceAndEnv result = evaluator.withCoverAnalyzer(coverage).evaluate(expr);
      return new ValueAndTrace(result.getValue(), result.getTrace());
    } catch (StopAndReturnException stopEx) {
      return new ValueAndTrace(stopEx.value(), evaluator.getLastLog());
    }
  }

  public static ValueAndTraceAndEnv evaluateWithTraceAndEnv(SNode expr) {
    return evaluateWithTraceAndEnv(expr, null);
  }

  public static ValueAndTraceAndEnv evaluateWithTraceAndEnvWithoutCoverage(SNode expr) {
    return evaluateWithTraceAndEnvWithoutCoverage(expr, null);
  }

  public static ValueAndTraceAndEnv evaluateWithTraceAndEnv(SNode expr, Map<SNode, Object> environmentContent) {
    return evaluateWithTraceAndEnvInternal(expr, environmentContent, IDefaultCoverageAnalyzer.newInstance());
  }

  public static ValueAndTraceAndEnv evaluateWithTraceAndEnvWithoutCoverage(SNode expr, Map<SNode, Object> environmentContent) {
    return evaluateWithTraceAndEnvInternal(expr, environmentContent, new NullCoverageAnalyzer());
  }

  private static ValueAndTraceAndEnv evaluateWithTraceAndEnvInternal(SNode expr, Map<SNode, Object> environmentContent, ICoverageAnalyzer coverage) {
    IETS3ExprEvaluator evaluator = new IETS3ExprEvaluator();
    IETS3ExprContext context = new IETS3ExprContext();

    try {
      return evaluator.withCoverAnalyzer(coverage).withContext(context).withEnvironmentContent(environmentContent).evaluate(expr);
    } catch (StopAndReturnException stopEx) {
      return new ValueAndTraceAndEnv(stopEx.value(), evaluator.getLastLog(), context.getEnvironment(), coverage);
    }
  }

  public static Object evaluateAndThrowConstraintFailures(SNode expr) {
    return evaluateAndThrowConstraintFailuresInternal(expr, IDefaultCoverageAnalyzer.newInstance());
  }

  public static Object evaluateAndThrowConstraintFailuresWithoutCoverage(SNode expr) {
    return evaluateAndThrowConstraintFailuresInternal(expr, new NullCoverageAnalyzer());
  }

  private static Object evaluateAndThrowConstraintFailuresInternal(SNode expr, ICoverageAnalyzer coverage) {
    try {
      return new IETS3ExprEvaluator().withCoverAnalyzer(coverage).evaluate(expr).getValue();
    } catch (ConstraintFailedException cfe) {
      throw cfe;
    } catch (StopAndReturnException stopEx) {
      return stopEx.value();
    }
  }

  public static IInterpreter getInterpreter() {
    return IETS3ExprEvaluator.getInterpreter();
  }
}
