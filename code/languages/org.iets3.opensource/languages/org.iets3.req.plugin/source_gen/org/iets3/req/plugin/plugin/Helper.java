package org.iets3.req.plugin.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.List;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import com.mbeddr.mpsutil.contextactions.runtime.IContext;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.Collections;
import org.iets3.req.core.behavior.AbstractRequirement__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.iets3.req.core.behavior.IReqContextLabelProvider__BehaviorDescriptor;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class Helper {

  public static boolean isUnderRequirement(SNode ctx) {
    return (SNodeOperations.getNodeAncestor(ctx, CONCEPTS.AbstractRequirement$yu, false, false) != null);
  }

  public static SNode getRequirement(SNode ctx) {
    return SNodeOperations.getNodeAncestor(ctx, CONCEPTS.AbstractRequirement$yu, false, false);
  }

  public static boolean isUnderDoc(SNode ctx) {
    return (SNodeOperations.getNodeAncestor(ctx, CONCEPTS.IDocumentContent$hi, false, false) != null);
  }
  public static SNode docContent(SNode ctx) {
    return SNodeOperations.getNodeAncestor(ctx, CONCEPTS.IDocumentContent$hi, false, false);
  }


  public static List<SAbstractConcept> getValidDocContents(IContext ctx) {
    List<SAbstractConcept> res = ListSequence.fromList(new ArrayList<SAbstractConcept>());
    if (ctx.getModel() == null) {
      return res;
    }
    ListSequence.fromList(res).addSequence(ListSequence.fromList(SConceptOperations.getAllSubConcepts(CONCEPTS.IReqDocContent$iB, ctx.getModel())).where((cc) -> !(cc.isAbstract()) && !(isEmptyString(SConceptOperations.conceptAlias(cc)))));
    ListSequence.fromList(res).addElement(CONCEPTS.TextParagraph$NS);
    ListSequence.fromList(res).addElement(CONCEPTS.ImageParagraph$7j);
    ListSequence.fromList(res).addElement(CONCEPTS.ItemList$TV);
    return res;
  }

  public static Iterable<SConcept> getValidFormattingContents(IContext ctx) {
    if (ctx.getModel() == null) {
      return Sequence.fromIterable(Collections.emptyList());
    }
    return ListSequence.fromList(SConceptOperations.getAllSubConcepts2(CONCEPTS.FormattedText$4r, ctx.getModel())).where((cc) -> !(cc.isAbstract()) && !(isEmptyString(SConceptOperations.conceptAlias(cc))));
  }

  public static Iterable<SConcept> getValidTagsContents(final IContext ctx) {
    if (ctx.getModel() == null) {
      return Sequence.fromIterable(Collections.emptyList());
    }
    return ListSequence.fromList(SConceptOperations.getAllSubConcepts2(CONCEPTS.Tag$O4, ctx.getModel())).where((tag) -> !(tag.isAbstract())).where((tag) -> checkTag(ctx, tag));
  }

  public static boolean checkTag(IContext ctx, final SConcept tag) {
    SNode enclosingReq = SNodeOperations.getNodeAncestor(ctx.getSNode(), CONCEPTS.AbstractRequirement$yu, true, false);
    if (enclosingReq == null || (boolean) AbstractRequirement__BehaviorDescriptor.suppressTags_id6Q6YvW0IOIs.invoke(enclosingReq)) {
      return false;
    }
    return !(ListSequence.fromList(SLinkOperations.getChildren(enclosingReq, LINKS.tags$Ba0n)).any((it) -> SNodeOperations.getConcept(it) == tag));
  }

  public static String getReqStructureFolderName(IContext ctx) {
    return check_hudo87_a0a71(SNodeOperations.getNodeAncestor(ctx.getSNode(), CONCEPTS.IReqContextLabelProvider$x$, true, false));
  }

  public static String getReqGeneralFolderName(IContext ctx) {
    return check_hudo87_a0a91(SNodeOperations.getNodeAncestor(ctx.getSNode(), CONCEPTS.IReqContextLabelProvider$x$, true, false));
  }

  private static String check_hudo87_a0a71(SNode checkedDotOperand) {
    if (null != checkedDotOperand) {
      return IReqContextLabelProvider__BehaviorDescriptor.getReqStructureFolderName_id4OH$Ti$mom4.invoke(checkedDotOperand);
    }
    return null;
  }
  private static String check_hudo87_a0a91(SNode checkedDotOperand) {
    if (null != checkedDotOperand) {
      return IReqContextLabelProvider__BehaviorDescriptor.getReqGeneralFolderName_id4OH$Ti$momj.invoke(checkedDotOperand);
    }
    return null;
  }
  private static boolean isEmptyString(String str) {
    return str == null || str.isEmpty();
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept AbstractRequirement$yu = MetaAdapterFactory.getConcept(0xa3c6f64241b744cbL, 0x951b463b8427a245L, 0x477d8ab2bc8195aeL, "org.iets3.req.core.structure.AbstractRequirement");
    /*package*/ static final SInterfaceConcept IDocumentContent$hi = MetaAdapterFactory.getInterfaceConcept(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x2e7fd03a4b7a1835L, "com.mbeddr.doc.structure.IDocumentContent");
    /*package*/ static final SInterfaceConcept IReqDocContent$iB = MetaAdapterFactory.getInterfaceConcept(0xa3c6f64241b744cbL, 0x951b463b8427a245L, 0x7a4c2a11e6426d50L, "org.iets3.req.core.structure.IReqDocContent");
    /*package*/ static final SConcept TextParagraph$NS = MetaAdapterFactory.getConcept(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x2e7fd03a4b7ccef2L, "com.mbeddr.doc.structure.TextParagraph");
    /*package*/ static final SConcept ImageParagraph$7j = MetaAdapterFactory.getConcept(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x58a16bfbe08b4e13L, "com.mbeddr.doc.structure.ImageParagraph");
    /*package*/ static final SConcept ItemList$TV = MetaAdapterFactory.getConcept(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x4aa4d574b7bf1e71L, "com.mbeddr.doc.structure.ItemList");
    /*package*/ static final SConcept FormattedText$4r = MetaAdapterFactory.getConcept(0x2374bc907e3741f1L, 0xa9c4c2e35194c36aL, 0x558f97d9712a5ce4L, "com.mbeddr.doc.structure.FormattedText");
    /*package*/ static final SConcept Tag$O4 = MetaAdapterFactory.getConcept(0xa3c6f64241b744cbL, 0x951b463b8427a245L, 0x477d8ab2bc895b1cL, "org.iets3.req.core.structure.Tag");
    /*package*/ static final SInterfaceConcept IReqContextLabelProvider$x$ = MetaAdapterFactory.getInterfaceConcept(0xa3c6f64241b744cbL, 0x951b463b8427a245L, 0x4d2d9394a45982e8L, "org.iets3.req.core.structure.IReqContextLabelProvider");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink tags$Ba0n = MetaAdapterFactory.getContainmentLink(0xa3c6f64241b744cbL, 0x951b463b8427a245L, 0x477d8ab2bc8195aeL, 0x477d8ab2bc895b23L, "tags");
  }
}
