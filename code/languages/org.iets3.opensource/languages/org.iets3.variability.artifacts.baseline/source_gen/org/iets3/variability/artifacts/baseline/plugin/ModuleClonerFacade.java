package org.iets3.variability.artifacts.baseline.plugin;

/*Generated by MPS */

import jetbrains.mps.project.AbstractModule;
import jetbrains.mps.project.MPSProject;
import jetbrains.mps.smodel.Language;
import jetbrains.mps.project.MPSExtentions;
import jetbrains.mps.project.Solution;
import java.util.Optional;
import jetbrains.mps.extapi.persistence.CopyNotSupportedException;
import java.io.File;
import jetbrains.mps.vfs.IFile;
import jetbrains.mps.ide.newModuleDialogs.CopyModuleHelper;
import org.apache.commons.lang3.StringUtils;

public class ModuleClonerFacade {

  private String nameSuffix;
  private AbstractModule myModuleOriginal;
  private final MPSProject myProject;
  private String myVirtualFolder;

  private String getExtension() {
    if (myModuleOriginal instanceof Language) {
      return MPSExtentions.DOT_LANGUAGE;
    }
    if (myModuleOriginal instanceof Solution) {
      return MPSExtentions.DOT_SOLUTION;
    }
    return null;
  }

  public Optional<AbstractModule> copyClone() throws CopyNotSupportedException {
    String moduleName = myModuleOriginal.getModuleName() + nameSuffix;
    String newModuleLoc = myModuleOriginal.getModuleSourceDir().getParent().getPath() + File.separator + moduleName;

    IFile newModuleLocationFile = myModuleOriginal.getFileSystem().getFile(newModuleLoc).findChild(moduleName + getExtension());

    return Optional.ofNullable(new CopyModuleHelper(myProject, myModuleOriginal, moduleName, newModuleLocationFile, myVirtualFolder).copy());
  }

  public ModuleClonerFacade(MPSProject project, String virtualFolder, AbstractModule origModule, String nameSuffix) {
    this.nameSuffix = nameSuffix;
    this.myModuleOriginal = origModule;
    this.myProject = project;
    this.myVirtualFolder = virtualFolder;

    assert !(StringUtils.isEmpty(this.myVirtualFolder)) : "Suffix must not be empty!";
  }
}
