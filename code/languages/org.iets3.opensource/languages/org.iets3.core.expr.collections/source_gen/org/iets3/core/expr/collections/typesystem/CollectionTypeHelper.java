package org.iets3.core.expr.collections.typesystem;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.iets3.core.expr.base.plugin.InfHelper;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public class CollectionTypeHelper {
  public static void addSizeConstraint(SNode collectionType, List<SNode> types) {
    if (ListSequence.fromList(types).all((it) -> SNodeOperations.isInstanceOf(it, CONCEPTS.CollectionType$kS))) {
      SNode firstConstraint = SLinkOperations.getTarget(SNodeOperations.as(ListSequence.fromList(types).first(), CONCEPTS.CollectionType$kS), LINKS.sizeConstraint$C3Ch);
      SLinkOperations.setTarget(collectionType, LINKS.sizeConstraint$C3Ch, createCollectionSizeSpec_1hvc6r_a0b0a0a(SPropertyOperations.getString(firstConstraint, PROPS.min$H3xo), SPropertyOperations.getString(firstConstraint, PROPS.max$H3Kp)));

      for (SNode type : Sequence.fromIterable(SNodeOperations.ofConcept(types, CONCEPTS.CollectionType$kS)).skip(1)) {
        String leftMin = SPropertyOperations.getString(SLinkOperations.getTarget(collectionType, LINKS.sizeConstraint$C3Ch), PROPS.min$H3xo);
        String rightMin = SPropertyOperations.getString(SLinkOperations.getTarget(type, LINKS.sizeConstraint$C3Ch), PROPS.min$H3xo);
        if ((leftMin != null && leftMin.length() > 0) && (rightMin != null && rightMin.length() > 0)) {
          SPropertyOperations.assign(SLinkOperations.getTarget(collectionType, LINKS.sizeConstraint$C3Ch), PROPS.min$H3xo, InfHelper.min(leftMin, rightMin));
        }

        String leftMax = SPropertyOperations.getString(SLinkOperations.getTarget(collectionType, LINKS.sizeConstraint$C3Ch), PROPS.max$H3Kp);
        String rightMax = SPropertyOperations.getString(SLinkOperations.getTarget(type, LINKS.sizeConstraint$C3Ch), PROPS.max$H3Kp);
        if ((leftMax != null && leftMax.length() > 0) && (rightMax != null && rightMax.length() > 0)) {
          SPropertyOperations.assign(SLinkOperations.getTarget(collectionType, LINKS.sizeConstraint$C3Ch), PROPS.max$H3Kp, InfHelper.max(leftMax, rightMax));
        }
      }
    }
  }
  private static SNode createCollectionSizeSpec_1hvc6r_a0b0a0a(String p0, String p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.CollectionSizeSpec$K3);
    n0.setProperty(PROPS.min$H3xo, p0);
    n0.setProperty(PROPS.max$H3Kp, p1);
    return n0.getResult();
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept CollectionType$kS = MetaAdapterFactory.getConcept(0x2f7e2e356e744c43L, 0x9fa52465d68f5996L, 0x68d69d36ba495885L, "org.iets3.core.expr.collections.structure.CollectionType");
    /*package*/ static final SConcept CollectionSizeSpec$K3 = MetaAdapterFactory.getConcept(0x2f7e2e356e744c43L, 0x9fa52465d68f5996L, 0x127541598201af65L, "org.iets3.core.expr.collections.structure.CollectionSizeSpec");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink sizeConstraint$C3Ch = MetaAdapterFactory.getContainmentLink(0x2f7e2e356e744c43L, 0x9fa52465d68f5996L, 0x68d69d36ba495885L, 0x375e37596567ed39L, "sizeConstraint");
  }

  private static final class PROPS {
    /*package*/ static final SProperty min$H3xo = MetaAdapterFactory.getProperty(0x2f7e2e356e744c43L, 0x9fa52465d68f5996L, 0x127541598201af65L, 0x127541598201af6fL, "min");
    /*package*/ static final SProperty max$H3Kp = MetaAdapterFactory.getProperty(0x2f7e2e356e744c43L, 0x9fa52465d68f5996L, 0x127541598201af65L, 0x127541598201af70L, "max");
  }
}
