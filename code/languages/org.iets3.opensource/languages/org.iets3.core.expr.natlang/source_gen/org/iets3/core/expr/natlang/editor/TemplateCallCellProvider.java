package org.iets3.core.expr.natlang.editor;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.AbstractCellProvider;
import org.jetbrains.mps.openapi.model.SNode;
import java.awt.Color;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.openapi.editor.cells.EditorCell;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.nodeEditor.cells.EditorCell_Collection;
import jetbrains.mps.nodeEditor.cellLayout.CellLayout_Indent;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.nodeEditor.cells.EditorCell_Constant;
import de.slisson.mps.richtext.behavior.Word__BehaviorDescriptor;
import jetbrains.mps.editor.runtime.style.StyleAttributes;
import jetbrains.mps.lang.editor.cellProviders.SingleRoleCellProvider;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.nodeEditor.cellMenu.SReferenceSubstituteInfo;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;

public abstract class TemplateCallCellProvider extends AbstractCellProvider {

  public TemplateCallCellProvider(SNode node, int fontStyle, Color color) {
    super(node);
    this.fontStyle = fontStyle;
    this.color = color;
  }

  public abstract SContainmentLink getValueSlotOnParameterNode();

  public abstract SReferenceLink getTemplateLinkOnCallNode();


  @Override
  public EditorCell createEditorCell(EditorContext context) {
    SNode call = SNodeOperations.cast(getSNode(), CONCEPTS.NatLangFunctionCall$wE);

    EditorCell_Collection rootCell = new EditorCell_Collection(context, call, new CellLayout_Indent(), null) {
      @Override
      public void setCellId(String id) {
        int index = 0;
        for (EditorCell child : Sequence.fromIterable(this)) {
          if (child.getCellId() == null) {
            child.setCellId(id + "_" + index);
          }
          ++index;
        }
      }
    };

    int index = 0;
    for (SNode word : ListSequence.fromList(SLinkOperations.getChildren(SLinkOperations.getTarget(new IAttributeDescriptor.NodeAttribute(CONCEPTS.NatLangCallSyntax$tE).get(SLinkOperations.getTarget(call, LINKS.extFun$6wA$)), LINKS.syntax$HiNX), LINKS.words$C8QZ))) {
      if (SNodeOperations.isInstanceOf(word, CONCEPTS.Word$5r)) {
        SNode textWord = SNodeOperations.cast(word, CONCEPTS.Word$5r);
        EditorCell_Constant cell = new EditorCell_Constant(context, call, Word__BehaviorDescriptor.getText_idehGfXvI_DB.invoke(textWord));
        cell.getStyle().set(StyleAttributes.FONT_STYLE, fontStyle);

        if (index != 0) {
          cell.getStyle().set(StyleAttributes.PUNCTUATION_LEFT, true);
        }
        cell.getStyle().set(StyleAttributes.PUNCTUATION_RIGHT, true);
        cell.getStyle().set(StyleAttributes.FIRST_POSITION_ALLOWED, true);
        cell.getStyle().set(StyleAttributes.LAST_POSITION_ALLOWED, true);
        cell.getStyle().set(StyleAttributes.TEXT_COLOR, this.color);
        rootCell.addEditorCell(cell);

        cell.getStyle().set(StyleAttributes.NAVIGATABLE_NODE, SLinkOperations.getTarget(call, LINKS.extFun$6wA$));

      } else if (SNodeOperations.isInstanceOf(word, CONCEPTS.NatLangFunctionArgRef$$6)) {
        final SNode refWord = SNodeOperations.cast(word, CONCEPTS.NatLangFunctionArgRef$$6);
        SNode value = ListSequence.fromList(SLinkOperations.getChildren(call, LINKS.args$U5u9)).findFirst((it) -> SLinkOperations.getTarget(it, LINKS.param$UywN) == SLinkOperations.getTarget(refWord, LINKS.param$yxRU));

        if (value != null) {
          SingleRoleCellProvider provider = new SingleChildCellProvider(value, LINKS.value$Usbo, context) {
            @Override
            protected String getNoTargetText() {
              return "<no " + SPropertyOperations.getString(SLinkOperations.getTarget(refWord, LINKS.param$yxRU), PROPS.name$MnvL) + ">";
            }
          };
          EditorCell valueCell = provider.createCell();
          rootCell.addEditorCell(valueCell);
        } else {
          EditorCell_Constant cell = new EditorCell_Constant(context, call, "");
          cell.setDefaultText("<no parameterValue for " + SPropertyOperations.getString(SLinkOperations.getTarget(refWord, LINKS.param$yxRU), PROPS.name$MnvL) + ">");
          rootCell.addEditorCell(cell);
        }

      }
      ++index;
    }

    if (rootCell.getCellsCount() == 0) {
      EditorCell_Constant constant = new EditorCell_Constant(context, call, "", true);
      constant.setDefaultText("<function " + SPropertyOperations.getString(SLinkOperations.getTarget(call, LINKS.extFun$6wA$), PROPS.name$MnvL) + " has no template>");
      rootCell.addEditorCell(constant);
    }



    rootCell.firstCell().setSubstituteInfo(new SReferenceSubstituteInfo(rootCell.firstCell(), getTemplateLinkOnCallNode()));


    return rootCell;
  }


  private int fontStyle;
  private Color color;

  private static final class CONCEPTS {
    /*package*/ static final SConcept NatLangFunctionCall$wE = MetaAdapterFactory.getConcept(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556af254ecL, "org.iets3.core.expr.natlang.structure.NatLangFunctionCall");
    /*package*/ static final SConcept Word$5r = MetaAdapterFactory.getConcept(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9f2e0cL, "de.slisson.mps.richtext.structure.Word");
    /*package*/ static final SConcept NatLangFunctionArgRef$$6 = MetaAdapterFactory.getConcept(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556af084a9L, "org.iets3.core.expr.natlang.structure.NatLangFunctionArgRef");
    /*package*/ static final SConcept NatLangCallSyntax$tE = MetaAdapterFactory.getConcept(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556ae7b419L, "org.iets3.core.expr.natlang.structure.NatLangCallSyntax");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink extFun$6wA$ = MetaAdapterFactory.getReferenceLink(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556af254ecL, 0x27b717d14a8f82e8L, "extFun");
    /*package*/ static final SContainmentLink args$U5u9 = MetaAdapterFactory.getContainmentLink(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556af254ecL, 0x27b717d14a903157L, "args");
    /*package*/ static final SReferenceLink param$yxRU = MetaAdapterFactory.getReferenceLink(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556af084a9L, 0x1781e8556af084bbL, "param");
    /*package*/ static final SReferenceLink param$UywN = MetaAdapterFactory.getReferenceLink(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556aff1984L, 0x1781e8556aff199aL, "param");
    /*package*/ static final SContainmentLink value$Usbo = MetaAdapterFactory.getContainmentLink(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556aff1984L, 0x1781e8556aff1994L, "value");
    /*package*/ static final SContainmentLink syntax$HiNX = MetaAdapterFactory.getContainmentLink(0x64e7917630a14836L, 0x821cbf62ff6c6091L, 0x1781e8556ae7b419L, 0x1781e8556ae7b4deL, "syntax");
    /*package*/ static final SContainmentLink words$C8QZ = MetaAdapterFactory.getContainmentLink(0x92d2ea165a424fdfL, 0xa676c7604efe3504L, 0x237c8da86a9e4e61L, 0x237c8da86a9e7aeeL, "words");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
