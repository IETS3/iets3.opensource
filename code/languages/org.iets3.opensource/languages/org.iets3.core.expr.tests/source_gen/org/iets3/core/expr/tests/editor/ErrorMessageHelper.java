package org.iets3.core.expr.tests.editor;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import org.iets3.core.expr.tests.behavior.IEvalResult;
import org.iets3.core.base.behavior.ICanStoreCheckResult__BehaviorDescriptor;
import java.util.Map;
import org.iets3.core.expr.base.plugin.ProgramLocationValue;

public class ErrorMessageHelper {

  public static String format(SNode node) {
    String contents = "[no result found]";
    try {
      IEvalResult res = ((IEvalResult) ICanStoreCheckResult__BehaviorDescriptor.getLastResult_id3R3AIvumwq7.invoke(node));
      if (res != null) {
        String timeStamp = "[" + res.getTime() + " ms]";
        if (res.isOk()) {
          contents = timeStamp;
        } else {
          if (res.getErrorMessage() != null) {
            contents = timeStamp + " [error] " + res.getErrorMessage();
            Map data = res.getErrorMessage().getData();
            if (data != null) {
              for (Object k : data.keySet()) {
                contents += ("\n" + k + " = " + data.get(k));
              }
            }
          } else {
            if (res.getActual() != null) {
              contents = timeStamp + " [actual] " + res.getActual().toString();
            } else {
              contents = timeStamp + " [actual is null]";
            }
          }
        }
      }
    } catch (ClassCastException ignore) {
      contents = "[outdated; please rerun]";
    }
    // doesn't work, kills comparison operators in error messages.
    if (contents.endsWith("\n")) {
      contents = contents.substring(0, contents.length() - 1);
    }
    if (contents.startsWith("\n")) {
      contents = contents.substring(1);
    }
    return contents;
  }

  public static SNode getSource(SNode node) {
    try {
      IEvalResult res = ((IEvalResult) ICanStoreCheckResult__BehaviorDescriptor.getLastResult_id3R3AIvumwq7.invoke(node));
      if (res != null && res.getErrorMessage() != null) {
        ProgramLocationValue s = res.getErrorMessage().getSource();
        if (s == null) {
          return null;
        }
        return s.node();
      }
    } catch (ClassCastException ignore) {
      return null;
    }
    return null;
  }

}
