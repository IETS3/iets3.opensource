package org.iets3.core.expr.tests.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import java.util.List;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import jetbrains.mps.baseLanguage.tuples.runtime.Tuples;
import java.util.Set;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.baseLanguage.tuples.runtime.MultiTuple;
import org.iets3.core.expr.base.plugin.CVH;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.iets3.core.expr.base.behavior.IETS3ExprEvaluator;
import org.iets3.core.expr.base.behavior.IDefaultCoverageAnalyzer;
import org.iets3.core.expr.base.plugin.ConstraintFailedException;
import org.iets3.core.expr.base.plugin.MessageValue;
import org.iets3.core.expr.base.plugin.ProgramLocationValue;
import org.iets3.core.expr.simpleTypes.runtime.EqualsHelper;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SConcept;

public final class FunctionSubjectAdapter__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0xd441fba0f46b43cdL, 0xb723dad7b65da615L, 0x12e0beaa8fda1a51L, "org.iets3.core.expr.tests.structure.FunctionSubjectAdapter");

  public static final SMethod<List<SNode>> arguments_id1bwJEEeSLhl = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("arguments").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1360296727216854101L).languageId(0xb723dad7b65da615L, 0xd441fba0f46b43cdL).build2();
  public static final SMethod<List<Tuples._2<SNode, String>>> outputs_id1bwJEEg42nb = new SMethodBuilder<List<Tuples._2<SNode, String>>>(new SJavaCompoundTypeImpl((Class<List<Tuples._2<SNode, String>>>) ((Class) Object.class))).name("outputs").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1360296727236584907L).languageId(0xb723dad7b65da615L, 0xd441fba0f46b43cdL).build2();
  public static final SMethod<EvalResult> run_id5AG05XYAiHw = new SMethodBuilder<EvalResult>(new SJavaCompoundTypeImpl(EvalResult.class)).name("run").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(6461539975515679584L).languageId(0xb723dad7b65da615L, 0xd441fba0f46b43cdL).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));
  public static final SMethod<SNode> getSubject_id3_xsRJ4sekF = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("getSubject").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4134712908316730667L).languageId(0xb723dad7b65da615L, 0xd441fba0f46b43cdL).build2();
  public static final SMethod<String> getName_id7WSgHRKUTmg = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("getName").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(9167150562509821328L).languageId(0xb723dad7b65da615L, 0xd441fba0f46b43cdL).build2();
  public static final SMethod<Boolean> supportsMutations_id3yVmeSjI$c6 = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("supportsMutations").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4087958866325291782L).languageId(0xb723dad7b65da615L, 0xd441fba0f46b43cdL).build2();
  public static final SMethod<List<SNode>> getMutatableSubtrees_id3yVmeSjI$yN = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("getMutatableSubtrees").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4087958866325293235L).languageId(0xb723dad7b65da615L, 0xd441fba0f46b43cdL).build2();
  public static final SMethod<Void> collectFunctionBodies_id3yVmeSjID71 = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("collectFunctionBodies").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(4087958866325311937L).languageId(0xb723dad7b65da615L, 0xd441fba0f46b43cdL).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""), SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""), SMethodBuilder.createJavaParameter((Class<Set<SNode>>) ((Class) Object.class), ""));

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(arguments_id1bwJEEeSLhl, outputs_id1bwJEEg42nb, run_id5AG05XYAiHw, getSubject_id3_xsRJ4sekF, getName_id7WSgHRKUTmg, supportsMutations_id3yVmeSjI$c6, getMutatableSubtrees_id3yVmeSjI$yN, collectFunctionBodies_id3yVmeSjID71);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static List<SNode> arguments_id1bwJEEeSLhl(@NotNull SNode __thisNode__) {
    return SLinkOperations.getChildren(SLinkOperations.getTarget(__thisNode__, LINKS.fun$ddJP), LINKS.args$XOIh);
  }
  /*package*/ static List<Tuples._2<SNode, String>> outputs_id1bwJEEg42nb(@NotNull SNode __thisNode__) {
    List<Tuples._2<SNode, String>> res = ListSequence.fromList(new ArrayList<Tuples._2<SNode, String>>());
    if (SPropertyOperations.getBoolean(__thisNode__, PROPS.checkResults$B4ld)) {
      ListSequence.fromList(res).addElement(MultiTuple.<SNode,String>from(SLinkOperations.getTarget(__thisNode__, LINKS.fun$ddJP), "res"));
    }
    return res;
  }
  /*package*/ static EvalResult run_id5AG05XYAiHw(@NotNull SNode __thisNode__, SNode vector) {
    boolean oldOverridden = CVH.overrideWithException;
    try {
      CVH.overrideWithException = true;
      SNode call = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x427ce5230842b3ecL, "org.iets3.core.expr.toplevel.structure.FunctionCall"));
      SLinkOperations.setTarget(call, LINKS.function$xJRS, SLinkOperations.getTarget(__thisNode__, LINKS.fun$ddJP));
      ListSequence.fromList(SLinkOperations.getChildren(call, LINKS.args$xJpQ)).addSequence(ListSequence.fromList(SLinkOperations.getChildren(vector, LINKS.values$8V1O)).select((it) -> SNodeOperations.copyNode(SLinkOperations.getTarget(it, LINKS.value$xPWu))));

      Object actualVal = null;
      try {
        actualVal = new IETS3ExprEvaluator().withComputationTrace(false).withCoverAnalyzer(IDefaultCoverageAnalyzer.newInstance()).evaluateAndThrowConstraintFailures(call);
      } catch (ConstraintFailedException cfe) {
        if (cfe.failedBecauseOf(ConstraintFailedException.PRE)) {
          return new EvalResult(false, new MessageValue("[PRE] " + cfe.failedCondition, new ProgramLocationValue(cfe.node2)));
        }
        if (cfe.failedBecauseOf(ConstraintFailedException.POST)) {
          return new EvalResult(false, new MessageValue("[POST] " + cfe.failedCondition, new ProgramLocationValue(cfe.node2)));
        }
      }

      if (actualVal == null) {
        return new EvalResult(false, new MessageValue("eval result was null"));
      }

      if (ListSequence.fromList(SLinkOperations.getChildren(vector, LINKS.results$MVx9)).isEmpty()) {
        EvalResult rr = new EvalResult(true, new MessageValue("no expected value given; actual was " + actualVal));
        rr.setActual(actualVal);
        return rr;
      }

      SNode exp = ListSequence.fromList(SLinkOperations.getChildren(vector, LINKS.results$MVx9)).getElement(0);
      if (exp == null) {
        return new EvalResult(false, new MessageValue("expected value null"));
      }

      Object expValue = new IETS3ExprEvaluator().withComputationTrace(false).evaluate(SLinkOperations.getTarget(exp, LINKS.value$VRuh)).getValue();
      if (expValue == null) {
        return new EvalResult(false, new MessageValue("eval result was null for expected value"));
      }
      boolean matches = EqualsHelper.equals(expValue, actualVal);
      if (matches) {
        return new EvalResult(true, new MessageValue("ok"));
      } else {
        EvalResult r = new EvalResult(false, new MessageValue("actual was " + actualVal));
        r.setActual(actualVal);
        return r;
      }
    } finally {
      CVH.overrideWithException = oldOverridden;
    }
  }
  /*package*/ static SNode getSubject_id3_xsRJ4sekF(@NotNull SNode __thisNode__) {
    return SLinkOperations.getTarget(__thisNode__, LINKS.fun$ddJP);
  }
  /*package*/ static String getName_id7WSgHRKUTmg(@NotNull SNode __thisNode__) {
    return "fun_" + SPropertyOperations.getString(SLinkOperations.getTarget(__thisNode__, LINKS.fun$ddJP), PROPS.name$MnvL);
  }
  /*package*/ static boolean supportsMutations_id3yVmeSjI$c6(@NotNull SNode __thisNode__) {
    return true;
  }
  /*package*/ static List<SNode> getMutatableSubtrees_id3yVmeSjI$yN(@NotNull SNode __thisNode__) {
    Set<SNode> bodies = SetSequence.fromSet(new HashSet<SNode>());
    FunctionSubjectAdapter__BehaviorDescriptor.collectFunctionBodies_id3yVmeSjID71.invoke(__thisNode__, SLinkOperations.getTarget(__thisNode__, LINKS.fun$ddJP), SLinkOperations.getTarget(__thisNode__, LINKS.fun$ddJP), bodies);
    return SetSequence.fromSet(bodies).toList();
  }
  /*package*/ static void collectFunctionBodies_id3yVmeSjID71(@NotNull SNode __thisNode__, SNode start, SNode f, Set<SNode> bodies) {
    SNode b = SLinkOperations.getTarget(f, LINKS.body$Y8TB);
    if (SetSequence.fromSet(bodies).contains(b)) {
      return;
    }
    if (SNodeOperations.getModel(start) != SNodeOperations.getModel(f)) {
      return;
    }
    SetSequence.fromSet(bodies).addElement(b);
    for (SNode call : ListSequence.fromList(SNodeOperations.getNodeDescendants(b, CONCEPTS.FunctionCall$bZ, false, new SAbstractConcept[]{}))) {
      SNode ff = SLinkOperations.getTarget(call, LINKS.function$xJRS);
      if (SNodeOperations.isInstanceOf(ff, CONCEPTS.Function$iC)) {
        FunctionSubjectAdapter__BehaviorDescriptor.collectFunctionBodies_id3yVmeSjID71.invoke(__thisNode__, start, SNodeOperations.cast(ff, CONCEPTS.Function$iC), bodies);
      }
    }
  }

  /*package*/ FunctionSubjectAdapter__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((List<SNode>) arguments_id1bwJEEeSLhl(node));
      case 1:
        return (T) ((List<Tuples._2<SNode, String>>) outputs_id1bwJEEg42nb(node));
      case 2:
        return (T) ((EvalResult) run_id5AG05XYAiHw(node, (SNode) parameters[0]));
      case 3:
        return (T) ((SNode) getSubject_id3_xsRJ4sekF(node));
      case 4:
        return (T) ((String) getName_id7WSgHRKUTmg(node));
      case 5:
        return (T) ((Boolean) supportsMutations_id3yVmeSjI$c6(node));
      case 6:
        return (T) ((List<SNode>) getMutatableSubtrees_id3yVmeSjI$yN(node));
      case 7:
        collectFunctionBodies_id3yVmeSjID71(node, (SNode) parameters[0], (SNode) parameters[1], (Set<SNode>) parameters[2]);
        return null;
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink fun$ddJP = MetaAdapterFactory.getReferenceLink(0xd441fba0f46b43cdL, 0xb723dad7b65da615L, 0x12e0beaa8fda1a51L, 0x12e0beaa8fda1a5eL, "fun");
    /*package*/ static final SContainmentLink args$XOIh = MetaAdapterFactory.getContainmentLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523083b8a2fL, 0x427ce523083b8a3fL, "args");
    /*package*/ static final SReferenceLink function$xJRS = MetaAdapterFactory.getReferenceLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce5230841f89cL, 0x427ce5230841f8a8L, "function");
    /*package*/ static final SContainmentLink args$xJpQ = MetaAdapterFactory.getContainmentLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce5230841f89cL, 0x427ce5230841f8a6L, "args");
    /*package*/ static final SContainmentLink values$8V1O = MetaAdapterFactory.getContainmentLink(0xd441fba0f46b43cdL, 0xb723dad7b65da615L, 0x12e0beaa8ee3141fL, 0x12e0beaa8ee31420L, "values");
    /*package*/ static final SContainmentLink value$xPWu = MetaAdapterFactory.getContainmentLink(0xd441fba0f46b43cdL, 0xb723dad7b65da615L, 0x12e0beaa8f0adb15L, 0x12e0beaa8f0adb36L, "value");
    /*package*/ static final SContainmentLink results$MVx9 = MetaAdapterFactory.getContainmentLink(0xd441fba0f46b43cdL, 0xb723dad7b65da615L, 0x12e0beaa8ee3141fL, 0x12e0beaa904ac9aeL, "results");
    /*package*/ static final SContainmentLink value$VRuh = MetaAdapterFactory.getContainmentLink(0xd441fba0f46b43cdL, 0xb723dad7b65da615L, 0x12e0beaa9048c59dL, 0x12e0beaa9048c5e8L, "value");
    /*package*/ static final SContainmentLink body$Y8TB = MetaAdapterFactory.getContainmentLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523083b8a2fL, 0x427ce523083b8a56L, "body");
  }

  private static final class PROPS {
    /*package*/ static final SProperty checkResults$B4ld = MetaAdapterFactory.getProperty(0xd441fba0f46b43cdL, 0xb723dad7b65da615L, 0x12e0beaa8fda1a51L, 0x12e0beaa906d0889L, "checkResults");
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Function$iC = MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x427ce523083c44a3L, "org.iets3.core.expr.toplevel.structure.Function");
    /*package*/ static final SConcept FunctionCall$bZ = MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x427ce5230842b3ecL, "org.iets3.core.expr.toplevel.structure.FunctionCall");
  }
}
