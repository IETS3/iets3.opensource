package org.iets3.core.expr.temporal.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractInferenceRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.InferenceRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.typesystem.inference.EquationInfo;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import com.mbeddr.mpsutil.interpreter.behavior.IInterpreterWrapperType__BehaviorDescriptor;
import org.iets3.core.expr.base.behavior.IComplexTypeSupportsEquals__BehaviorDescriptor;
import org.iets3.core.base.behavior.ErrorCheckingUtil;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import jetbrains.mps.lang.core.behavior.BaseConcept__BehaviorDescriptor;
import org.iets3.core.expr.base.runtime.runtime.PTF;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;
import org.jetbrains.mps.openapi.language.SProperty;

public class typeof_BinaryEqualityExpression_temporal_InferenceRule extends AbstractInferenceRule_Runtime implements InferenceRule_Runtime {
  public typeof_BinaryEqualityExpression_temporal_InferenceRule() {
  }
  public boolean overrides(final SNode beq, IsApplicableStatus status) {
    return true;
  }
  public void applyRule(final SNode beq, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    {
      final SNode leftType = typeCheckingContext.typeOf(SLinkOperations.getTarget(beq, LINKS.left$zxUa), "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907680033", true);
      typeCheckingContext.whenConcrete(leftType, () -> {
        {
          final SNode rightType = typeCheckingContext.typeOf(SLinkOperations.getTarget(beq, LINKS.right$zBjx), "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907680029", true);
          typeCheckingContext.whenConcrete(rightType, () -> {
            SNode wrappedOpType = typeCheckingContext.getOverloadedOperationType(beq, typeCheckingContext.getExpandedNode(leftType), typeCheckingContext.getExpandedNode(rightType), (modelId, ruleId) -> typeCheckingContext.reportWarning(beq, "conflicting rules for overloaded operation type", modelId, ruleId, null, new NodeMessageTarget()));
            if (wrappedOpType != null) {
              {
                SNode _nodeToCheck_1029348928467 = beq;
                EquationInfo _info_12389875345 = new EquationInfo(_nodeToCheck_1029348928467, null, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "665001244857741998", 0, null);
                typeCheckingContext.createEquation((SNode) typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "665001244857741213", true), (SNode) wrappedOpType, _info_12389875345);
              }
              return;
            }

            SNode unwrappedOpType;
            boolean wasTemporal = false;
            SNode lt = typeCheckingContext.getExpandedNode(leftType);
            SNode rt = typeCheckingContext.getExpandedNode(rightType);
            if (SNodeOperations.isInstanceOf(lt, CONCEPTS.TemporalType$oH)) {
              lt = SLinkOperations.getTarget(SNodeOperations.cast(lt, CONCEPTS.TemporalType$oH), LINKS.baseType$ZN4a);
              wasTemporal = true;
            }
            if (SNodeOperations.isInstanceOf(rt, CONCEPTS.TemporalType$oH)) {
              rt = SLinkOperations.getTarget(SNodeOperations.cast(rt, CONCEPTS.TemporalType$oH), LINKS.baseType$ZN4a);
              wasTemporal = true;
            }


            if (SNodeOperations.isInstanceOf(lt, CONCEPTS.IInterpreterWrapperType$KD)) {
              lt = IInterpreterWrapperType__BehaviorDescriptor.wrappedType_id6bG6MAFRDvi.invoke(SNodeOperations.cast(lt, CONCEPTS.IInterpreterWrapperType$KD));
            }
            if (SNodeOperations.isInstanceOf(rt, CONCEPTS.IInterpreterWrapperType$KD)) {
              rt = IInterpreterWrapperType__BehaviorDescriptor.wrappedType_id6bG6MAFRDvi.invoke(SNodeOperations.cast(rt, CONCEPTS.IInterpreterWrapperType$KD));
            }
            if (SNodeOperations.isInstanceOf(lt, CONCEPTS.IComplexTypeSupportsEquals$qk) || SNodeOperations.isInstanceOf(rt, CONCEPTS.IComplexTypeSupportsEquals$qk)) {
              SNode complexType;
              SNode otherType;
              if (SNodeOperations.isInstanceOf(lt, CONCEPTS.IComplexTypeSupportsEquals$qk)) {
                complexType = SNodeOperations.cast(lt, CONCEPTS.IComplexTypeSupportsEquals$qk);
                otherType = rt;
              } else {
                complexType = SNodeOperations.cast(rt, CONCEPTS.IComplexTypeSupportsEquals$qk);
                otherType = lt;
              }
              if (!((boolean) IComplexTypeSupportsEquals__BehaviorDescriptor.isComparableTo_id6xvNSEj6BML.invoke(complexType, otherType))) {
                String errorText = ErrorCheckingUtil.cannotBeAppliedToTypesMessage(SConceptOperations.conceptAlias(SNodeOperations.getConcept(beq)), lt, rt);
                {
                  final MessageTarget errorTarget = new NodeMessageTarget();
                  IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(beq, errorText, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "7520958096812873301", null, errorTarget);
                }
                {
                  SNode _nodeToCheck_1029348928467 = beq;
                  EquationInfo _info_12389875345 = new EquationInfo(_nodeToCheck_1029348928467, null, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "7520958096812873316", 0, null);
                  typeCheckingContext.createEquation((SNode) typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "7520958096812873336", true), (SNode) createRuntimeErrorType_rs99cb_a1a0c0c0d0n0b0a1a0a1a0b0a0c(lt + BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(rt)), _info_12389875345);
                }
              } else {
                if (wasTemporal) {
                  {
                    SNode _nodeToCheck_1029348928467 = beq;
                    EquationInfo _info_12389875345 = new EquationInfo(_nodeToCheck_1029348928467, null, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "7838343651187804851", 0, null);
                    typeCheckingContext.createEquation((SNode) typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "7838343651187804861", true), (SNode) createTemporalType_rs99cb_a1a0c0a0a0a3a31a1a0b0a0b0a1a0a2(PTF.createBooleanType()), _info_12389875345);
                  }
                } else {
                  {
                    SNode _nodeToCheck_1029348928467 = beq;
                    EquationInfo _info_12389875345 = new EquationInfo(_nodeToCheck_1029348928467, null, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "7838343651187620286", 0, null);
                    typeCheckingContext.createEquation((SNode) typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "7838343651187619445", true), (SNode) PTF.createBooleanType(), _info_12389875345);
                  }
                }
              }
              return;
            }

            unwrappedOpType = typeCheckingContext.getOverloadedOperationType(beq, lt, rt, (modelId, ruleId) -> typeCheckingContext.reportWarning(beq, "conflicting rules for overloaded operation type", modelId, ruleId, null, new NodeMessageTarget()));
            if (unwrappedOpType != null) {
              if (wasTemporal) {
                {
                  SNode _nodeToCheck_1029348928467 = beq;
                  EquationInfo _info_12389875345 = new EquationInfo(_nodeToCheck_1029348928467, null, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907680014", 0, null);
                  typeCheckingContext.createEquation((SNode) typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907680024", true), (SNode) createTemporalType_rs99cb_a1a0c0a0a0q0b0a1a0a1a0b0a0c(SNodeOperations.cast(unwrappedOpType, CONCEPTS.Type$WK)), _info_12389875345);
                }
              } else {
                {
                  SNode _nodeToCheck_1029348928467 = beq;
                  EquationInfo _info_12389875345 = new EquationInfo(_nodeToCheck_1029348928467, null, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907680005", 0, null);
                  typeCheckingContext.createEquation((SNode) typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907680009", true), (SNode) unwrappedOpType, _info_12389875345);
                }
              }
              return;
            }
            String message = ErrorCheckingUtil.cannotBeAppliedToTypesMessage(SConceptOperations.conceptAlias(SNodeOperations.getConcept(beq)), typeCheckingContext.getExpandedNode(leftType), typeCheckingContext.getExpandedNode(rightType));
            {
              final MessageTarget errorTarget = new NodeMessageTarget();
              IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(beq, message, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907679971", null, errorTarget);
            }
            {
              SNode _nodeToCheck_1029348928467 = beq;
              EquationInfo _info_12389875345 = new EquationInfo(_nodeToCheck_1029348928467, null, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907679980", 0, null);
              typeCheckingContext.createEquation((SNode) typeCheckingContext.typeOf(_nodeToCheck_1029348928467, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907679985", true), (SNode) createRuntimeErrorType_rs99cb_a1a0c0t0b0a1a0a1a0b0a0c(message), _info_12389875345);
            }
          }, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907679863", false, false);
        }
      }, "r:782cab7d-c30f-4797-991c-cb17d0274086(org.iets3.core.expr.temporal.typesystem)", "1075037996907679859", false, false);
    }
  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.BinaryEqualityExpression$vt;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  private static SNode createRuntimeErrorType_rs99cb_a1a0c0c0d0n0b0a1a0a1a0b0a0c(String p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.RuntimeErrorType$3c);
    n0.setProperty(PROPS.errorText$leWQ, p0);
    return n0.getResult();
  }
  private static SNode createTemporalType_rs99cb_a1a0c0a0a0a3a31a1a0b0a0b0a1a0a2(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.TemporalType$oH);
    n0.forChild(LINKS.baseType$ZN4a).initNode(p0, CONCEPTS.Type$WK, true);
    return n0.getResult();
  }
  private static SNode createTemporalType_rs99cb_a1a0c0a0a0q0b0a1a0a1a0b0a0c(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.TemporalType$oH);
    n0.forChild(LINKS.baseType$ZN4a).initNode(p0, CONCEPTS.Type$WK, true);
    return n0.getResult();
  }
  private static SNode createRuntimeErrorType_rs99cb_a1a0c0t0b0a1a0a1a0b0a0c(String p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.RuntimeErrorType$3c);
    n0.setProperty(PROPS.errorText$leWQ, p0);
    return n0.getResult();
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink left$zxUa = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86c99c15L, 0x46ff3b3d86c99c16L, "left");
    /*package*/ static final SContainmentLink right$zBjx = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86c99c15L, 0x46ff3b3d86c99c18L, "right");
    /*package*/ static final SContainmentLink baseType$ZN4a = MetaAdapterFactory.getContainmentLink(0x4621d3e3b8a34bbeL, 0xb7ac234b6e2d1d68L, 0x501c5b607b212209L, 0x501c5b607b21220aL, "baseType");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept TemporalType$oH = MetaAdapterFactory.getConcept(0x4621d3e3b8a34bbeL, 0xb7ac234b6e2d1d68L, 0x501c5b607b212209L, "org.iets3.core.expr.temporal.structure.TemporalType");
    /*package*/ static final SInterfaceConcept IInterpreterWrapperType$KD = MetaAdapterFactory.getInterfaceConcept(0x47f075a6558e4640L, 0xa6067ce0236c8023L, 0x62ec1b29abde62acL, "com.mbeddr.mpsutil.interpreter.structure.IInterpreterWrapperType");
    /*package*/ static final SInterfaceConcept IComplexTypeSupportsEquals$qk = MetaAdapterFactory.getInterfaceConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x685fcf8a931a7c8bL, "org.iets3.core.expr.base.structure.IComplexTypeSupportsEquals");
    /*package*/ static final SConcept Type$WK = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x670d5e92f854a614L, "org.iets3.core.expr.base.structure.Type");
    /*package*/ static final SConcept BinaryEqualityExpression$vt = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86cc6d99L, "org.iets3.core.expr.base.structure.BinaryEqualityExpression");
    /*package*/ static final SConcept RuntimeErrorType$3c = MetaAdapterFactory.getConcept(0x7a5dda6291404668L, 0xab76d5ed1746f2b2L, 0x113f84956f9L, "jetbrains.mps.lang.typesystem.structure.RuntimeErrorType");
  }

  private static final class PROPS {
    /*package*/ static final SProperty errorText$leWQ = MetaAdapterFactory.getProperty(0x7a5dda6291404668L, 0xab76d5ed1746f2b2L, 0x113f84956f9L, 0x113f84956faL, "errorText");
  }
}
