package org.iets3.core.expr.temporal.typesystem;

/*Generated by MPS */

import org.jetbrains.annotations.Nullable;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SContainmentLink;

public class TemporalHelper {

  /**
   * Unwraps a node, like ConstantRef, recursively until a DateLiteral is reached or unwrapping is not 
   * possible anymore, e.g. an unhandled concept is used for wrapping
   * 
   * @param wrapper the node that should be unwrapper to retrieve the DateLiteral
   * @return the unwrapped DateLiteral; otherwise null
   */
  @Nullable
  public static SNode unwrapToDateLiteral(SNode wrapper) {
    SNode unwrapped = wrapper;

    // Unwraps the given wrapper-expression until it is either a DateLiteral or it's unclear how to unwrap it further, in which case null is returned
    while (!(SNodeOperations.isInstanceOf(unwrapped, CONCEPTS.DateLiteral$RZ)) && (unwrapped != null)) {
      SAbstractConcept cncpt = SNodeOperations.getConcept(unwrapped);
      boolean noneMatched = true;
      if (noneMatched && SConceptOperations.isSubConceptOf(cncpt, CONCEPTS.ConstantRef$5J)) {
        noneMatched = false;
        unwrapped = SLinkOperations.getTarget(SLinkOperations.getTarget(SNodeOperations.cast(unwrapped, CONCEPTS.ConstantRef$5J), LINKS.constant$YVF7), LINKS.expr$CW3E);
      }
      if (noneMatched) {
        unwrapped = null;
      }
    }

    return ((unwrapped != null) ? SNodeOperations.cast(unwrapped, CONCEPTS.DateLiteral$RZ) : null);
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ConstantRef$5J = MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x78b257522b24f39L, "org.iets3.core.expr.toplevel.structure.ConstantRef");
    /*package*/ static final SConcept DateLiteral$RZ = MetaAdapterFactory.getConcept(0x289fb12b7f534ef7L, 0xbc2e1ed2c6a7c998L, 0x35ec8ca87adca111L, "org.iets3.core.expr.datetime.structure.DateLiteral");
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink constant$YVF7 = MetaAdapterFactory.getReferenceLink(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x78b257522b24f39L, 0x78b257522b24f3aL, "constant");
    /*package*/ static final SContainmentLink expr$CW3E = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x3b256bb6ae8048d8L, 0x3b256bb6ae8048d9L, "expr");
  }
}
