package org.iets3.safety.attributes.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractNonTypesystemRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.NonTypesystemRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import org.iets3.core.attributes.behavior.IValueAttribute__BehaviorDescriptor;
import org.iets3.core.attributes.behavior.IComputedValueAttribute__BehaviorDescriptor;
import org.iets3.core.attributes.behavior.AttributeValue__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import jetbrains.mps.errors.BaseQuickFixProvider;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class checkAsilLevel_NonTypesystemRule extends AbstractNonTypesystemRule_Runtime implements NonTypesystemRule_Runtime {
  public checkAsilLevel_NonTypesystemRule() {
  }
  public void applyRule(final SNode asilLevelAttribute, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    SNode effectiveValue = IValueAttribute__BehaviorDescriptor.getEffectiveValue_id1HqphBICm56.invoke(asilLevelAttribute);
    SNode computedValue = IComputedValueAttribute__BehaviorDescriptor.computedValue_id1HqphBIwaPM.invoke(asilLevelAttribute);
    if (computedValue != null) {
      if ((int) AttributeValue__BehaviorDescriptor.compareTo_id1HqphBI_m8C.invoke(effectiveValue, computedValue) < 0) {
        if (!(SNodeOperations.isInstanceOf(computedValue, CONCEPTS.ASILLevelValue$fW))) {
          {
            final MessageTarget errorTarget = new NodeMessageTarget();
            IErrorReporter _reporter_2309309498 = typeCheckingContext.reportWarning(asilLevelAttribute, "Computed value is not an ASIL level value", "r:7dd28beb-852f-4cb9-a9ef-606e5c22fd02(org.iets3.safety.attributes.typesystem)", "8260870742552072112", null, errorTarget);
          }
        } else {
          {
            final MessageTarget errorTarget = new NodeMessageTarget();
            IErrorReporter _reporter_2309309498 = typeCheckingContext.reportWarning(asilLevelAttribute, "ComputedAsil is higher as one currently defined", "r:7dd28beb-852f-4cb9-a9ef-606e5c22fd02(org.iets3.safety.attributes.typesystem)", "4763876259335197894", null, errorTarget);
            {
              BaseQuickFixProvider intentionProvider = new BaseQuickFixProvider("org.iets3.safety.attributes.typesystem.acceptComputedAsil_QuickFix", "4763876259335490103", false);
              intentionProvider.putArgument("asilAttribute", asilLevelAttribute);
              intentionProvider.putArgument("computedAsilLevel", SNodeOperations.cast(computedValue, CONCEPTS.ASILLevelValue$fW));
              _reporter_2309309498.addIntentionProvider(intentionProvider);
            }
          }
        }
      }
    }
  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.ASILLevelAttribute$R9;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return false;
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ASILLevelValue$fW = MetaAdapterFactory.getConcept(0x3d5cb9202b5f4dcbL, 0x834968b4bf077e63L, 0x1b5a6519ee9e81e2L, "org.iets3.safety.attributes.structure.ASILLevelValue");
    /*package*/ static final SConcept ASILLevelAttribute$R9 = MetaAdapterFactory.getConcept(0x3d5cb9202b5f4dcbL, 0x834968b4bf077e63L, 0x3ce7d4897445a3bbL, "org.iets3.safety.attributes.structure.ASILLevelAttribute");
  }
}
