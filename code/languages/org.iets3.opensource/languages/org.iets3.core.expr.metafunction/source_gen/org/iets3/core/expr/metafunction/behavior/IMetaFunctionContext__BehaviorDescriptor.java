package org.iets3.core.expr.metafunction.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import org.jetbrains.mps.openapi.model.SNode;
import org.iets3.core.expr.base.plugin.EffectDescriptor;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.iets3.core.expr.base.behavior.Type__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SConceptOperations;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import java.util.Objects;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;

public final class IMetaFunctionContext__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getInterfaceConcept(0x711a16d799e84e1dL, 0xb20c99c0b7309cd8L, 0x53300f6d0c25a72bL, "org.iets3.core.expr.metafunction.structure.IMetaFunctionContext");

  public static final SMethod<Boolean> functionIsMandatory_id5cK3QOcGp_H = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("functionIsMandatory").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5994308065068947821L).languageId(0xb20c99c0b7309cd8L, 0x711a16d799e84e1dL).build2();
  public static final SMethod<SNode> createMetaFunction_id5cK3QOc9qti = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("createMetaFunction").modifiers(12, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5994308065059776338L).languageId(0xb20c99c0b7309cd8L, 0x711a16d799e84e1dL).build2();
  public static final SMethod<Boolean> isActualFunctionValid_id5cK3QOcKo8v = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("isActualFunctionValid").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5994308065069990431L).languageId(0xb20c99c0b7309cd8L, 0x711a16d799e84e1dL).build2();
  public static final SMethod<SNode> createNew_id6dpaV_AQiiy = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("createNew").modifiers(8, AccessPrivileges.PROTECTED).concept(CONCEPT).baseMethodId(7158801157976564898L).languageId(0xb20c99c0b7309cd8L, 0x711a16d799e84e1dL).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""), SMethodBuilder.createJavaParameter(String.class, ""));
  public static final SMethod<SNode> createNew_id3iESbJsmKkH = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("createNew").modifiers(0, AccessPrivileges.PROTECTED).concept(CONCEPT).baseMethodId(3795092733473522989L).languageId(0xb20c99c0b7309cd8L, 0x711a16d799e84e1dL).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""), SMethodBuilder.createJavaParameter(String.class, ""), SMethodBuilder.createJavaParameter(EffectDescriptor.class, ""));
  public static final SMethod<Void> syncNewMetaFunction_id68784T_q0lN = new SMethodBuilder<Void>(new SJavaCompoundTypeImpl(Void.class)).name("syncNewMetaFunction").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(7063650061634766195L).languageId(0xb20c99c0b7309cd8L, 0x711a16d799e84e1dL).build2(SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""), SMethodBuilder.createJavaParameter((Class<SNode>) ((Class) Object.class), ""));

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(functionIsMandatory_id5cK3QOcGp_H, createMetaFunction_id5cK3QOc9qti, isActualFunctionValid_id5cK3QOcKo8v, createNew_id6dpaV_AQiiy, createNew_id3iESbJsmKkH, syncNewMetaFunction_id68784T_q0lN);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static boolean functionIsMandatory_id5cK3QOcGp_H(@NotNull SNode __thisNode__) {
    return true;
  }
  /*package*/ static boolean isActualFunctionValid_id5cK3QOcKo8v(@NotNull SNode __thisNode__) {
    SNode template = IMetaFunctionContext__BehaviorDescriptor.createMetaFunction_id5cK3QOc9qti.invoke(__thisNode__);
    SNode actual = SLinkOperations.getTarget(__thisNode__, LINKS.function$1smc);
    if (template == null) {
      if (actual != null) {
        return false;
      }
    } else {
      if (SLinkOperations.getTarget(actual, LINKS.effect$J9aq) == null && SLinkOperations.getTarget(template, LINKS.effect$J9aq) != null) {
        return false;
      }
      if (SLinkOperations.getTarget(actual, LINKS.effect$J9aq) != null && SLinkOperations.getTarget(template, LINKS.effect$J9aq) != null) {
        if (SNodeOperations.getConcept(SLinkOperations.getTarget(actual, LINKS.effect$J9aq)) != SNodeOperations.getConcept(SLinkOperations.getTarget(template, LINKS.effect$J9aq))) {
          return false;
        }
      }
      if (((boolean) IMetaFunctionContext__BehaviorDescriptor.functionIsMandatory_id5cK3QOcGp_H.invoke(__thisNode__)) && actual == null) {
        return false;
      }
      if ((SLinkOperations.getTarget(template, LINKS.type$T$xn) == null) && (SLinkOperations.getTarget(actual, LINKS.type$T$xn) != null)) {
        return false;
      }
      if ((SLinkOperations.getTarget(template, LINKS.type$T$xn) != null) && (SLinkOperations.getTarget(actual, LINKS.type$T$xn) == null)) {
        return false;
      }
      if ((SLinkOperations.getTarget(template, LINKS.type$T$xn) != null) && !((boolean) Type__BehaviorDescriptor.isSameAs_idfIXgjlt4VE.invoke(SLinkOperations.getTarget(actual, LINKS.type$T$xn), SLinkOperations.getTarget(template, LINKS.type$T$xn)))) {
        return false;
      }
      if (ListSequence.fromList(SLinkOperations.getChildren(actual, LINKS.args$M3Dr)).count() != ListSequence.fromList(SLinkOperations.getChildren(template, LINKS.args$M3Dr)).count()) {
        return false;
      }
      for (SNode aa : ListSequence.fromList(SLinkOperations.getChildren(actual, LINKS.args$M3Dr))) {
        SNode ta = ListSequence.fromList(SLinkOperations.getChildren(template, LINKS.args$M3Dr)).getElement(SNodeOperations.getIndexInParent(aa));
        if (!(SPropertyOperations.getString(ta, PROPS.name$MnvL).equals(SPropertyOperations.getString(aa, PROPS.name$MnvL)))) {
          return false;
        }
        if (SLinkOperations.getTarget(ta, LINKS.type$EhVN) == null && SLinkOperations.getTarget(aa, LINKS.type$EhVN) != null) {
          return false;
        }
        if (SLinkOperations.getTarget(ta, LINKS.type$EhVN) != null && SLinkOperations.getTarget(aa, LINKS.type$EhVN) == null) {
          return false;
        }
        if (!((boolean) Type__BehaviorDescriptor.isSameAs_idfIXgjlt4VE.invoke(SLinkOperations.getTarget(ta, LINKS.type$EhVN), SLinkOperations.getTarget(aa, LINKS.type$EhVN)))) {
          return false;
        }
      }
    }
    return true;
  }
  /*package*/ static SNode createNew_id6dpaV_AQiiy(@NotNull SNode __thisNode__, SNode tp, String description) {
    SNode f = SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x711a16d799e84e1dL, 0xb20c99c0b7309cd8L, 0x53300f6d0c251610L, "org.iets3.core.expr.metafunction.structure.MetaFunction"));
    SLinkOperations.setTarget(f, LINKS.type$T$xn, tp);
    return f;
  }
  /*package*/ static SNode createNew_id3iESbJsmKkH(@NotNull SNode __thisNode__, SNode tp, String description, EffectDescriptor effect) {
    SNode mf = IMetaFunctionContext__BehaviorDescriptor.createNew_id6dpaV_AQiiy.invoke(__thisNode__, tp, description);
    if (effect.modifiesState() && !(effect.onlyReadsState())) {
      SLinkOperations.setTarget(mf, LINKS.effect$J9aq, SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x46bb4e10d3fbeaedL, "org.iets3.core.expr.lambda.structure.ModifyEffectTag")));
    } else if (!(effect.modifiesState()) && effect.onlyReadsState()) {
      SLinkOperations.setTarget(mf, LINKS.effect$J9aq, SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x46bb4e10d3fbeaecL, "org.iets3.core.expr.lambda.structure.ReadEffectTag")));
    } else if (effect.modifiesState() && effect.onlyReadsState()) {
      SLinkOperations.setTarget(mf, LINKS.effect$J9aq, SConceptOperations.createNewNode(MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x46bb4e10d3fbeaeeL, "org.iets3.core.expr.lambda.structure.ReadModifyEffectTag")));
    }
    return mf;
  }
  /*package*/ static void syncNewMetaFunction_id68784T_q0lN(@NotNull SNode __thisNode__, SNode existingF, SNode newF) {
    SLinkOperations.setTarget(existingF, LINKS.type$T$xn, SNodeOperations.copyNode(SLinkOperations.getTarget(newF, LINKS.type$T$xn)));
    SLinkOperations.setTarget(existingF, LINKS.effect$J9aq, SNodeOperations.copyNode(SLinkOperations.getTarget(newF, LINKS.effect$J9aq)));

    final Set<SNode> coveredArgs = SetSequence.fromSet(new HashSet<SNode>());
    for (final SNode newArg : ListSequence.fromList(SLinkOperations.getChildren(newF, LINKS.args$M3Dr))) {
      SNode found = ListSequence.fromList(SLinkOperations.getChildren(existingF, LINKS.args$M3Dr)).findFirst((it) -> Objects.equals(SPropertyOperations.getString(it, PROPS.name$MnvL), SPropertyOperations.getString(newArg, PROPS.name$MnvL)));
      SetSequence.fromSet(coveredArgs).addElement(found);
      if (found != null) {
        SLinkOperations.setTarget(found, LINKS.type$EhVN, SNodeOperations.copyNode(SLinkOperations.getTarget(newArg, LINKS.type$EhVN)));
      } else {
        SNode newNewArg = SNodeOperations.copyNode(newArg);
        ListSequence.fromList(SLinkOperations.getChildren(existingF, LINKS.args$M3Dr)).addElement(newNewArg);
        SetSequence.fromSet(coveredArgs).addElement(newNewArg);
      }
    }
    Iterable<SNode> noLongerThere = ListSequence.fromList(SLinkOperations.getChildren(existingF, LINKS.args$M3Dr)).where((it) -> !(SetSequence.fromSet(coveredArgs).contains(it)));
    Sequence.fromIterable(noLongerThere).visitAll((it) -> SNodeOperations.deleteNode(it));
  }

  /*package*/ IMetaFunctionContext__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((Boolean) functionIsMandatory_id5cK3QOcGp_H(node));
      case 2:
        return (T) ((Boolean) isActualFunctionValid_id5cK3QOcKo8v(node));
      case 3:
        return (T) ((SNode) createNew_id6dpaV_AQiiy(node, (SNode) parameters[0], (String) parameters[1]));
      case 4:
        return (T) ((SNode) createNew_id3iESbJsmKkH(node, (SNode) parameters[0], (String) parameters[1], (EffectDescriptor) parameters[2]));
      case 5:
        syncNewMetaFunction_id68784T_q0lN(node, (SNode) parameters[0], (SNode) parameters[1]);
        return null;
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink function$1smc = MetaAdapterFactory.getContainmentLink(0x711a16d799e84e1dL, 0xb20c99c0b7309cd8L, 0x53300f6d0c25a72bL, 0x53300f6d0c260151L, "function");
    /*package*/ static final SContainmentLink effect$J9aq = MetaAdapterFactory.getContainmentLink(0x711a16d799e84e1dL, 0xb20c99c0b7309cd8L, 0x53300f6d0c251610L, 0x34aae0bbdc4877afL, "effect");
    /*package*/ static final SContainmentLink type$T$xn = MetaAdapterFactory.getContainmentLink(0x711a16d799e84e1dL, 0xb20c99c0b7309cd8L, 0x53300f6d0c251610L, 0x53300f6d0c25287fL, "type");
    /*package*/ static final SContainmentLink args$M3Dr = MetaAdapterFactory.getContainmentLink(0x711a16d799e84e1dL, 0xb20c99c0b7309cd8L, 0x53300f6d0c251610L, 0x53300f6d0c251cd3L, "args");
    /*package*/ static final SContainmentLink type$EhVN = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x622163b5c76a6c48L, 0x7a477bfec24be9a9L, "type");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
