package org.iets3.core.expr.toplevel.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.iets3.core.expr.toplevel.behavior.FunctionCall__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.iets3.core.expr.base.plugin.Simplifier;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class CallInliner {

  public static void inlineAllCalls(SNode expr) {
    int i = 0;
    while (i < 100) {
      i++;
      Iterable<SNode> pureCalls = ListSequence.fromList(SNodeOperations.getNodeDescendants(expr, CONCEPTS.FunctionCall$bZ, true, new SAbstractConcept[]{})).where((it) -> (boolean) FunctionCall__BehaviorDescriptor.allArgsPure_id2nByCcxXVT$.invoke(it));
      if (Sequence.fromIterable(pureCalls).isEmpty()) {
        break;
      }
      FunctionCall__BehaviorDescriptor.inline_id2nByCcxXuAF.invoke(Sequence.fromIterable(pureCalls).first());
    }
    new Simplifier(expr).simplify();
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept FunctionCall$bZ = MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x427ce5230842b3ecL, "org.iets3.core.expr.toplevel.structure.FunctionCall");
  }
}
