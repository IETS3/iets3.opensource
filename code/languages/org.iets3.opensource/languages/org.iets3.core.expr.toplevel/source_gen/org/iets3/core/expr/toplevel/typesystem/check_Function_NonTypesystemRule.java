package org.iets3.core.expr.toplevel.typesystem;

/*Generated by MPS */

import jetbrains.mps.lang.typesystem.runtime.AbstractNonTypesystemRule_Runtime;
import jetbrains.mps.lang.typesystem.runtime.NonTypesystemRule_Runtime;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.typesystem.inference.TypeCheckingContext;
import jetbrains.mps.lang.typesystem.runtime.IsApplicableStatus;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.errors.messageTargets.MessageTarget;
import jetbrains.mps.errors.messageTargets.NodeMessageTarget;
import jetbrains.mps.errors.IErrorReporter;
import org.iets3.core.expr.base.behavior.IMayHaveEffect__BehaviorDescriptor;
import org.iets3.core.expr.base.plugin.EffectHelper;
import java.util.List;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;

public class check_Function_NonTypesystemRule extends AbstractNonTypesystemRule_Runtime implements NonTypesystemRule_Runtime {
  public check_Function_NonTypesystemRule() {
  }
  public void applyRule(final SNode f, final TypeCheckingContext typeCheckingContext, IsApplicableStatus status) {
    if (ListSequence.fromList(SNodeOperations.getNodeDescendants(f, CONCEPTS.FunctionCall$bZ, false, new SAbstractConcept[]{})).any((it) -> SLinkOperations.getTarget(it, LINKS.function$xJRS) == f)) {
      if (SLinkOperations.getTarget(f, LINKS.type$1eya) == null) {
        {
          final MessageTarget errorTarget = new NodeMessageTarget();
          IErrorReporter _reporter_2309309498 = typeCheckingContext.reportTypeError(f, "recursive functions need an explicit type", "r:8023e40c-26d4-4543-bd46-2ec2c03f861f(org.iets3.core.expr.toplevel.typesystem)", "543569365054002043", null, errorTarget);
        }
      }
    }
    if (IMayHaveEffect__BehaviorDescriptor.effectDescriptor_id6GySMNjjWfO.invoke(f).modifiesState() && !(new EffectHelper(SLinkOperations.getTarget(f, LINKS.body$Y8TB)).readsOrModifiesMutableState())) {
      {
        final MessageTarget errorTarget = new NodeMessageTarget();
        IErrorReporter _reporter_2309309498 = typeCheckingContext.reportWarning(SLinkOperations.getTarget(f, LINKS.body$Y8TB), "function is declared to have an effect, but the body has no effect. Remove effect flag?", "r:8023e40c-26d4-4543-bd46-2ec2c03f861f(org.iets3.core.expr.toplevel.typesystem)", "952298261452385461", null, errorTarget);
      }
    }
    // Trivial Warning -- do not show for instance in Test cases
    if ((SNodeOperations.getNodeAncestor(f, CONCEPTS.IIgnoreTrivialErrorsContext$v_, false, false) == null)) {
      List<SNode> argRefs = SNodeOperations.getNodeDescendants(f, CONCEPTS.ArgRef$HM, true, new SAbstractConcept[]{});
      for (final SNode arg : ListSequence.fromList(SLinkOperations.getChildren(f, LINKS.args$XOIh))) {
        if (!(ListSequence.fromList(argRefs).any((it) -> SLinkOperations.getTarget(it, LINKS.arg$Nd6m) == arg))) {
          {
            final MessageTarget errorTarget = new NodeMessageTarget();
            IErrorReporter _reporter_2309309498 = typeCheckingContext.reportWarning(arg, "unused argument", "r:8023e40c-26d4-4543-bd46-2ec2c03f861f(org.iets3.core.expr.toplevel.typesystem)", "1360296727223864549", null, errorTarget);
          }
        }
      }
    }
  }
  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.Function$iC;
  }
  public IsApplicableStatus isApplicableAndPattern(SNode argument) {
    return new IsApplicableStatus(argument.getConcept().isSubConceptOf(getApplicableConcept()), null);
  }
  public boolean overrides() {
    return false;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink type$1eya = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x62632b96c1ab0b7cL, 0x62632b96c1ab0b7dL, "type");
    /*package*/ static final SReferenceLink function$xJRS = MetaAdapterFactory.getReferenceLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce5230841f89cL, 0x427ce5230841f8a8L, "function");
    /*package*/ static final SContainmentLink body$Y8TB = MetaAdapterFactory.getContainmentLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523083b8a2fL, 0x427ce523083b8a56L, "body");
    /*package*/ static final SReferenceLink arg$Nd6m = MetaAdapterFactory.getReferenceLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523084037adL, 0x427ce52308410686L, "arg");
    /*package*/ static final SContainmentLink args$XOIh = MetaAdapterFactory.getContainmentLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523083b8a2fL, 0x427ce523083b8a3fL, "args");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept FunctionCall$bZ = MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x427ce5230842b3ecL, "org.iets3.core.expr.toplevel.structure.FunctionCall");
    /*package*/ static final SConcept ArgRef$HM = MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523084037adL, "org.iets3.core.expr.lambda.structure.ArgRef");
    /*package*/ static final SInterfaceConcept IIgnoreTrivialErrorsContext$v_ = MetaAdapterFactory.getInterfaceConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x364e1fe0b7f278b5L, "org.iets3.core.expr.base.structure.IIgnoreTrivialErrorsContext");
    /*package*/ static final SConcept Function$iC = MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x427ce523083c44a3L, "org.iets3.core.expr.toplevel.structure.Function");
  }
}
