package org.iets3.core.expr.toplevel.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import com.mbeddr.mpsutil.interpreter.rt.IContext;
import com.mbeddr.mpsutil.interpreter.rt.ICoverageAnalyzer;
import com.mbeddr.mpsutil.interpreter.rt.ComputationTrace;
import org.iets3.core.expr.toplevel.behavior.EnumLiteral__BehaviorDescriptor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import jetbrains.mps.lang.core.behavior.BaseConcept__BehaviorDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import java.util.Objects;
import jetbrains.mps.lang.smodel.ConceptSwitchIndex;
import jetbrains.mps.lang.smodel.ConceptSwitchIndexBuilder;
import jetbrains.mps.smodel.adapter.ids.MetaIdFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SProperty;

public class EnumLiteral implements Comparable<EnumLiteral> {

  private SNode enumDecl;
  private SNode literal;
  private Object literalValue;
  private IContext context;


  public static EnumLiteral getInstance(SNode literal, IContext ctx, ICoverageAnalyzer coverage, ComputationTrace ct) {
    EnumLiteral enumliteral = ((EnumLiteral) (ctx.getEnvironment().getRootEnvironment().getInCurrent(literal)));
    if (enumliteral == null) {
      enumliteral = new EnumLiteral(EnumLiteral__BehaviorDescriptor.enumDecl_id67Y8mp$M9$v.invoke(literal), literal, null);
      enumliteral.context = ctx;
      ctx.getEnvironment().getRootEnvironment().put(literal, enumliteral);
    }
    return enumliteral;
  }

  private static EnumLiteral getInstance(SNode literal, IContext ctx) {
    EnumLiteral enumliteral = ((EnumLiteral) (ctx.getEnvironment().getRootEnvironment().getInCurrent(literal)));
    if (enumliteral == null) {
      enumliteral = new EnumLiteral(EnumLiteral__BehaviorDescriptor.enumDecl_id67Y8mp$M9$v.invoke(literal), literal, null);
      enumliteral.context = ctx;
      ctx.getEnvironment().getRootEnvironment().put(literal, enumliteral);
    }
    return enumliteral;
  }


  private EnumLiteral() {
  }

  private EnumLiteral(SNode nodeEnumDeclaration, SNode literal, @Nullable Object literalValue) {
    assert nodeEnumDeclaration != null;
    enumDecl = nodeEnumDeclaration;
    this.literal = literal;
    this.literalValue = literalValue;
  }

  public SNode getLiteral() {
    return literal;
  }

  public Object getValue() {
    if (literalValue == null && (SLinkOperations.getTarget(literal, LINKS.value$ACwu) != null)) {
      // lazy initialisation is done without trace and converage:
      literalValue = context.getRootInterpreter().evaluate(SLinkOperations.getTarget(literal, LINKS.value$ACwu), context);
    }
    return literalValue;
  }

  public int getIndex() {
    if ((SLinkOperations.getTarget(enumDecl, LINKS.order$xb8A) != null)) {
      final List<EnumLiteral> literalList = ListSequence.fromList(new ArrayList<EnumLiteral>());
      ListSequence.fromList(SLinkOperations.getChildren(enumDecl, LINKS.literals$K_NE)).visitAll((it) -> ListSequence.fromList(literalList).addElement(EnumLiteral.getInstance(it, context)));
      return ListSequence.fromList(literalList).sort((a, b) -> a.compareTo(b), true).indexOf(this);
    }
    return getDeclarationIndex();
  }

  public int getDeclarationIndex() {
    return ListSequence.fromList(SLinkOperations.getChildren(enumDecl, LINKS.literals$K_NE)).indexOf(literal);
  }

  @Override
  public String toString() {
    return (String) BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(literal);
  }

  @Override
  public int compareTo(EnumLiteral other) {
    SAbstractConcept cncpt = SNodeOperations.getConcept(SLinkOperations.getTarget(enumDecl, LINKS.order$xb8A));
    switch (conceptIndex.index(cncpt)) {
      case 0:
        return this.getDeclarationIndex() - other.getDeclarationIndex();
      case 1:
        return SPropertyOperations.getString(this.literal, PROPS.name$MnvL).compareTo(SPropertyOperations.getString(other.literal, PROPS.name$MnvL));
      case 2:
        // normally it is ensured that this order can only be assigned when the value is an instance of Comparable so this is only to feel save
        getLiteral();
        assert getValue() instanceof Comparable;
        return as_iihb1j_a0a3a2b0ab(getValue(), Comparable.class).compareTo(as_iihb1j_a0a0d0c1a62(other.getValue(), Comparable.class));
      default:
    }
    return 0;
  }

  @Override
  public boolean equals(Object other) {
    if (other instanceof EnumLiteral) {
      EnumLiteral literal = (EnumLiteral) other;
      return Objects.equals(literal.literal, this.literal);
    }
    return false;
  }
  private static final ConceptSwitchIndex conceptIndex = new ConceptSwitchIndexBuilder().put(MetaIdFactory.conceptId(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x6d72ecc16d953d05L), MetaIdFactory.conceptId(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x6d72ecc16d953cffL), MetaIdFactory.conceptId(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x6d72ecc16d953d02L)).seal();
  private static <T> T as_iihb1j_a0a3a2b0ab(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_iihb1j_a0a0d0c1a62(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink value$ACwu = MetaAdapterFactory.getContainmentLink(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x61fe216664a72ed1L, 0x3f863cbc0116bc84L, "value");
    /*package*/ static final SContainmentLink literals$K_NE = MetaAdapterFactory.getContainmentLink(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x61fe216664a72eaeL, 0x61fe216664a72ef4L, "literals");
    /*package*/ static final SContainmentLink order$xb8A = MetaAdapterFactory.getContainmentLink(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x61fe216664a72eaeL, 0x6d72ecc16d953d0dL, "order");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }
}
