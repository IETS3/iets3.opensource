package org.iets3.core.expr.toplevel.behavior;

/*Generated by MPS */

import jetbrains.mps.core.aspects.behaviour.BaseBHDescriptor;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import jetbrains.mps.core.aspects.behaviour.api.SMethod;
import jetbrains.mps.core.aspects.behaviour.SMethodBuilder;
import jetbrains.mps.core.aspects.behaviour.SJavaCompoundTypeImpl;
import jetbrains.mps.core.aspects.behaviour.AccessPrivileges;
import org.iets3.core.expr.base.plugin.EffectDescriptor;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.Set;
import java.util.List;
import java.util.Arrays;
import org.jetbrains.annotations.NotNull;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.iets3.core.expr.base.behavior.IMayHaveEffect__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.typechecking.TypecheckingFacade;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.internal.collections.runtime.Sequence;
import java.util.Collections;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.IAttributeDescriptor;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import org.iets3.core.expr.base.behavior.ISSConstrainedValue__BehaviorDescriptor;
import org.iets3.analysis.base.plugin.STF;
import java.util.ArrayList;
import jetbrains.mps.core.aspects.behaviour.api.SConstructor;
import org.jetbrains.annotations.Nullable;
import jetbrains.mps.core.aspects.behaviour.api.BHMethodNotFoundException;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SProperty;
import org.jetbrains.mps.openapi.language.SConcept;

public final class ExtensionFunctionCall__BehaviorDescriptor extends BaseBHDescriptor {
  private static final SAbstractConcept CONCEPT = MetaAdapterFactory.getConcept(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x27b717d14a8f82d7L, "org.iets3.core.expr.toplevel.structure.ExtensionFunctionCall");

  public static final SMethod<String> renderReadable_id6kR0qIbI2yi = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("renderReadable").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(7293299957844945042L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<EffectDescriptor> effectDescriptor_id6GySMNjjWfO = new SMethodBuilder<EffectDescriptor>(new SJavaCompoundTypeImpl(EffectDescriptor.class)).name("effectDescriptor").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(7719982492929737716L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<Boolean> shouldDotExpressionBeSubstitutedAsConstrainedValue_id74u6qanLBRj = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("shouldDotExpressionBeSubstitutedAsConstrainedValue").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8150980561708940755L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<SNode> getISSVariable_id74u6qanSXND = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("getISSVariable").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8150980561710865641L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<String> getVariableName_id7BxfuU7QrrQ = new SMethodBuilder<String>(new SJavaCompoundTypeImpl(String.class)).name("getVariableName").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8782368843039880950L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<SNode> getVariableType_id7BxfuU7QrsR = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("getVariableType").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8782368843039881015L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<Boolean> isVariableTypeInferred_id1996aX6uZ1A = new SMethodBuilder<Boolean>(new SJavaCompoundTypeImpl(Boolean.TYPE)).name("isVariableTypeInferred").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1317611507063451750L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<Iterable<SNode>> getVariableConstraints_id7BxfuU7Qruw = new SMethodBuilder<Iterable<SNode>>(new SJavaCompoundTypeImpl((Class<Iterable<SNode>>) ((Class) Object.class))).name("getVariableConstraints").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8782368843039881120L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<Set<SNode>> getDependentValues_id1xFBUnwWaWp = new SMethodBuilder<Set<SNode>>(new SJavaCompoundTypeImpl((Class<Set<SNode>>) ((Class) Object.class))).name("getDependentValues").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(1759675614210600729L).languageId(0xb66a309a6e1a7290L, 0xcfaa4966b7d54b69L).build2();
  public static final SMethod<SNode> createSolverTask_id4pkidg67Lgb = new SMethodBuilder<SNode>(new SJavaCompoundTypeImpl((Class<SNode>) ((Class) Object.class))).name("createSolverTask").modifiers(8, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(5067755556171617291L).languageId(0x8fed954c202d18beL, 0xdb8bd0353f5141d8L).build2();
  public static final SMethod<List<SNode>> getPreconditions_id74u6qapyDcd = new SMethodBuilder<List<SNode>>(new SJavaCompoundTypeImpl((Class<List<SNode>>) ((Class) Object.class))).name("getPreconditions").modifiers(0, AccessPrivileges.PUBLIC).concept(CONCEPT).baseMethodId(8150980561738568461L).languageId(0xa0548c072591085fL, 0x71934284d7d145eeL).build2();

  private static final List<SMethod<?>> BH_METHODS = Arrays.<SMethod<?>>asList(renderReadable_id6kR0qIbI2yi, effectDescriptor_id6GySMNjjWfO, shouldDotExpressionBeSubstitutedAsConstrainedValue_id74u6qanLBRj, getISSVariable_id74u6qanSXND, getVariableName_id7BxfuU7QrrQ, getVariableType_id7BxfuU7QrsR, isVariableTypeInferred_id1996aX6uZ1A, getVariableConstraints_id7BxfuU7Qruw, getDependentValues_id1xFBUnwWaWp, createSolverTask_id4pkidg67Lgb, getPreconditions_id74u6qapyDcd);

  private static void ___init___(@NotNull SNode __thisNode__) {
  }

  /*package*/ static String renderReadable_id6kR0qIbI2yi(@NotNull SNode __thisNode__) {
    return SPropertyOperations.getString(SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR), PROPS.name$MnvL) + "(" + SLinkOperations.getChildren(__thisNode__, LINKS.args$hM$s) + ")";
  }
  /*package*/ static EffectDescriptor effectDescriptor_id6GySMNjjWfO(@NotNull SNode __thisNode__) {
    return ((EffectDescriptor) IMayHaveEffect__BehaviorDescriptor.deriveFrom_id6KxoTHgL$U0.invoke(__thisNode__, SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR)));
  }
  /*package*/ static boolean shouldDotExpressionBeSubstitutedAsConstrainedValue_id74u6qanLBRj(@NotNull SNode __thisNode__) {
    return true;
  }
  /*package*/ static SNode getISSVariable_id74u6qanSXND(@NotNull SNode __thisNode__) {
    return __thisNode__;
  }
  /*package*/ static String getVariableName_id7BxfuU7QrrQ(@NotNull SNode __thisNode__) {
    return "extcall_" + SPropertyOperations.getString(SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR), PROPS.name$MnvL) + __thisNode__.getNodeId();
  }
  /*package*/ static SNode getVariableType_id7BxfuU7QrsR(@NotNull SNode __thisNode__) {
    if ((SLinkOperations.getTarget(SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR), LINKS.type$1eya) != null)) {
      return SLinkOperations.getTarget(SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR), LINKS.type$1eya);
    } else {
      return SNodeOperations.cast(TypecheckingFacade.getFromContext().getTypeOf(SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR)), CONCEPTS.Type$WK);
    }
  }
  /*package*/ static boolean isVariableTypeInferred_id1996aX6uZ1A(@NotNull SNode __thisNode__) {
    return (SLinkOperations.getTarget(SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR), LINKS.type$1eya) == null);
  }
  /*package*/ static Iterable<SNode> getVariableConstraints_id7BxfuU7Qruw(@NotNull final SNode __thisNode__) {
    SNode contract = SLinkOperations.getTarget(SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR), LINKS.contract$U1k2);
    List<SNode> postconditions = null;
    if ((contract != null)) {
      postconditions = ListSequence.fromList(SLinkOperations.getChildren(contract, LINKS.items$WD4d)).where((it) -> SNodeOperations.isInstanceOf(it, CONCEPTS.Postcondition$Hy)).select((it) -> SNodeOperations.copyNode(SLinkOperations.getTarget(it, LINKS.expr$CW3E))).toList();
    }
    if (postconditions != null) {
      ListSequence.fromList(postconditions).visitAll((constraint) -> {
        ListSequence.fromList(SNodeOperations.getNodeDescendants(constraint, CONCEPTS.FunResExpr$i2, true, new SAbstractConcept[]{})).visitAll((res) -> SNodeOperations.replaceWithAnother(res, createImplicitValidityValExpr_60r99q_a0a0a0a0a0a0a0a3a7(SNodeOperations.cast(TypecheckingFacade.getFromContext().getTypeOf(__thisNode__), CONCEPTS.Type$WK))));

        ListSequence.fromList(SNodeOperations.getNodeDescendants(constraint, CONCEPTS.ArgRef$HM, true, new SAbstractConcept[]{})).visitAll((ref) -> {
          int index = SNodeOperations.getIndexInParent(SLinkOperations.getTarget(ref, LINKS.arg$Nd6m));
          // TODO: add brackets around the expr
          SNode replacement = null;
          if (index > 0) {
            replacement = SNodeOperations.copyNode(ListSequence.fromList(SLinkOperations.getChildren(__thisNode__, LINKS.args$hM$s)).getElement(index - 1));
          } else {
            replacement = SNodeOperations.copyNode(SLinkOperations.getTarget(SNodeOperations.cast(SNodeOperations.getParent(__thisNode__), CONCEPTS.DotExpression$jp), LINKS.expr$CW3E));
          }

          SNodeOperations.replaceWithAnother(ref, replacement);
        });
      });
      return postconditions;
    } else {
      return Sequence.fromIterable(Collections.<SNode>emptyList());
    }
  }
  /*package*/ static Set<SNode> getDependentValues_id1xFBUnwWaWp(@NotNull final SNode __thisNode__) {
    if ((new IAttributeDescriptor.NodeAttribute(CONCEPTS.AttachedConstraint$eO).get(__thisNode__) != null)) {
      return SetSequence.fromSetWithValues(new HashSet<SNode>(), ListSequence.fromList(SLinkOperations.getChildren(new IAttributeDescriptor.NodeAttribute(CONCEPTS.AttachedConstraint$eO).get(__thisNode__), LINKS.constraints$Dcbb)).translate((it) -> ((Set<SNode>) ISSConstrainedValue__BehaviorDescriptor.extractValuesFromExpression_id1xFBUnx0h1Q.invoke(__thisNode__, it))));
    } else {
      return SetSequence.fromSet(new HashSet<SNode>());
    }
  }
  /*package*/ static SNode createSolverTask_id4pkidg67Lgb(@NotNull SNode __thisNode__) {
    return STF.createSolverTask(__thisNode__, "precondition");
  }
  /*package*/ static List<SNode> getPreconditions_id74u6qapyDcd(@NotNull final SNode __thisNode__) {
    SNode contract = SLinkOperations.getTarget(SLinkOperations.getTarget(__thisNode__, LINKS.extFun$udGR), LINKS.contract$U1k2);
    List<SNode> preconditions = null;
    if ((contract != null)) {
      preconditions = ListSequence.fromList(SLinkOperations.getChildren(contract, LINKS.items$WD4d)).where((it) -> SNodeOperations.isInstanceOf(it, CONCEPTS.Precondition$kn)).select((it) -> SLinkOperations.getTarget(it, LINKS.expr$CW3E)).toList();
    }

    final List<SNode> result = ListSequence.fromList(new ArrayList<SNode>());
    if (preconditions != null) {
      ListSequence.fromList(preconditions).visitAll((c) -> {
        SNode constraint = SNodeOperations.copyNode(c);
        for (SNode ref : ListSequence.fromList(SNodeOperations.getNodeDescendants(constraint, CONCEPTS.ArgRef$HM, true, new SAbstractConcept[]{}))) {
          int index = SNodeOperations.getIndexInParent(SLinkOperations.getTarget(ref, LINKS.arg$Nd6m));
          if (index < 0) {
            continue;
          }
          SNode replacement = null;
          if (index > 0) {
            List<SNode> args = SLinkOperations.getChildren(__thisNode__, LINKS.args$hM$s);
            replacement = SNodeOperations.copyNode(ListSequence.fromList(args).getElement(index));
          } else {
            replacement = SNodeOperations.copyNode(SLinkOperations.getTarget(SNodeOperations.cast(SNodeOperations.getParent(__thisNode__), CONCEPTS.DotExpression$jp), LINKS.expr$CW3E));
          }
          SNodeOperations.replaceWithAnother(ref, replacement);
        }
        ListSequence.fromList(result).addElement(constraint);
      });
    }
    return result;
  }

  /*package*/ ExtensionFunctionCall__BehaviorDescriptor() {
  }

  @Override
  protected void initNode(@NotNull SNode node, @NotNull SConstructor constructor, @Nullable Object[] parameters) {
    ___init___(node);
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SNode node, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      case 0:
        return (T) ((String) renderReadable_id6kR0qIbI2yi(node));
      case 1:
        return (T) ((EffectDescriptor) effectDescriptor_id6GySMNjjWfO(node));
      case 2:
        return (T) ((Boolean) shouldDotExpressionBeSubstitutedAsConstrainedValue_id74u6qanLBRj(node));
      case 3:
        return (T) ((SNode) getISSVariable_id74u6qanSXND(node));
      case 4:
        return (T) ((String) getVariableName_id7BxfuU7QrrQ(node));
      case 5:
        return (T) ((SNode) getVariableType_id7BxfuU7QrsR(node));
      case 6:
        return (T) ((Boolean) isVariableTypeInferred_id1996aX6uZ1A(node));
      case 7:
        return (T) ((Iterable<SNode>) getVariableConstraints_id7BxfuU7Qruw(node));
      case 8:
        return (T) ((Set<SNode>) getDependentValues_id1xFBUnwWaWp(node));
      case 9:
        return (T) ((SNode) createSolverTask_id4pkidg67Lgb(node));
      case 10:
        return (T) ((List<SNode>) getPreconditions_id74u6qapyDcd(node));
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @Override
  protected <T> T invokeSpecial0(@NotNull SAbstractConcept concept, @NotNull SMethod<T> method, @Nullable Object[] parameters) {
    int methodIndex = BH_METHODS.indexOf(method);
    if (methodIndex < 0) {
      throw new BHMethodNotFoundException(this, method);
    }
    switch (methodIndex) {
      default:
        throw new BHMethodNotFoundException(this, method);
    }
  }

  @NotNull
  @Override
  public List<SMethod<?>> getDeclaredMethods() {
    return BH_METHODS;
  }

  @NotNull
  @Override
  public SAbstractConcept getConcept() {
    return CONCEPT;
  }
  private static SNode createImplicitValidityValExpr_60r99q_a0a0a0a0a0a0a0a3a7(SNode p0) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ImplicitValidityValExpr$PU);
    n0.forChild(LINKS.type$EhVN).initNode(p0, CONCEPTS.Type$WK, true);
    return n0.getResult();
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink extFun$udGR = MetaAdapterFactory.getReferenceLink(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x27b717d14a8f82d7L, 0x27b717d14a8f82e8L, "extFun");
    /*package*/ static final SContainmentLink args$hM$s = MetaAdapterFactory.getContainmentLink(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x27b717d14a8f82d7L, 0x27b717d14a903157L, "args");
    /*package*/ static final SContainmentLink type$1eya = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x62632b96c1ab0b7cL, 0x62632b96c1ab0b7dL, "type");
    /*package*/ static final SContainmentLink contract$U1k2 = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0xc0aff242212e4a3L, 0xc0aff242212e562L, "contract");
    /*package*/ static final SContainmentLink items$WD4d = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0xc0aff242212e561L, 0xc0aff242212e565L, "items");
    /*package*/ static final SContainmentLink expr$CW3E = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x3b256bb6ae8048d8L, 0x3b256bb6ae8048d9L, "expr");
    /*package*/ static final SReferenceLink arg$Nd6m = MetaAdapterFactory.getReferenceLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523084037adL, 0x427ce52308410686L, "arg");
    /*package*/ static final SContainmentLink constraints$Dcbb = MetaAdapterFactory.getContainmentLink(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x3ddd6288d2af4e89L, 0x3ddd6288d2af4e93L, "constraints");
    /*package*/ static final SContainmentLink type$EhVN = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x622163b5c76a6c48L, 0x7a477bfec24be9a9L, "type");
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Type$WK = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x670d5e92f854a614L, "org.iets3.core.expr.base.structure.Type");
    /*package*/ static final SConcept Postcondition$Hy = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0xc0aff242212e5ecL, "org.iets3.core.expr.base.structure.Postcondition");
    /*package*/ static final SConcept FunResExpr$i2 = MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0xc0aff24223ad8b6L, "org.iets3.core.expr.lambda.structure.FunResExpr");
    /*package*/ static final SConcept ArgRef$HM = MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x427ce523084037adL, "org.iets3.core.expr.lambda.structure.ArgRef");
    /*package*/ static final SConcept DotExpression$jp = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x7cef88020a0f4249L, "org.iets3.core.expr.base.structure.DotExpression");
    /*package*/ static final SConcept AttachedConstraint$eO = MetaAdapterFactory.getConcept(0x9464fa065ab9409bL, 0x927464ab29588457L, 0x3ddd6288d2af4e89L, "org.iets3.core.expr.lambda.structure.AttachedConstraint");
    /*package*/ static final SConcept Precondition$kn = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0xc0aff242212e55dL, "org.iets3.core.expr.base.structure.Precondition");
    /*package*/ static final SConcept ImplicitValidityValExpr$PU = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x7211e500642440d1L, "org.iets3.core.expr.base.structure.ImplicitValidityValExpr");
  }
}
