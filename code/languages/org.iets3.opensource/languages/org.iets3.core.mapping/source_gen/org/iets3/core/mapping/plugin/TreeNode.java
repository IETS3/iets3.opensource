package org.iets3.core.mapping.plugin;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import org.iets3.components.core.behavior.Component__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.ArrayList;
import java.util.Objects;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class TreeNode extends AbstractTreeNode {
  private SNode instance;

  public SNode getInstace() {
    return this.instance;
  }

  public TreeNode(SNode instance) {
    this.instance = instance;
  }

  public static TreeNode fromComponentInstance(SNode instance) {
    TreeNode treeNode = new TreeNode(instance);
    treeNode.initTreeNode();

    return treeNode;
  }

  private void initTreeNode() {
    for (SNode inst : Sequence.fromIterable(SNodeOperations.ofConcept(Component__BehaviorDescriptor.allSubstructure_idsiw10FnrMt.invoke(SLinkOperations.getTarget(SLinkOperations.getTarget(this.instance, LINKS.component$xlLY), LINKS.ref$KPLr)), CONCEPTS.ComponentInstance$7c))) {
      TreeNode child = TreeNode.fromComponentInstance(inst);
      // set instancename as path
      child.setPath(SPropertyOperations.getString(inst, PROPS.name$MnvL));
      addChild(child);
    }
  }

  public static void markNode(TreeNode node, final List<String> mappedNodes) {
    mark(node, mappedNodes);
    if (node.isLeaf()) {
      return;
    } else {
      ListSequence.fromList(node.getChildren()).visitAll((it) -> {
        TreeNode child = as_bzu3qo_a0a0a0a0a0a1a01(it, TreeNode.class);
        mark(child, mappedNodes);
        markNode(child, mappedNodes);
      });
    }
  }
  public List<TreeNode> collectLeafs() {
    final List<TreeNode> leafs = ListSequence.fromList(new ArrayList<TreeNode>());
    if (this.isLeaf()) {
      ListSequence.fromList(leafs).addElement(this);
    } else {
      ListSequence.fromList(this.getChildren()).visitAll((it) -> {
        TreeNode child = as_bzu3qo_a0a0a0a0a0a1a11(it, TreeNode.class);
        ListSequence.fromList(leafs).addSequence(ListSequence.fromList(child.collectLeafs()));
      });
    }

    return leafs;
  }
  public List<TreeNode> collectNodes() {
    final List<TreeNode> leafs = ListSequence.fromList(new ArrayList<TreeNode>());
    ListSequence.fromList(leafs).addElement(this);
    if (!(this.isLeaf())) {
      ListSequence.fromList(this.getChildren()).visitAll((it) -> {
        TreeNode child = as_bzu3qo_a0a0a0a0a0c0m(it, TreeNode.class);
        ListSequence.fromList(leafs).addSequence(ListSequence.fromList(child.collectNodes()));
      });
    }

    return leafs;
  }
  private static void mark(TreeNode node, List<String> mappedNodes) {
    if (ListSequence.fromList(mappedNodes).contains(node.getPath())) {
      node.setMapped(true);
    }
  }

  public void addChild(TreeNode child) {
    child.setParent(this);
    ListSequence.fromList(this.getChildren()).addElement(child);
  }

  @Override
  public boolean equals(Object node) {
    if (node == null) {
      return false;
    }
    if (node == this) {
      return true;
    }
    if (node.getClass() != getClass()) {
      return false;
    }
    return Objects.equals((as_bzu3qo_a0a0a0d0r(node, TreeNode.class)).instance, this.instance) && ((as_bzu3qo_a0a0a0a3a71(node, TreeNode.class)).isMapped() == this.isMapped());
  }

  @Override
  public SNode getValue() {
    return instance;
  }
  private static <T> T as_bzu3qo_a0a0a0a0a0a1a01(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_bzu3qo_a0a0a0a0a0a1a11(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_bzu3qo_a0a0a0a0a0c0m(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_bzu3qo_a0a0a0d0r(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_bzu3qo_a0a0a0a3a71(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink component$xlLY = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x2fa41bd61d1549deL, 0x2fa41bd61d154b21L, "component");
    /*package*/ static final SReferenceLink ref$KPLr = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e4b67eeL, 0x6c4f9fd23e4b67efL, "ref");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ComponentInstance$7c = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e558729L, "org.iets3.components.core.structure.ComponentInstance");
  }
}
