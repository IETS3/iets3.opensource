package org.iets3.core.expr.typetags.physunits.behavior;

/*Generated by MPS */

import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import org.jetbrains.mps.openapi.model.SNode;
import java.util.List;
import jetbrains.mps.internal.collections.runtime.IMapping;
import jetbrains.mps.internal.collections.runtime.ListSequence;

public abstract class AbstractUnitPrefixManager<T extends AbstractUnitPrefix> {
  public Map<String, T> prefixExps = MapSequence.fromMap(new HashMap<String, T>());

  public abstract boolean supportsPrefix(SNode unit);

  public abstract int getBase();

  public List<IMapping<String, T>> getAvailablePrefixes() {
    return MapSequence.fromMap(prefixExps).toList();
  }

  public T findPrefix(String prefix) {
    return MapSequence.fromMap(prefixExps).get(prefix);
  }

  public boolean isValidPrefix(String str) {
    final String prefix = sanitizePrefix(str);
    return ListSequence.fromList(getAvailablePrefixes()).any((it) -> it.key().equalsIgnoreCase(prefix)) || (str == null || str.length() == 0);
  }

  public IMapping<String, T> extractPrefix(SNode unit, String str) {
    final String pattern = sanitizePrefix(str);
    if (pattern.length() < 2 || !(supportsPrefix(unit))) {
      return null;
    }
    IMapping<String, T> prefix = ListSequence.fromList(getAvailablePrefixes()).where((it) -> pattern.startsWith(it.key())).sort((a, b) -> a.key().length(), true).last();
    if (prefix != null) {
      return prefix;
    }
    return null;
  }

  public String sanitizePrefix(String prefix) {
    if (prefix == null) {
      return null;
    }
    return (prefix.indexOf(".") != -1 ? prefix.substring(prefix.indexOf(".") + 1) : prefix);
  }

}
