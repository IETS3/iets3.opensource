package org.iets3.core.expr.typetags.physunits.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import java.util.Queue;
import jetbrains.mps.internal.collections.runtime.QueueSequence;
import java.util.LinkedList;
import java.util.Set;
import jetbrains.mps.internal.collections.runtime.SetSequence;
import java.util.HashSet;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class ExpressionChecker {

  public static boolean isSelfReferencingSpecifier(SNode specifier) {
    Queue<SNode> queue = QueueSequence.fromQueue(new LinkedList<SNode>());
    Set<SNode> seenSpecifiers = SetSequence.fromSet(new HashSet<SNode>());

    for (SNode convertExpression : ListSequence.fromList(SNodeOperations.getNodeDescendants(SLinkOperations.getTarget(specifier, LINKS.expression$BZ0p), CONCEPTS.ConvertExpression$Xc, true, new SAbstractConcept[]{}))) {
      if (SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$hrvU) != null) {
        QueueSequence.fromQueue(queue).addLastElement(SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$hrvU));
      }
    }

    while (QueueSequence.fromQueue(queue).isNotEmpty()) {
      SNode head = QueueSequence.fromQueue(queue).removeFirstElement();
      if (head == specifier) {
        return true;
      }
      SetSequence.fromSet(seenSpecifiers).addElement(head);

      for (SNode convertExpression : ListSequence.fromList(SNodeOperations.getNodeDescendants(SLinkOperations.getTarget(head, LINKS.expression$BZ0p), CONCEPTS.ConvertExpression$Xc, true, new SAbstractConcept[]{}))) {
        if (SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$hrvU) != null && !(SetSequence.fromSet(seenSpecifiers).contains(SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$hrvU)))) {
          QueueSequence.fromQueue(queue).addLastElement(SLinkOperations.getTarget(convertExpression, LINKS.conversionSpecifier$hrvU));
        }
      }
    }

    return SetSequence.fromSet(seenSpecifiers).contains(specifier);
  }

  public static boolean hasDivExpressionBeforeMulExpression(SNode expression) {
    Queue<SNode> expressions = QueueSequence.fromQueue(new LinkedList<SNode>());
    QueueSequence.fromQueue(expressions).addLastElement(expression);

    while (QueueSequence.fromQueue(expressions).isNotEmpty()) {
      SNode head = QueueSequence.fromQueue(expressions).removeFirstElement();
      if (SNodeOperations.isInstanceOf(head, CONCEPTS.ParensExpression$Tv)) {
        QueueSequence.fromQueue(expressions).addLastElement(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.ParensExpression$Tv), LINKS.expr$CW3E));
      } else if (SNodeOperations.isInstanceOf(head, CONCEPTS.BinaryExpression$j$)) {
        if (SNodeOperations.isInstanceOf(head, CONCEPTS.DivExpression$us) && hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.DivExpression$us), LINKS.right$zBjx), CONCEPTS.MulExpression$iC)) {
          return true;
        } else if (SNodeOperations.isInstanceOf(head, CONCEPTS.MulExpression$iC) && hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.MulExpression$iC), LINKS.left$zxUa), CONCEPTS.DivExpression$us)) {
          return true;
        } else {
          QueueSequence.fromQueue(expressions).addLastElement(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.BinaryExpression$j$), LINKS.left$zxUa));
          QueueSequence.fromQueue(expressions).addLastElement(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.BinaryExpression$j$), LINKS.right$zBjx));
        }
      } else if (SNodeOperations.isInstanceOf(head, CONCEPTS.ConvertExpression$Xc)) {
        QueueSequence.fromQueue(expressions).addLastElement(SLinkOperations.getTarget(SNodeOperations.cast(head, CONCEPTS.ConvertExpression$Xc), LINKS.expr$CW3E));
      }
    }

    return false;
  }

  public static boolean hasExpression(SNode expression, SAbstractConcept expressionConcept) {
    if (SNodeOperations.isInstanceOf(expression, CONCEPTS.BinaryExpression$j$)) {
      if (SNodeOperations.isInstanceOf(expression, SNodeOperations.asSConcept(expressionConcept))) {
        return true;
      } else {
        return hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(expression, CONCEPTS.BinaryExpression$j$), LINKS.left$zxUa), expressionConcept) || hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(expression, CONCEPTS.BinaryExpression$j$), LINKS.right$zBjx), expressionConcept);
      }
    } else if (SNodeOperations.isInstanceOf(expression, CONCEPTS.ParensExpression$Tv)) {
      return hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(expression, CONCEPTS.ParensExpression$Tv), LINKS.expr$CW3E), expressionConcept);
    } else if (SNodeOperations.isInstanceOf(expression, CONCEPTS.ConvertExpression$Xc)) {
      return hasExpression(SLinkOperations.getTarget(SNodeOperations.cast(expression, CONCEPTS.ConvertExpression$Xc), LINKS.expr$CW3E), expressionConcept);
    } else {
      return false;
    }
  }

  private static final class LINKS {
    /*package*/ static final SReferenceLink conversionSpecifier$hrvU = MetaAdapterFactory.getReferenceLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x3930d8ab4c0e6285L, 0x8ac4b7baaeabc73L, "conversionSpecifier");
    /*package*/ static final SContainmentLink expression$BZ0p = MetaAdapterFactory.getContainmentLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x182c7aae9fea4574L, 0x182c7aae9fee3f05L, "expression");
    /*package*/ static final SContainmentLink expr$CW3E = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x3b256bb6ae8048d8L, 0x3b256bb6ae8048d9L, "expr");
    /*package*/ static final SContainmentLink right$zBjx = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86c99c15L, 0x46ff3b3d86c99c18L, "right");
    /*package*/ static final SContainmentLink left$zxUa = MetaAdapterFactory.getContainmentLink(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86c99c15L, 0x46ff3b3d86c99c16L, "left");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept ConvertExpression$Xc = MetaAdapterFactory.getConcept(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x3930d8ab4c0e6285L, "org.iets3.core.expr.typetags.physunits.structure.ConvertExpression");
    /*package*/ static final SConcept ParensExpression$Tv = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86d2f11fL, "org.iets3.core.expr.base.structure.ParensExpression");
    /*package*/ static final SConcept BinaryExpression$j$ = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86c99c15L, "org.iets3.core.expr.base.structure.BinaryExpression");
    /*package*/ static final SConcept DivExpression$us = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86cac63bL, "org.iets3.core.expr.base.structure.DivExpression");
    /*package*/ static final SConcept MulExpression$iC = MetaAdapterFactory.getConcept(0xcfaa4966b7d54b69L, 0xb66a309a6e1a7290L, 0x46ff3b3d86c9a56fL, "org.iets3.core.expr.base.structure.MulExpression");
  }
}
