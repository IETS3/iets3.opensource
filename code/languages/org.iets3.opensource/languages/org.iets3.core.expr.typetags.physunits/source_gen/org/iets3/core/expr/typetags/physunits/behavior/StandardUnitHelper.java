package org.iets3.core.expr.typetags.physunits.behavior;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import org.jetbrains.mps.openapi.module.SRepository;
import java.util.Objects;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPropertyOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SPointerOperations;
import jetbrains.mps.smodel.SNodePointer;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import java.util.List;
import java.util.ArrayList;
import java.util.LinkedList;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import jetbrains.mps.lang.core.behavior.BaseConcept__BehaviorDescriptor;
import org.jetbrains.mps.openapi.model.SModel;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.project.Solution;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SModelOperations;
import org.jetbrains.mps.openapi.language.SProperty;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;

public class StandardUnitHelper {
  public static boolean isUnitLessUnit(SNode unit, SRepository repository) {
    return Objects.equals(SPropertyOperations.getString(unit, PROPS.name$MnvL), SPropertyOperations.getString(getUnitLessUnit(repository), PROPS.name$MnvL));
  }

  public static SNode getUnitLessUnit(SRepository repository) {
    return SPointerOperations.resolveNode(new SNodePointer("r:4134cae9-4017-4808-bf1c-768cb21cb9ea(org.iets3.core.expr.typetags.phyunits.si.units)", "3572715678515562186"), repository);
  }

  public static boolean isUnspecifiedQuantity(SNode quantity, SRepository repository) {
    return Objects.equals(SPropertyOperations.getString(quantity, PROPS.name$MnvL), SPropertyOperations.getString(getUnspecifiedQuantity(repository), PROPS.name$MnvL));
  }

  public static SNode getUnspecifiedQuantity(SRepository repository) {
    return SPointerOperations.resolveNode(new SNodePointer("r:4134cae9-4017-4808-bf1c-768cb21cb9ea(org.iets3.core.expr.typetags.phyunits.si.units)", "4067340399592148754"), repository);
  }

  public static boolean isSiUnit(final SNode unit, boolean includeDerived, SRepository repository) {
    return ListSequence.fromList(getAllSiUnits(includeDerived, repository)).any((it) -> Objects.equals(SPropertyOperations.getString(it, PROPS.name$MnvL), SPropertyOperations.getString(unit, PROPS.name$MnvL)));
  }

  public static boolean isSiQuantity(final SNode quantity, SRepository repository) {
    return ListSequence.fromList(getAllSiQuantities(repository)).any((it) -> Objects.equals(SPropertyOperations.getString(it, PROPS.name$MnvL), SPropertyOperations.getString(quantity, PROPS.name$MnvL)));
  }

  public static boolean isSiConversionRule(SNode rule, SRepository repository) {
    return ListSequence.fromList(getAllSiConversionsRule(repository)).contains(rule);
  }

  public static SNode getSIUnitsLibrary(SRepository repository) {
    return SPointerOperations.resolveNode(new SNodePointer("r:4134cae9-4017-4808-bf1c-768cb21cb9ea(org.iets3.core.expr.typetags.phyunits.si.units)", "4067340399592148752"), repository);
  }

  public static SNode findSiUnitsLibraryByName(List<SNode> libraries) {
    return ListSequence.fromList(libraries).findFirst((it) -> Objects.equals(SPropertyOperations.getString(it, PROPS.name$MnvL), "SIBaseUnits"));
  }

  public static SNode findSiUnitsDerivedAndScaledLibraryByName(List<SNode> libraries) {
    return ListSequence.fromList(libraries).findFirst((it) -> Objects.equals(SPropertyOperations.getString(it, PROPS.name$MnvL), "SIDerivedUnits"));
  }

  public static SNode getSIUnitsDerivedAndScaledLibrary(SRepository repository) {
    return SPointerOperations.resolveNode(new SNodePointer("r:4134cae9-4017-4808-bf1c-768cb21cb9ea(org.iets3.core.expr.typetags.phyunits.si.units)", "4067340399592148770"), repository);
  }

  public static SNode getUnitsOfInformationMetricLibrary(SRepository repository) {
    return SPointerOperations.resolveNode(new SNodePointer("r:4134cae9-4017-4808-bf1c-768cb21cb9ea(org.iets3.core.expr.typetags.phyunits.si.units)", "1140731015761843605"), repository);
  }

  public static SNode getUnitsOfInformationIECLibrary(SRepository repository) {
    return SPointerOperations.resolveNode(new SNodePointer("r:4134cae9-4017-4808-bf1c-768cb21cb9ea(org.iets3.core.expr.typetags.phyunits.si.units)", "1140731015761843608"), repository);
  }

  public static SNode getUnitsOfInformationJEDECLibrary(SRepository repository) {
    return SPointerOperations.resolveNode(new SNodePointer("r:4134cae9-4017-4808-bf1c-768cb21cb9ea(org.iets3.core.expr.typetags.phyunits.si.units)", "1140731015761843610"), repository);
  }

  public static List<SNode> getAllAdditionalLibraries(SRepository repository) {
    List<SNode> libraries = new ArrayList<SNode>();
    ListSequence.fromList(libraries).addElement(getSIUnitsDerivedAndScaledLibrary(repository));
    ListSequence.fromList(libraries).addElement(getUnitsOfInformationMetricLibrary(repository));
    ListSequence.fromList(libraries).addElement(getUnitsOfInformationIECLibrary(repository));
    ListSequence.fromList(libraries).addElement(getUnitsOfInformationJEDECLibrary(repository));
    return libraries;
  }

  public static List<SNode> getAllSiQuantities(SRepository repository) {
    List<SNode> quantities = ListSequence.fromList(new LinkedList<SNode>());
    ListSequence.fromList(quantities).addSequence(Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(getSIUnitsLibrary(repository), LINKS.contents$JUTD), CONCEPTS.Quantity$W4)));
    ListSequence.fromList(quantities).addSequence(ListSequence.fromList(getAllAdditionalLibraries(repository)).translate((it) -> SNodeOperations.ofConcept(SLinkOperations.getChildren(it, LINKS.contents$JUTD), CONCEPTS.Quantity$W4)));
    return quantities;
  }

  public static List<SNode> getAllSiConversionsRule(SRepository repository) {
    List<SNode> rules = ListSequence.fromList(new LinkedList<SNode>());
    ListSequence.fromList(rules).addSequence(Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(getSIUnitsLibrary(repository), LINKS.contents$JUTD), CONCEPTS.ConversionRule$iv)));
    ListSequence.fromList(rules).addSequence(ListSequence.fromList(getAllAdditionalLibraries(repository)).translate((it) -> SNodeOperations.ofConcept(SLinkOperations.getChildren(it, LINKS.contents$JUTD), CONCEPTS.ConversionRule$iv)));
    return rules;
  }

  public static List<SNode> getAllSiUnits(boolean includeDerivedAndAdditional, SRepository repository) {
    List<SNode> units = ListSequence.fromList(new LinkedList<SNode>());
    ListSequence.fromList(units).addSequence(Sequence.fromIterable(SNodeOperations.ofConcept(SLinkOperations.getChildren(getSIUnitsLibrary(repository), LINKS.contents$JUTD), CONCEPTS.Unit$Gq)));
    if (includeDerivedAndAdditional) {
      ListSequence.fromList(units).addSequence(ListSequence.fromList(getAllAdditionalLibraries(repository)).translate((it) -> SNodeOperations.ofConcept(SLinkOperations.getChildren(it, LINKS.contents$JUTD), CONCEPTS.Unit$Gq)));
    }
    return units;
  }

  public static SNode findSiUnitByName(final String name, boolean includeDerived, SRepository repository) {
    return ListSequence.fromList(getAllSiUnits(includeDerived, repository)).findFirst((it) -> Objects.equals(SPropertyOperations.getString(it, PROPS.name$MnvL), name));
  }

  public static String renderUnitSpecificationToString(SNode specification) {
    StringBuffer buffer = new StringBuffer();
    String sep = "";
    for (SNode component : ListSequence.fromList(UnitConversionUtil.extractUnitsFromMultiplication(SLinkOperations.getTarget(specification, LINKS.specification$d6YI)))) {
      buffer.append(sep).append(renderUnitExpressionToString(component));
      sep = " ? ";
    }
    return buffer.toString();
  }

  public static String renderUnitExpressionToString(SNode expr) {
    StringBuilder builder = new StringBuilder();

    {
      final SNode exponent = expr;
      if (SNodeOperations.isInstanceOf(exponent, CONCEPTS.UnitExponent$BW)) {
        builder.append(IGroupLike__BehaviorDescriptor.getName_id6Yx4TURG_yz.invoke(SLinkOperations.getTarget(exponent, LINKS.base$z8ie)));
        builder.append("^(");
        builder.append(BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(SLinkOperations.getTarget(exponent, LINKS.exponent$z83d)));
        builder.append(")");
        return builder.toString();
      }
    }

    {
      final SNode reference = expr;
      if (SNodeOperations.isInstanceOf(reference, CONCEPTS.UnitReference$Zo)) {
        builder.append(SPropertyOperations.getString(SLinkOperations.getTarget(reference, LINKS.unit$nTeG), PROPS.name$MnvL));
        return builder.toString();
      }
    }

    return BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(expr);
  }

  public static String renderQuantityExpressionToString(SNode expr) {
    StringBuilder builder = new StringBuilder();

    {
      final SNode exponent = expr;
      if (SNodeOperations.isInstanceOf(exponent, CONCEPTS.QuantityExponent$yd)) {
        builder.append(IGroupLike__BehaviorDescriptor.getName_id6Yx4TURG_yz.invoke(SLinkOperations.getTarget(exponent, LINKS.base$4f1J)));
        builder.append("^(");
        builder.append(BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(SLinkOperations.getTarget(exponent, LINKS.exponent$xhDu)));
        builder.append(")");
        return builder.toString();
      }
    }

    {
      final SNode reference = expr;
      if (SNodeOperations.isInstanceOf(reference, CONCEPTS.QuantityReference$ba)) {
        builder.append(SPropertyOperations.getString(SLinkOperations.getTarget(reference, LINKS.quantity$A_Kl), PROPS.name$MnvL));
        return builder.toString();
      }
    }

    return BaseConcept__BehaviorDescriptor.getPresentation_idhEwIMiw.invoke(expr);
  }

  public static Iterable<SNode> getAllNodesIncludingImported(SModel model, SAbstractConcept concept) {
    List<SNode> result = new ArrayList<SNode>();
    if (model.getModule() instanceof Solution) {
      Solution s = ((Solution) model.getModule());
      for (SModel mod : s.getModels()) {
        ListSequence.fromList(result).addSequence(ListSequence.fromList(SModelOperations.nodesIncludingImported(mod, SNodeOperations.asSConcept(concept))));
      }
    } else {
      ListSequence.fromList(result).addSequence(ListSequence.fromList(SModelOperations.nodesIncludingImported(model, SNodeOperations.asSConcept(concept))));
    }
    return ListSequence.fromList(result).distinct();
  }

  public static Iterable<SNode> getAllUnitsInModelIncludingImported(SModel model) {
    return SNodeOperations.ofConcept(getAllNodesIncludingImported(model, CONCEPTS.Unit$Gq), CONCEPTS.Unit$Gq);
  }

  public static Iterable<SNode> getAllConversionRulesInModelIncludingImported(SModel model) {
    return SNodeOperations.ofConcept(getAllNodesIncludingImported(model, CONCEPTS.ConversionRule$iv), CONCEPTS.ConversionRule$iv);
  }

  public static Iterable<SNode> getAllQuantitiesInModelIncludingImported(SModel model) {
    return SNodeOperations.ofConcept(getAllNodesIncludingImported(model, CONCEPTS.Quantity$W4), CONCEPTS.Quantity$W4);
  }

  private static final class PROPS {
    /*package*/ static final SProperty name$MnvL = MetaAdapterFactory.getProperty(0xceab519525ea4f22L, 0x9b92103b95ca8c0cL, 0x110396eaaa4L, 0x110396ec041L, "name");
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink contents$JUTD = MetaAdapterFactory.getContainmentLink(0x71934284d7d145eeL, 0xa0548c072591085fL, 0x78b257522c0608fL, 0x78b257522c06092L, "contents");
    /*package*/ static final SContainmentLink specification$d6YI = MetaAdapterFactory.getContainmentLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x73b48a125b0d411dL, 0x73b48a125b0dab03L, "specification");
    /*package*/ static final SContainmentLink base$z8ie = MetaAdapterFactory.getContainmentLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x74818abc54714f3eL, 0x74818abc54715a86L, "base");
    /*package*/ static final SContainmentLink exponent$z83d = MetaAdapterFactory.getContainmentLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x74818abc54714f3eL, 0x74818abc54715a85L, "exponent");
    /*package*/ static final SReferenceLink unit$nTeG = MetaAdapterFactory.getReferenceLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x73b48a125b0d4dc5L, 0x73b48a125b0daafcL, "unit");
    /*package*/ static final SContainmentLink base$4f1J = MetaAdapterFactory.getContainmentLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x729d46b7ce979cf7L, 0x1be25d17bc5c98a7L, "base");
    /*package*/ static final SContainmentLink exponent$xhDu = MetaAdapterFactory.getContainmentLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x729d46b7ce979cf7L, 0x70ccd48a59f31f35L, "exponent");
    /*package*/ static final SReferenceLink quantity$A_Kl = MetaAdapterFactory.getReferenceLink(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x729d46b7ce8b6fa3L, 0x729d46b7ce8b760cL, "quantity");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Quantity$W4 = MetaAdapterFactory.getConcept(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x1c3a590e2b660f17L, "org.iets3.core.expr.typetags.physunits.structure.Quantity");
    /*package*/ static final SConcept ConversionRule$iv = MetaAdapterFactory.getConcept(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0xed6abcb370b28cbL, "org.iets3.core.expr.typetags.physunits.structure.ConversionRule");
    /*package*/ static final SConcept Unit$Gq = MetaAdapterFactory.getConcept(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x73b48a125b0d373fL, "org.iets3.core.expr.typetags.physunits.structure.Unit");
    /*package*/ static final SConcept UnitExponent$BW = MetaAdapterFactory.getConcept(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x74818abc54714f3eL, "org.iets3.core.expr.typetags.physunits.structure.UnitExponent");
    /*package*/ static final SConcept UnitReference$Zo = MetaAdapterFactory.getConcept(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x73b48a125b0d4dc5L, "org.iets3.core.expr.typetags.physunits.structure.UnitReference");
    /*package*/ static final SConcept QuantityExponent$yd = MetaAdapterFactory.getConcept(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x729d46b7ce979cf7L, "org.iets3.core.expr.typetags.physunits.structure.QuantityExponent");
    /*package*/ static final SConcept QuantityReference$ba = MetaAdapterFactory.getConcept(0x7ee265bd59864709L, 0x86ed2c6daa33cd8cL, 0x729d46b7ce8b6fa3L, "org.iets3.core.expr.typetags.physunits.structure.QuantityReference");
  }
}
