package org.iets3.core.expr.typetags.physunits.behavior;

/*Generated by MPS */

import java.util.Map;
import jetbrains.mps.internal.collections.runtime.MapSequence;
import java.util.HashMap;
import java.text.Normalizer;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;

public class UnitNameReplacementHelper {
  public static Map<String, String> specialReplacements = MapSequence.fromMap(new HashMap<String, String>());
  public static Map<String, String> nameReplacementsReverse = MapSequence.fromMap(new HashMap<String, String>());
  public static Map<Character, String> superScriptMapping = MapSequence.fromMap(new HashMap<Character, String>());
  public static Map<Character, String> subScriptMapping = MapSequence.fromMap(new HashMap<Character, String>());

  static {
    // based on https://stackoverflow.com/a/17909597
    // some characters really don't exist in unicode

    // superscript

    MapSequence.fromMap(superScriptMapping).put('⁰', "0");
    MapSequence.fromMap(superScriptMapping).put('¹', "1");
    MapSequence.fromMap(superScriptMapping).put('²', "2");
    MapSequence.fromMap(superScriptMapping).put('³', "3");
    MapSequence.fromMap(superScriptMapping).put('⁴', "4");
    MapSequence.fromMap(superScriptMapping).put('⁵', "5");
    MapSequence.fromMap(superScriptMapping).put('⁶', "6");
    MapSequence.fromMap(superScriptMapping).put('⁷', "7");
    MapSequence.fromMap(superScriptMapping).put('⁸', "8");
    MapSequence.fromMap(superScriptMapping).put('⁹', "9");
    MapSequence.fromMap(superScriptMapping).put('⁺', "+");
    MapSequence.fromMap(superScriptMapping).put('⁻', "-");

    MapSequence.fromMap(superScriptMapping).put('ᴬ', "A");
    MapSequence.fromMap(superScriptMapping).put('ᴮ', "B");
    MapSequence.fromMap(superScriptMapping).put('ᴰ', "D");
    MapSequence.fromMap(superScriptMapping).put('ᴱ', "E");
    MapSequence.fromMap(superScriptMapping).put('ᴳ', "G");
    MapSequence.fromMap(superScriptMapping).put('ᴴ', "H");
    MapSequence.fromMap(superScriptMapping).put('ᴵ', "I");
    MapSequence.fromMap(superScriptMapping).put('ᴶ', "J");
    MapSequence.fromMap(superScriptMapping).put('ᴷ', "K");
    MapSequence.fromMap(superScriptMapping).put('ᴸ', "L");
    MapSequence.fromMap(superScriptMapping).put('ᴹ', "M");
    MapSequence.fromMap(superScriptMapping).put('ᴺ', "N");
    MapSequence.fromMap(superScriptMapping).put('ᴼ', "O");
    MapSequence.fromMap(superScriptMapping).put('ᴾ', "P");
    MapSequence.fromMap(superScriptMapping).put('ᴿ', "R");
    MapSequence.fromMap(superScriptMapping).put('ᵀ', "T");
    MapSequence.fromMap(superScriptMapping).put('ᵁ', "U");
    MapSequence.fromMap(superScriptMapping).put('ⱽ', "V");
    MapSequence.fromMap(superScriptMapping).put('ᵂ', "W");

    MapSequence.fromMap(superScriptMapping).put('ᵅ', Greeklish.toGreeklish("α"));
    MapSequence.fromMap(superScriptMapping).put('ᵝ', Greeklish.toGreeklish("Β"));
    MapSequence.fromMap(superScriptMapping).put('ᵞ', Greeklish.toGreeklish("γ"));
    MapSequence.fromMap(superScriptMapping).put('ᵟ', Greeklish.toGreeklish("δ"));
    MapSequence.fromMap(superScriptMapping).put('ᵋ', Greeklish.toGreeklish("ε"));
    MapSequence.fromMap(superScriptMapping).put('ᶿ', Greeklish.toGreeklish("Θ"));
    MapSequence.fromMap(superScriptMapping).put('ᶥ', Greeklish.toGreeklish("ι"));
    MapSequence.fromMap(superScriptMapping).put('ᶲ', Greeklish.toGreeklish("φ"));
    MapSequence.fromMap(superScriptMapping).put('ᵠ', Greeklish.toGreeklish("φ"));
    MapSequence.fromMap(superScriptMapping).put('ᵡ', Greeklish.toGreeklish("Χ"));

    // subscript

    MapSequence.fromMap(subScriptMapping).put('₀', "0");
    MapSequence.fromMap(subScriptMapping).put('₁', "1");
    MapSequence.fromMap(subScriptMapping).put('₂', "2");
    MapSequence.fromMap(subScriptMapping).put('₃', "3");
    MapSequence.fromMap(subScriptMapping).put('₄', "4");
    MapSequence.fromMap(subScriptMapping).put('₅', "5");
    MapSequence.fromMap(subScriptMapping).put('₆', "6");
    MapSequence.fromMap(subScriptMapping).put('₇', "7");
    MapSequence.fromMap(subScriptMapping).put('₈', "8");
    MapSequence.fromMap(subScriptMapping).put('₉', "9");
    MapSequence.fromMap(subScriptMapping).put('₊', "-");
    MapSequence.fromMap(subScriptMapping).put('₋', "-");

    MapSequence.fromMap(subScriptMapping).put('ₐ', "a");
    MapSequence.fromMap(subScriptMapping).put('ₑ', "e");
    MapSequence.fromMap(subScriptMapping).put('ₕ', "h");
    MapSequence.fromMap(subScriptMapping).put('ᵢ', "i");
    MapSequence.fromMap(subScriptMapping).put('ⱼ', "j");
    MapSequence.fromMap(subScriptMapping).put('ₖ', "k");
    MapSequence.fromMap(subScriptMapping).put('ₗ', "l");
    MapSequence.fromMap(subScriptMapping).put('ₘ', "m");
    MapSequence.fromMap(subScriptMapping).put('ₙ', "n");
    MapSequence.fromMap(subScriptMapping).put('ₒ', "o");
    MapSequence.fromMap(subScriptMapping).put('ₚ', "p");
    MapSequence.fromMap(subScriptMapping).put('ᵣ', "r");
    MapSequence.fromMap(subScriptMapping).put('ₛ', "s");
    MapSequence.fromMap(subScriptMapping).put('ₜ', "t");
    MapSequence.fromMap(subScriptMapping).put('ᵤ', "u");
    MapSequence.fromMap(subScriptMapping).put('ᵥ', "v");
    MapSequence.fromMap(subScriptMapping).put('ₓ', "x");
    MapSequence.fromMap(subScriptMapping).put('ᵦ', Greeklish.toGreeklish("β"));
    MapSequence.fromMap(subScriptMapping).put('ᵧ', Greeklish.toGreeklish("γ"));
    MapSequence.fromMap(subScriptMapping).put('ᵨ', Greeklish.toGreeklish("ρ"));
    MapSequence.fromMap(subScriptMapping).put('ᵩ', Greeklish.toGreeklish("φ"));
    MapSequence.fromMap(subScriptMapping).put('ᵪ', Greeklish.toGreeklish("Χ"));

    MapSequence.fromMap(specialReplacements).put("÷", "/");
    MapSequence.fromMap(specialReplacements).put("⋅", "");
    MapSequence.fromMap(specialReplacements).put("μ", "mu");
    MapSequence.fromMap(specialReplacements).put("µ", "mu");
    MapSequence.fromMap(specialReplacements).put("ℛ", "R");
    MapSequence.fromMap(specialReplacements).put("Ƒ", "F");

    MapSequence.fromMap(nameReplacementsReverse).put("/", "÷");
    MapSequence.fromMap(nameReplacementsReverse).put("mu", "µ");
  }

  public static String replaceSuperScriptCharacters(String input) {
    boolean needsCaret = true;
    StringBuilder builder = new StringBuilder();
    for (int i = 0; i < input.length(); i++) {
      char c = input.charAt(i);
      if (MapSequence.fromMap(superScriptMapping).containsKey(c)) {
        if (needsCaret) {
          builder.append("^");
          needsCaret = false;
        }
        builder.append(MapSequence.fromMap(superScriptMapping).get(c));
      } else {
        builder.append(c);
      }
    }
    return builder.toString();
  }

  public static String replaceSubScriptCharacters(String input) {
    boolean needsUnderScore = true;
    StringBuilder builder = new StringBuilder();
    for (int i = 0; i < input.length(); i++) {
      char c = input.charAt(i);
      if (MapSequence.fromMap(subScriptMapping).containsKey(c)) {
        if (needsUnderScore) {
          builder.append("_");
          needsUnderScore = false;
        }
        builder.append(MapSequence.fromMap(subScriptMapping).get(c));
      } else {
        builder.append(c);
      }
    }
    return builder.toString();
  }

  public static String removeAccents(String input) {
    return Normalizer.normalize(input, Normalizer.Form.NFD).replaceAll("\\p{M}", "");
  }

  public static String replaceUnitName(String input) {
    final Wrappers._T<String> result = new Wrappers._T<String>(removeAccents(Greeklish.toGreeklish(replaceSubScriptCharacters(replaceSuperScriptCharacters(input)))));
    MapSequence.fromMap(specialReplacements).visitAll((it) -> result.value = result.value.replace(it.key(), it.value()));

    return result.value;
  }
}
