package org.iets3.components.core.editor;

/*Generated by MPS */

import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.iets3.components.core.behavior.AbstractComponentInstanceBase__BehaviorDescriptor;
import jetbrains.mps.smodel.action.NodeFactoryManager;
import org.iets3.components.core.behavior.Component__BehaviorDescriptor;
import jetbrains.mps.internal.collections.runtime.ListSequence;
import org.iets3.components.core.behavior.PortCategory__BehaviorDescriptor;
import org.iets3.components.core.behavior.IPortType__BehaviorDescriptor;
import jetbrains.mps.smodel.builder.SNodeBuilder;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;
import org.jetbrains.mps.openapi.language.SReferenceLink;
import org.jetbrains.mps.openapi.language.SConcept;
import org.jetbrains.mps.openapi.language.SInterfaceConcept;

public class ComponentSubstructureDiagramHelper {

  /**
   * Creates Import- or ExportConnector. Either <code>outerPort</code> or <code>innerPortName</code> should not be null.
   * 
   * @param outerPort 
   * @param compInstanceBase 
   * @param innerPortName 
   */
  public static void createConnector(SNode outerPort, SNode compInstanceBase, String innerPortName) {
    SNode innerPort;
    if ((innerPortName == null || innerPortName.length() == 0)) {
      innerPort = createPort_c9v26g_a0a0b0b(SNodeOperations.copyNode(SLinkOperations.getTarget(outerPort, LINKS.type$5Gl6)), SNodeOperations.copyNode(SLinkOperations.getTarget(outerPort, LINKS.category$WD4l)));
      SNode component = AbstractComponentInstanceBase__BehaviorDescriptor.component_id77HYM7H$sfU.invoke(compInstanceBase);
      NodeFactoryManager.setupNode(CONCEPTS.Port$gs, innerPort, null, Component__BehaviorDescriptor.ensureCompInterface_idx8tpSAdmRF.invoke(component), SNodeOperations.getModel(component));
      ListSequence.fromList(Component__BehaviorDescriptor.interfaceContent_idx8tpSAdLM$.invoke(component)).addElement(innerPort);
    } else {
      innerPort = AbstractComponentInstanceBase__BehaviorDescriptor.findPortByID_idsiw10GLvYX.invoke(compInstanceBase, innerPortName);
      if ((outerPort == null)) {
        outerPort = createPort_c9v26g_a0a0b0a1a1(SNodeOperations.copyNode(SLinkOperations.getTarget(innerPort, LINKS.type$5Gl6)), SNodeOperations.copyNode(SLinkOperations.getTarget(innerPort, LINKS.category$WD4l)));
        SNode component = SNodeOperations.getNodeAncestor(compInstanceBase, CONCEPTS.Component$gR, false, false);
        NodeFactoryManager.setupNode(CONCEPTS.Port$gs, outerPort, null, Component__BehaviorDescriptor.ensureCompInterface_idx8tpSAdmRF.invoke(component), SNodeOperations.getModel(component));
        ListSequence.fromList(Component__BehaviorDescriptor.interfaceContent_idx8tpSAdLM$.invoke(component)).addElement(outerPort);
      }
    }
    SNode ss = SNodeOperations.getNodeAncestor(compInstanceBase, CONCEPTS.ComponentSubstructure$oB, false, false);
    if ((boolean) PortCategory__BehaviorDescriptor.isDirectional_idmIQkxfpvfA.invoke(SLinkOperations.getTarget(outerPort, LINKS.category$WD4l))) {
      if (!((boolean) PortCategory__BehaviorDescriptor.actsAsSourceOfConnector_idmIQkxfpv6p.invoke(SLinkOperations.getTarget(outerPort, LINKS.category$WD4l)))) {
        SNode importConnector = createImportConnector_c9v26g_a0a0a0d0b(IPortType__BehaviorDescriptor.createConnectorType_id4KDeVD8s9TJ.invoke(SLinkOperations.getTarget(outerPort, LINKS.type$5Gl6)), outerPort, compInstanceBase, innerPort);
        NodeFactoryManager.setupNode(CONCEPTS.ImportConnector$8o, importConnector, null, ss, SNodeOperations.getModel(ss));
        ListSequence.fromList(SLinkOperations.getChildren(ss, LINKS.contents$7e9r)).addElement(importConnector);
      } else {
        SNode exportConnector = createExportConnector_c9v26g_a0a0a0a3a1(IPortType__BehaviorDescriptor.createConnectorType_id4KDeVD8s9TJ.invoke(SLinkOperations.getTarget(outerPort, LINKS.type$5Gl6)), outerPort, compInstanceBase, innerPort);
        NodeFactoryManager.setupNode(CONCEPTS.ExportConnector$hw, exportConnector, null, ss, SNodeOperations.getModel(ss));
        ListSequence.fromList(SLinkOperations.getChildren(ss, LINKS.contents$7e9r)).addElement(exportConnector);
      }
    } else {
      SNode delegateConnector = createDelegateConnector_c9v26g_a0a0a3a1(IPortType__BehaviorDescriptor.createConnectorType_id4KDeVD8s9TJ.invoke(SLinkOperations.getTarget(outerPort, LINKS.type$5Gl6)), outerPort, compInstanceBase, innerPort);
      NodeFactoryManager.setupNode(CONCEPTS.DelegateConnector$uB, delegateConnector, null, ss, SNodeOperations.getModel(ss));
      ListSequence.fromList(SLinkOperations.getChildren(ss, LINKS.contents$7e9r)).addElement(delegateConnector);
    }
  }
  private static SNode createPort_c9v26g_a0a0b0b(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.Port$gs);
    n0.forChild(LINKS.type$5Gl6).initNode(p0, CONCEPTS.IPortType$DL, true);
    n0.forChild(LINKS.category$WD4l).initNode(p1, CONCEPTS.PortCategory$Wm, true);
    return n0.getResult();
  }
  private static SNode createPort_c9v26g_a0a0b0a1a1(SNode p0, SNode p1) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.Port$gs);
    n0.forChild(LINKS.type$5Gl6).initNode(p0, CONCEPTS.IPortType$DL, true);
    n0.forChild(LINKS.category$WD4l).initNode(p1, CONCEPTS.PortCategory$Wm, true);
    return n0.getResult();
  }
  private static SNode createImportConnector_c9v26g_a0a0a0d0b(SNode p0, SNode p1, SNode p2, SNode p3) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ImportConnector$8o);
    n0.forChild(LINKS.connectorType$8zQx).initNode(p0, CONCEPTS.IConnectorType$F7, true);
    n0.setReferenceTarget(LINKS.outerPort$3H4p, p1);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.targetInstance$ZsmL).init(CONCEPTS.InstanceRef$Gm);
      n1.setReferenceTarget(LINKS.ref$H$FL, p2);
    }
    n0.setReferenceTarget(LINKS.targetPort$ZxZ9, p3);
    return n0.getResult();
  }
  private static SNode createExportConnector_c9v26g_a0a0a0a3a1(SNode p0, SNode p1, SNode p2, SNode p3) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.ExportConnector$hw);
    n0.forChild(LINKS.connectorType$8zQx).initNode(p0, CONCEPTS.IConnectorType$F7, true);
    n0.setReferenceTarget(LINKS.outerPort$ffZi, p1);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.sourceInstance$fa_V).init(CONCEPTS.InstanceRef$Gm);
      n1.setReferenceTarget(LINKS.ref$H$FL, p2);
    }
    n0.setReferenceTarget(LINKS.sourcePort$fgej, p3);
    return n0.getResult();
  }
  private static SNode createDelegateConnector_c9v26g_a0a0a3a1(SNode p0, SNode p1, SNode p2, SNode p3) {
    SNodeBuilder n0 = new SNodeBuilder().init(CONCEPTS.DelegateConnector$uB);
    n0.forChild(LINKS.connectorType$8zQx).initNode(p0, CONCEPTS.IConnectorType$F7, true);
    n0.setReferenceTarget(LINKS.outerPort$lnWS, p1);
    {
      SNodeBuilder n1 = n0.forChild(LINKS.sourceInstance$lh9r).init(CONCEPTS.InstanceRef$Gm);
      n1.setReferenceTarget(LINKS.ref$H$FL, p2);
    }
    n0.setReferenceTarget(LINKS.sourcePort$lhQu, p3);
    return n0.getResult();
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink type$5Gl6 = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e51937cL, 0x6c4f9fd23e566372L, "type");
    /*package*/ static final SContainmentLink category$WD4l = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e51937cL, 0x5aed9484f65f1e5L, "category");
    /*package*/ static final SContainmentLink contents$7e9r = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x71280102b4ce9cdL, 0x71280102b4ce9ceL, "contents");
    /*package*/ static final SContainmentLink connectorType$8zQx = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x3a8867c74e876c3fL, 0x3a8867c74e88330cL, "connectorType");
    /*package*/ static final SReferenceLink outerPort$3H4p = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a05d2c1L, 0x32f64a31a05d2cbL, "outerPort");
    /*package*/ static final SContainmentLink targetInstance$ZsmL = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a05d2c1L, 0x32f64a31a07b915L, "targetInstance");
    /*package*/ static final SReferenceLink ref$H$FL = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x7fdf70a1447d7f29L, 0x7fdf70a1447d7f36L, "ref");
    /*package*/ static final SReferenceLink targetPort$ZxZ9 = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a05d2c1L, 0x32f64a31a07b918L, "targetPort");
    /*package*/ static final SReferenceLink outerPort$ffZi = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a0a561cL, 0x32f64a31a0a561fL, "outerPort");
    /*package*/ static final SContainmentLink sourceInstance$fa_V = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a0a561cL, 0x32f64a31a0a561dL, "sourceInstance");
    /*package*/ static final SReferenceLink sourcePort$fgej = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a0a561cL, 0x32f64a31a0a5620L, "sourcePort");
    /*package*/ static final SReferenceLink outerPort$lnWS = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x18be1a5e93218f96L, 0x18be1a5e93218f9fL, "outerPort");
    /*package*/ static final SContainmentLink sourceInstance$lh9r = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x18be1a5e93218f96L, 0x18be1a5e93218f97L, "sourceInstance");
    /*package*/ static final SReferenceLink sourcePort$lhQu = MetaAdapterFactory.getReferenceLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x18be1a5e93218f96L, 0x18be1a5e93218f9aL, "sourcePort");
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept Port$gs = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e51937cL, "org.iets3.components.core.structure.Port");
    /*package*/ static final SConcept Component$gR = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e484601L, "org.iets3.components.core.structure.Component");
    /*package*/ static final SConcept ComponentSubstructure$oB = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x71280102b4ce9cdL, "org.iets3.components.core.structure.ComponentSubstructure");
    /*package*/ static final SConcept ImportConnector$8o = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a05d2c1L, "org.iets3.components.core.structure.ImportConnector");
    /*package*/ static final SConcept ExportConnector$hw = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x32f64a31a0a561cL, "org.iets3.components.core.structure.ExportConnector");
    /*package*/ static final SConcept DelegateConnector$uB = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x18be1a5e93218f96L, "org.iets3.components.core.structure.DelegateConnector");
    /*package*/ static final SInterfaceConcept IPortType$DL = MetaAdapterFactory.getInterfaceConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e566371L, "org.iets3.components.core.structure.IPortType");
    /*package*/ static final SConcept PortCategory$Wm = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x71280102d0186c2L, "org.iets3.components.core.structure.PortCategory");
    /*package*/ static final SInterfaceConcept IConnectorType$F7 = MetaAdapterFactory.getInterfaceConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x4c293bba48709df1L, "org.iets3.components.core.structure.IConnectorType");
    /*package*/ static final SConcept InstanceRef$Gm = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x7fdf70a1447d7f29L, "org.iets3.components.core.structure.InstanceRef");
  }
}
