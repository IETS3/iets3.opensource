package org.iets3.components.core.intentions;

/*Generated by MPS */

import jetbrains.mps.editor.intentions.IntentionsFactory;
import org.jetbrains.mps.openapi.language.SAbstractConcept;
import jetbrains.mps.smodel.SNodePointer;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.openapi.editor.update.Updater;
import jetbrains.mps.internal.collections.runtime.Sequence;
import jetbrains.mps.project.Project;
import jetbrains.mps.project.MPSProject;
import jetbrains.mps.nodeEditor.hintsSettings.ConceptEditorHintSettingsComponent;
import org.iets3.components.core.behavior.Component__BehaviorDescriptor;
import org.iets3.components.core.behavior.AbstractComponentInstanceBase__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SNodeOperations;
import java.util.Collection;
import jetbrains.mps.editor.intentions.NodeTransformer;
import jetbrains.mps.internal.collections.runtime.CollectionSequence;
import java.util.ArrayList;
import jetbrains.mps.editor.intentions.BaseNodeTransformer;
import org.jetbrains.mps.openapi.language.SConcept;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class toggleShowNestedStructure extends IntentionsFactory {
  public toggleShowNestedStructure() {
  }

  public String getId() {
    return getClass().getName();
  }

  public boolean isAvailableInChildren() {
    return true;
  }

  public boolean isSurroundWith() {
    return false;
  }

  public SAbstractConcept getApplicableConcept() {
    return CONCEPTS.AbstractComponentInstanceBase$QW;
  }

  public SNodePointer getDeclarationNode() {
    return implementationNode;
  }

  private SNodePointer implementationNode = new SNodePointer("r:978553a1-f02c-4c84-a5ee-ce22e342a425(org.iets3.components.core.intentions)", "3540039144140615756");


  private boolean isApplicableHelper(SNode node, EditorContext editorContext) {
    Updater updater = editorContext.getEditorComponent().getUpdater();
    boolean wiringDiagramEnabled = Sequence.fromIterable(check_zfbrut_a0a1a0(check_zfbrut_a0a0b0a(updater))).contains("org.iets3.components.core.editor.org.iets3.components.wiringDiagram");
    if (!(wiringDiagramEnabled)) {
      Project project = editorContext.getOperationContext().getProject();
      if (project instanceof MPSProject) {
        ConceptEditorHintSettingsComponent settingsInstance = ConceptEditorHintSettingsComponent.getInstance(as_zfbrut_a0a0a0a1a2a51(project, MPSProject.class).getProject());
        wiringDiagramEnabled = settingsInstance.getState().getEnabledHints().contains("org.iets3.components.core.editor.org.iets3.components.wiringDiagram");
      }
    }
    return (Component__BehaviorDescriptor.compSubstructure_idx8tpSA1Tv5.invoke(AbstractComponentInstanceBase__BehaviorDescriptor.component_id77HYM7H$sfU.invoke(SNodeOperations.cast(node, CONCEPTS.AbstractComponentInstanceBase$QW))) != null) && wiringDiagramEnabled && !(Sequence.fromIterable(Sequence.fromArray(updater.getInitialEditorHints())).contains("org.iets3.components.core.editor.org.iets3.components.nestedComponentStructure"));
  }


  public boolean isAvailableInChild(SNode node, SNode node1, EditorContext context) {
    return false;
  }

  public boolean isApplicable(SNode node, EditorContext editorContext) {
    return isApplicableHelper(node, editorContext);
  }


  public void execute(SNode node, EditorContext editorContext) {
    Updater updater = editorContext.getEditorComponent().getUpdater();
    Iterable<String> explicitEditorHints = Sequence.fromArray(updater.getExplicitEditorHintsForNode(as_zfbrut_a0a0a0a1a32(node, SNode.class).getReference()));
    if (Sequence.fromIterable(explicitEditorHints).contains("org.iets3.components.core.editor.org.iets3.components.nestedComponentStructure")) {
      updater.removeExplicitEditorHintsForNode(as_zfbrut_a0a0a0a2a32(node, SNode.class).getReference(), "org.iets3.components.core.editor.org.iets3.components.nestedComponentStructure");
    } else {
      updater.addExplicitEditorHintsForNode(as_zfbrut_a0a0a0a0c0x(node, SNode.class).getReference(), "org.iets3.components.core.editor.org.iets3.components.nestedComponentStructure");
    }
    updater.update();
  }
  public String description(SNode node, EditorContext editorContext) {
    Updater updater = editorContext.getEditorComponent().getUpdater();
    Iterable<String> explicitEditorHints = Sequence.fromArray(updater.getExplicitEditorHintsForNode(as_zfbrut_a0a0a0a1a42(node, SNode.class).getReference()));
    return (Sequence.fromIterable(explicitEditorHints).contains("org.iets3.components.core.editor.org.iets3.components.nestedComponentStructure") ? "Hide Nested Structure" : "Show Nested Structure");
  }

  public Collection<NodeTransformer> getTreeTransformers(SNode node, SNode child, EditorContext editorContext) {
    Collection<NodeTransformer> result = CollectionSequence.fromCollection(new ArrayList<NodeTransformer>());
    CollectionSequence.fromCollection(result).addElement(new BaseNodeTransformer(this, node, editorContext, NodeTransformer.Kind.INTENTION, implementationNode) {
      protected void execute(SNode node, EditorContext editorContext) {
        toggleShowNestedStructure.this.execute(node, editorContext);
      }
      protected String getDescription(SNode node, EditorContext editorContext) {
        return toggleShowNestedStructure.this.description(node, editorContext);
      }
    });
    return result;
  }
  private static Iterable<String> check_zfbrut_a0a1a0(String[] checkedDotOperand) {
    if (null != checkedDotOperand) {
      return Sequence.fromArray(checkedDotOperand);
    }
    return null;
  }
  private static String[] check_zfbrut_a0a0b0a(Updater checkedDotOperand) {
    if (null != checkedDotOperand) {
      return checkedDotOperand.getInitialEditorHints();
    }
    return null;
  }
  private static <T> T as_zfbrut_a0a0a0a1a2a51(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_zfbrut_a0a0a0a1a32(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_zfbrut_a0a0a0a2a32(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_zfbrut_a0a0a0a0c0x(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }
  private static <T> T as_zfbrut_a0a0a0a1a42(Object o, Class<T> type) {
    return (type.isInstance(o) ? (T) o : null);
  }

  private static final class CONCEPTS {
    /*package*/ static final SConcept AbstractComponentInstanceBase$QW = MetaAdapterFactory.getConcept(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x71edfb21ed616471L, "org.iets3.components.core.structure.AbstractComponentInstanceBase");
  }
}
