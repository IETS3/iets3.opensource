package org.iets3.components.core.editor;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.AbstractCellProvider;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.nodeEditor.cells.EditorCell;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.nodeEditor.cells.EditorCell_Basic;
import java.awt.Graphics;
import jetbrains.mps.nodeEditor.cells.ParentSettings;
import jetbrains.mps.baseLanguage.closures.runtime.Wrappers;
import java.awt.Color;
import org.iets3.components.core.behavior.PortShapeRenderer;
import org.iets3.components.core.behavior.IPortType__BehaviorDescriptor;
import jetbrains.mps.lang.smodel.generator.smodelAdapter.SLinkOperations;
import org.iets3.components.core.behavior.PortCategory__BehaviorDescriptor;
import org.iets3.components.core.behavior.Port__BehaviorDescriptor;
import jetbrains.mps.nodeEditor.cells.EditorCell_Collection;
import java.awt.geom.Rectangle2D;
import java.awt.Shape;
import java.awt.Graphics2D;
import java.awt.BasicStroke;
import org.jetbrains.mps.openapi.language.SContainmentLink;
import jetbrains.mps.smodel.adapter.structure.MetaAdapterFactory;

public class PortShapeCell extends AbstractCellProvider {
  protected SNode port;

  public PortShapeCell(SNode p) {
    super(p);
    this.port = p;
  }


  public EditorCell createEditorCell(final EditorContext context) {
    EditorCell_Basic result = new EditorCell_Basic(context, PortShapeCell.this.port) {
      public void paintContent(Graphics g, ParentSettings parentSettings) {
        final Wrappers._T<Color> color = new Wrappers._T<Color>();
        final Wrappers._T<PortShapeRenderer> shapeRenderer = new Wrappers._T<PortShapeRenderer>();
        final Wrappers._boolean isOptional = new Wrappers._boolean();
        context.getRepository().getModelAccess().runReadAction(() -> {
          color.value = IPortType__BehaviorDescriptor.characteristicColor_idmIQkxg4rmC.invoke(SLinkOperations.getTarget(port, LINKS.type$5Gl6));
          shapeRenderer.value = PortCategory__BehaviorDescriptor.shapeRenderer_idmIQkxgiY42.invoke(SLinkOperations.getTarget(port, LINKS.category$WD4l));
          isOptional.value = (boolean) Port__BehaviorDescriptor.isOptional_idmIQkxf$r$2.invoke(port);
        });
        g.setColor(color.value);
        EditorCell_Collection parent = this.getParent();
        int x = parent.getX();
        int y = getY();
        int height = 5;
        int width = 10;
        Rectangle2D.Float bounds = new Rectangle2D.Float(x, y, x + width, y + height);
        Shape s = shapeRenderer.value.renderShape(bounds);
        g.setColor(color.value);
        Graphics2D g2d = ((Graphics2D) g);
        if (isOptional.value) {
          g2d.setStroke(new BasicStroke(2));
          g2d.draw(s);
        } else {
          g2d.setStroke(new BasicStroke(1));
          g2d.draw(s);
          g2d.fill(s);
        }
      }
      public void relayoutImpl() {
      }
      @Override
      public boolean isSelectable() {
        return false;
      }
    };

    return result;
  }

  private static final class LINKS {
    /*package*/ static final SContainmentLink type$5Gl6 = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e51937cL, 0x6c4f9fd23e566372L, "type");
    /*package*/ static final SContainmentLink category$WD4l = MetaAdapterFactory.getContainmentLink(0xf0fd486f857743e9L, 0xb6713d118449c6e7L, 0x6c4f9fd23e51937cL, 0x5aed9484f65f1e5L, "category");
  }
}
