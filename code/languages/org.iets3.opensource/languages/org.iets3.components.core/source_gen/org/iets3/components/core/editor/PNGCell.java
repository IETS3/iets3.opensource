package org.iets3.components.core.editor;

/*Generated by MPS */

import jetbrains.mps.nodeEditor.AbstractCellProvider;
import jetbrains.mps.logging.Logger;
import org.jetbrains.mps.openapi.model.SNode;
import jetbrains.mps.nodeEditor.cells.EditorCell;
import jetbrains.mps.openapi.editor.EditorContext;
import jetbrains.mps.nodeEditor.cells.EditorCell_Basic;
import javax.swing.Icon;
import org.jetbrains.annotations.NotNull;
import com.intellij.openapi.util.IconLoader;
import java.io.File;
import java.net.MalformedURLException;
import java.awt.Graphics;
import jetbrains.mps.nodeEditor.cells.ParentSettings;
import java.awt.image.BufferedImage;
import jetbrains.mps.nodeEditor.cells.EditorCell_Collection;

public class PNGCell extends AbstractCellProvider {
  private static final Logger LOG_1376071327 = Logger.getLogger(PNGCell.class);
  private final String path;
  private final SNode node;
  private final int voffset;

  public PNGCell(SNode node, String path, int voffset) {
    super(node);
    this.path = path;
    this.voffset = voffset;
    this.node = node;
  }

  public EditorCell createEditorCell(EditorContext context) {
    return new MyEditorCell_Basic(context, this.node, this.path, context, voffset);
  }

  private class MyEditorCell_Basic extends EditorCell_Basic {
    private final Icon icon;
    private int voffset;

    public MyEditorCell_Basic(@NotNull EditorContext p0, SNode node, String path, EditorContext context, int voffset) {
      super(p0, node);
      Icon icon = null;
      try {
        icon = IconLoader.findIcon(new File(path).toURI().toURL());
      } catch (MalformedURLException e) {
        if (LOG_1376071327.isErrorLevel()) {
          LOG_1376071327.error("can't load icon", e);
        }
      }
      this.icon = icon;
      this.voffset = voffset;
    }

    public void paintContent(Graphics g, ParentSettings parentSettings) {
      BufferedImage img = new BufferedImage(icon.getIconWidth(), icon.getIconHeight(), BufferedImage.TYPE_INT_ARGB);
      icon.paintIcon(null, img.getGraphics(), 0, 0);
      EditorCell_Collection parent = this.getParent();
      g.drawImage(img, parent.getX(), parent.getY() + voffset, null);
    }

    public void relayoutImpl() {
      this.myWidth = icon.getIconWidth();
      this.myHeight = icon.getIconHeight();
    }

    public boolean isLastCaretPosition() {
      return true;
    }
  }
}
