package org.iets3.variability.base.plugin;

/*Generated by MPS */

import org.iets3.variability.featuremodel.base.plugin.IETS3VariabilitySettings;
import jetbrains.mps.smodel.structure.ExtensionPoint;
import jetbrains.mps.internal.collections.runtime.Sequence;
import org.iets3.variability.featuremodel.base.plugin.DefaultIETS3VariabilitySettings;
import java.util.Arrays;
import java.util.stream.Collectors;
import jetbrains.mps.baseLanguage.closures.runtime._FunctionTypes;
import org.jetbrains.mps.openapi.model.SNode;

public class Settings {
  /**
   * TOOD: The IETS3VariabilitySettings class and the extension point definition should be moved to o.i.variability.base.
   */
  private static IETS3VariabilitySettings settings = null;

  public enum Format {
    AS_IS(),
    FIRST_UPPERCASE(),
    WORDS_UPPERCASE(),
    CAMELCASE(),
    UNDERSCORE()
  }

  private static IETS3VariabilitySettings instance() {
    if (settings == null) {
      ExtensionPoint<IETS3VariabilitySettings> ep = new ExtensionPoint<IETS3VariabilitySettings>("org.iets3.variability.featuremodel.base.tailorIETS3Variability");
      Iterable<IETS3VariabilitySettings> handlers = Sequence.fromIterable(ep.getObjects()).sort((it) -> it.getPriorityLevel(), false);
      if (Sequence.fromIterable(handlers).isEmpty()) {
        settings = new DefaultIETS3VariabilitySettings();
      } else {
        settings = Sequence.fromIterable(handlers).first();
      }
    }
    return settings;
  }


  public static String aliasFeatureModel(Format format) {
    String alias = instance().aliasFeatureModel();
    return applyFormat(alias, format);
  }

  public static String aliasFeature(Format format) {
    String alias = instance().aliasFeature();
    return applyFormat(alias, format);
  }

  public static String aliasFeatureModelInclude(Format format) {
    String alias = instance().aliasFeatureModelInclude();
    return applyFormat(alias, format);
  }

  public static String aliasConfiguration(Format format) {
    String alias = instance().aliasConfiguration();
    return applyFormat(alias, format);
  }

  private static String applyFormat(String text, Format format) {
    if ((text == null || text.length() == 0)) {
      return text;
    }
    switch (format) {
      case FIRST_UPPERCASE:
        return toFirstUpper(text);
      case WORDS_UPPERCASE:
        String[] spl1 = text.split(" ");
        return Arrays.stream(spl1).map((String s) -> toFirstUpper(s)).collect(Collectors.joining(" "));
      case CAMELCASE:
        String[] spl2 = text.split(" ");
        return Arrays.stream(spl2).map((String s) -> toFirstUpper(s)).collect(Collectors.joining());
      case UNDERSCORE:
        return text.replace(" ", "_");
      default:
        // return text as-is
        return text;
    }
  }

  private static String toFirstUpper(String text) {
    String first = text.substring(0, 1);
    String rest = text.substring(1);
    return first.toUpperCase() + rest;
  }


  public static IETS3VariabilitySettings.VerbosityLevel showForAllVariantsExecutionWarning() {
    return instance().getVerbosity_ForAllVariantsExecutionWarning();
  }

  public static _FunctionTypes._return_P0_E0<? extends SNode> getVariabilityContainerFactory() {
    return instance().getVariabilityContainerFactory();
  }
}
